# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ PRICING –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ

## üéØ –ü—Ä–µ–≥–ª–µ–¥

**PRICING –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ** –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—è —Å–æ—Ñ–∏—Å—Ç–∏—Ü–∏—Ä–∞–Ω–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ—Ç–æ –∑–∞ OptimaPOS, –ø–æ–¥–¥—ä—Ä–∂–∞–π–∫–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∑–∞ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ, –∫–ª–∏–µ–Ω—Ç—Å–∫–∏ –≥—Ä—É–ø–∏, –ø—Ä–æ–º–æ—Ü–∏–æ–Ω–∞–ª–Ω–∏ —Ü–µ–Ω–∏, –æ—Ç—Å—Ç—ä–ø–∫–∏ –ø—Ä–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ packaging-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ. –¢–æ —Å–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–∞ —Å inventory –∑–∞ cost-based —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ –∏ –ø–æ–¥–¥—ä—Ä–∂–∞ —Ç—ä—Ä—Å–µ–Ω–µ –Ω–∞ —Ü–µ–Ω–∏ –ø–æ –±–∞—Ä–∫–æ–¥.

## üìã –°—ä–¥—ä—Ä–∂–∞–Ω–∏–µ

1. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
2. [–¶–µ–Ω–æ–≤–∏ –º–æ–¥–µ–ª–∏](#—Ü–µ–Ω–æ–≤–∏-–º–æ–¥–µ–ª–∏)
3. [Pricing Service](#pricing-service)  
4. [–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∑–∞ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ](#—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏-–∑–∞-—Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ)
5. [VATCalculationService –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è](#vatcalculationservice-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
6. [–î–µ—Å–µ—Ç–∏—á–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç](#–¥–µ—Å–µ—Ç–∏—á–Ω–∞-—Ç–æ—á–Ω–æ—Å—Ç)
7. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–∏ —Ç–æ—á–∫–∏](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–∏-—Ç–æ—á–∫–∏)
8. [–®–∞–±–ª–æ–Ω–∏ –∑–∞ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ](#—à–∞–±–ª–æ–Ω–∏-–∑–∞-–∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ)
9. [API —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫](#api-—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫)

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
PRICING –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ:
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ base_prices.py        # ProductPrice (–±–∞–∑–æ–≤–∏ —Ü–µ–Ω–∏)
‚îÇ   ‚îú‚îÄ‚îÄ group_prices.py       # ProductPriceByGroup (–∫–ª–∏–µ–Ω—Ç—Å–∫–∏ –≥—Ä—É–ø–∏)
‚îÇ   ‚îú‚îÄ‚îÄ step_prices.py        # ProductStepPrice (–æ—Ç—Å—Ç—ä–ø–∫–∏ –ø—Ä–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ)
‚îÇ   ‚îú‚îÄ‚îÄ promotions.py         # PromotionalPrice (time-based –æ—Ñ–µ—Ä—Ç–∏)
‚îÇ   ‚îî‚îÄ‚îÄ packaging_prices.py   # PackagingPrice (–∞–ª—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∏ –µ–¥–∏–Ω–∏—Ü–∏)
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ pricing_service.py    # –ì–ª–∞–≤–Ω–∞ –ª–æ–≥–∏–∫–∞ –∑–∞ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ
‚îÇ   ‚îî‚îÄ‚îÄ promotion_service.py  # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –ø—Ä–æ–º–æ—Ü–∏–æ–Ω–∞–ª–Ω–∏ –∫–∞–º–ø–∞–Ω–∏–∏
‚îú‚îÄ‚îÄ admin/
‚îÇ   ‚îú‚îÄ‚îÄ prices.py            # –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –±–∞–∑–æ–≤–∏ —Ü–µ–Ω–∏
‚îÇ   ‚îú‚îÄ‚îÄ promotions.py        # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –ø—Ä–æ–º–æ—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ packaging.py         # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞ packaging —Ü–µ–Ω–∏
‚îî‚îÄ‚îÄ views.py                 # API endpoints
```

### –§–∏–ª–æ—Å–æ—Ñ–∏—è –Ω–∞ –¥–∏–∑–∞–π–Ω–∞

- **üéØ –ì—ä–≤–∫–∞–≤–æ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ** - –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∑–∞ —Ä–∞–∑–ª–∏—á–Ω–∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- **üìä –ë–∞–∑–∏—Ä–∞–Ω–æ –Ω–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∏** - –Ø—Å–Ω–∞ –π–µ—Ä–∞—Ä—Ö–∏—è: –ü—Ä–æ–º–æ—Ü–∏–∏ ‚Üí –ì—Ä—É–ø–∏ ‚Üí –°—Ç—ä–ø–∫–æ–≤–∏ ‚Üí –ë–∞–∑–æ–≤–∏ ‚Üí Fallback
- **üí∞ Profit-Aware** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–∞ —Å–µ–±–µ—Å—Ç–æ–π–Ω–æ—Å—Ç–∏ –∑–∞ –∫–∞–ª–∫—É–ª–∞—Ü–∏–∏ –Ω–∞ –ø–µ—á–∞–ª–±–∞—Ç–∞
- **‚ö° Location-Based** - –†–∞–∑–ª–∏—á–Ω–æ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ –∑–∞ –ª–æ–∫–∞—Ü–∏—è/—Å–∫–ª–∞–¥
- **üîÑ –í —Ä–µ–∞–ª–Ω–æ –≤—Ä–µ–º–µ** - –î–∏–Ω–∞–º–∏—á–Ω–æ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ —Å –º–∏–≥–Ω–æ–≤–µ–Ω–∏ –∫–∞–ª–∫—É–ª–∞—Ü–∏–∏
- **üì¶ Packaging –ø–æ–¥–¥—Ä—ä–∂–∫–∞** - –†–∞–∑–ª–∏—á–Ω–∏ —Ü–µ–Ω–∏ –∑–∞ —Ä–∞–∑–ª–∏—á–Ω–∏ packaging –µ–¥–∏–Ω–∏—Ü–∏
- **üí∞ –î–î–° –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–∞–Ω–æ —Å VATCalculationService

---

## –¶–µ–Ω–æ–≤–∏ –º–æ–¥–µ–ª–∏

### 1. **ProductPrice** (–ë–∞–∑–æ–≤–æ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ)

**–¶–µ–ª**: –û—Å–Ω–æ–≤–Ω–æ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ –∑–∞ –ø—Ä–æ–¥—É–∫—Ç–∏ –≤ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∏ –ª–æ–∫–∞—Ü–∏–∏

```python
from core.models.fields import CurrencyField

# –ú–µ—Ç–æ–¥–∏ –∑–∞ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ
pricing_method = [
    'FIXED',    # –§–∏–∫—Å–∏—Ä–∞–Ω–∞ —Ü–µ–Ω–∞ (–∏–∑–ø–æ–ª–∑–≤–∞ base_price)
    'MARKUP',   # –°–µ–±–µ—Å—Ç–æ–π–Ω–æ—Å—Ç + markup % (–∏–∑–ø–æ–ª–∑–≤–∞ markup_percentage)  
    'AUTO'      # Location default markup
]

# –ö–ª—é—á–æ–≤–∏ –ø–æ–ª–µ—Ç–∞
base_price = CurrencyField()         # –§–∏–∫—Å–∏—Ä–∞–Ω–∞ –ø—Ä–æ–¥–∞–∂–Ω–∞ —Ü–µ–Ω–∞ (2dp)
markup_percentage = models.DecimalField(max_digits=5, decimal_places=2)  # Markup –Ω–∞–¥ —Å–µ–±–µ—Å—Ç–æ–π–Ω–æ—Å—Ç
effective_price = CurrencyField()    # –ö–∞–ª–∫—É–ª–∏—Ä–∞–Ω–∞ —Ñ–∏–Ω–∞–ª–Ω–∞ —Ü–µ–Ω–∞ (–∞–≤—Ç–æ-–∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞–Ω–∞)

# Generic Location –ø–æ–¥–¥—Ä—ä–∂–∫–∞
content_type = models.ForeignKey(ContentType)
object_id = models.PositiveIntegerField()
priceable_location = GenericForeignKey()
```

**Location –≥—ä–≤–∫–∞–≤–æ—Å—Ç:**
```python
# –†–∞–±–æ—Ç–∏ —Å –≤—Å—è–∫–∞ ILocation –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è
warehouse_price = ProductPrice.objects.create_for_location(
    location=warehouse,           # InventoryLocation
    product=product,
    pricing_method='FIXED',
    base_price=Decimal('15.99')   # –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ 2dp —Ç–æ—á–Ω–æ—Å—Ç
)

online_price = ProductPrice.objects.create_for_location(
    location=online_store,        # OnlineStore  
    product=product,
    pricing_method='MARKUP',
    markup_percentage=Decimal('35.00')
)
```

### 2. **ProductPriceByGroup** (–¶–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ –∑–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏ –≥—Ä—É–ø–∏)

**–¶–µ–ª**: –°–ø–µ—Ü–∏–∞–ª–Ω–∏ —Ü–µ–Ω–∏ –∑–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏ —Å–µ–≥–º–µ–Ω—Ç–∏

```python
from core.models.fields import CurrencyField

# –¶–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ –∑–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è
customer_group = models.ForeignKey('partners.CustomerGroup')
price = CurrencyField()              # Group-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞ —Ü–µ–Ω–∞ (2dp —Ç–æ—á–Ω–æ—Å—Ç)
min_quantity = QuantityField()       # –û–ø—Ü–∏–æ–Ω–∞–ª–Ω–æ –º–∏–Ω–∏–º–∞–ª–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ

# Generic location –ø–æ–¥–¥—Ä—ä–∂–∫–∞
content_type = models.ForeignKey(ContentType)
object_id = models.PositiveIntegerField()
```

**–ü—Ä–∏–º–µ—Ä–∏ –∑–∞ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ:**
- –ö–ª–∏–µ–Ω—Ç–∏ –Ω–∞ –µ–¥—Ä–æ –ø–æ–ª—É—á–∞–≤–∞—Ç –ø–æ-–Ω–∏—Å–∫–∏ —Ü–µ–Ω–∏
- VIP –∫–ª–∏–µ–Ω—Ç–∏ –ø–æ–ª—É—á–∞–≤–∞—Ç premium –æ—Ç—Å—Ç—ä–ø–∫–∏
- –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∏ –¥–æ–≥–æ–≤–æ—Ä–∏ —Å –¥–æ–≥–æ–≤–æ—Ä–µ–Ω–∏ —Å—Ç–∞–≤–∫–∏

### 3. **VATCalculationService –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**

**–¶–µ–ª**: –ò–∑–ø–æ–ª–∑–≤–∞ VATCalculationService –∑–∞ –ø—Ä–∞–≤–∏–ª–Ω–∏ –î–î–° –∫–∞–ª–∫—É–ª–∞—Ü–∏–∏

```python
from nomenclatures.services.vat_calculation_service import VATCalculationService

class ProductPrice(models.Model):
    # ... –¥—Ä—É–≥–∏ –ø–æ–ª–µ—Ç–∞ ...
    
    def get_price_with_vat(self, customer=None, location=None):
        """–ü–æ–ª—É—á–∞–≤–∞ —Ü–µ–Ω–∞ —Å –î–î–° –∏–∑–ø–æ–ª–∑–≤–∞–π–∫–∏ VATCalculationService"""
        from nomenclatures.services.vat_calculation_service import VATCalculationService
        
        # –ò–∑–ø–æ–ª–∑–≤–∞ VATCalculationService –∑–∞ –ø—Ä–∞–≤–∏–ª–Ω–∏ –î–î–° –∫–∞–ª–∫—É–ª–∞—Ü–∏–∏
        result = VATCalculationService.calculate_line_vat(
            line=None,  # Dummy line object –∞–∫–æ –µ –Ω—É–∂–Ω–æ
            entered_price=self.effective_price,
            save=False
        )
        
        if result.ok:
            return result.data['unit_price_with_vat']
        
        # Fallback –¥–æ –æ—Å–Ω–æ–≤–Ω–∞—Ç–∞ —Ü–µ–Ω–∞
        return self.effective_price
```

---

## –î–µ—Å–µ—Ç–∏—á–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å—ä—Å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–∞–Ω–∏—Ç–µ –ø–æ–ª–µ—Ç–∞

```python
from core.models.fields import CurrencyField, QuantityField
from core.utils.decimal_utils import round_currency, round_cost_price

class ProductPrice(models.Model):
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ 2dp —Ç–æ—á–Ω–æ—Å—Ç –∑–∞ –¥–∏—Å–ø–ª–µ–π —Ü–µ–Ω–∏
    base_price = CurrencyField()
    effective_price = CurrencyField()
    
    # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç –∑–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
    min_quantity = QuantityField()  # 3dp —Ç–æ—á–Ω–æ—Å—Ç
    
    def calculate_effective_price(self):
        """–ö–∞–ª–∫—É–ª–∏—Ä–∞ effective price —Å—ä—Å –ø—Ä–∞–≤–∏–ª–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç"""
        if self.pricing_method == 'FIXED':
            # –î–∏—Ä–µ–∫—Ç–Ω–æ –∏–∑–ø–æ–ª–∑–≤–∞–π base_price (–≤–µ—á–µ –ø—Ä–∞–≤–∏–ª–Ω–æ –∑–∞–∫—Ä—ä–≥–ª–µ–Ω–∞)
            self.effective_price = self.base_price
            
        elif self.pricing_method == 'MARKUP':
            # –ü–æ–ª—É—á–∏ —Å–µ–±–µ—Å—Ç–æ–π–Ω–æ—Å—Ç —Å –≤–∏—Å–æ–∫–∞ —Ç–æ—á–Ω–æ—Å—Ç
            cost_price = self.get_current_cost_price()  # 4dp –æ—Ç inventory
            
            # –ö–∞–ª–∫—É–ª–∏—Ä–∞–π —Å –≤–∏—Å–æ–∫–∞ —Ç–æ—á–Ω–æ—Å—Ç
            markup_multiplier = 1 + (self.markup_percentage / 100)
            calculated_price = cost_price * markup_multiplier
            
            # –ó–∞–∫—Ä—ä–≥–ª–∏ –∑–∞ –¥–∏—Å–ø–ª–µ–π/—Å—ä—Ö—Ä–∞–Ω–µ–Ω–∏–µ
            self.effective_price = round_currency(calculated_price)  # 2dp
```

### Profit –∫–∞–ª–∫—É–ª–∞—Ü–∏–∏

```python
from core.utils.decimal_utils import round_currency

def calculate_profit_metrics(self, quantity=None):
    """–ö–∞–ª–∫—É–ª–∏—Ä–∞ –ø–µ—á–∞–ª–±–∏ —Å –ø—Ä–∞–≤–∏–ª–Ω–∞ –¥–µ—Å–µ—Ç–∏—á–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç"""
    cost_price = self.get_current_cost_price()  # 4dp —Ç–æ—á–Ω–æ—Å—Ç
    selling_price = self.effective_price        # 2dp —Ç–æ—á–Ω–æ—Å—Ç
    
    if not cost_price or cost_price <= 0:
        return {
            'profit_amount': Decimal('0.00'),
            'markup_percentage': Decimal('0.00'),
            'margin_percentage': Decimal('0.00'),
            'cost_valid': False
        }
    
    # –ö–∞–ª–∫—É–ª–∏—Ä–∞–π –ø–µ—á–∞–ª–±–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü–∞
    profit_per_unit = selling_price - cost_price
    profit_per_unit = round_currency(profit_per_unit)  # 2dp –∑–∞ –¥–∏—Å–ø–ª–µ–π
    
    # –ö–∞–ª–∫—É–ª–∏—Ä–∞–π –ø—Ä–æ—Ü–µ–Ω—Ç–∏
    markup_pct = (profit_per_unit / cost_price) * 100
    margin_pct = (profit_per_unit / selling_price) * 100
    
    metrics = {
        'profit_amount': profit_per_unit,
        'markup_percentage': round(markup_pct, 2),
        'margin_percentage': round(margin_pct, 2),
        'cost_valid': True
    }
    
    # –ê–∫–æ –µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, –∫–∞–ª–∫—É–ª–∏—Ä–∞–π –æ–±—â–∏—Ç–µ —Å—É–º–∏
    if quantity:
        total_profit = profit_per_unit * quantity
        metrics['total_profit'] = round_currency(total_profit)
    
    return metrics
```

---

## Pricing Service

### Primary API (Result Pattern)

```python
from pricing.services import PricingService
from core.utils.decimal_utils import Decimal

# –ü–æ–ª—É—á–∞–≤–∞ –∏–∑—á–µ—Ä–ø–∞—Ç–µ–ª–Ω–æ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ
result = PricingService.get_product_pricing(
    location=warehouse,
    product=product,
    customer=customer,           # –ó–∞ –≥—Ä—É–ø–æ–≤–æ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ
    quantity=Decimal('25.000'),  # –ó–∞ —Å—Ç—ä–ø–∫–æ–≤–æ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ
    date=datetime.now().date()   # –ó–∞ –ø—Ä–æ–º–æ—Ü–∏–∏
)

if result.ok:
    pricing_data = result.data
    final_price = pricing_data['final_price']        # 2dp —Ç–æ—á–Ω–æ—Å—Ç
    pricing_rule = pricing_data['pricing_rule']      # –ö–æ–µ –ø—Ä–∞–≤–∏–ª–æ —Å–µ –ø—Ä–∏–ª–∞–≥–∞
    profit_metrics = pricing_data['profit_metrics']  # –ê–Ω–∞–ª–∏–∑ –Ω–∞ –ø–µ—á–∞–ª–±–∞—Ç–∞
    vat_data = pricing_data['vat_data']             # –î–î–° –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
```

### –ê–Ω–∞–ª–∏–∑ –Ω–∞ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ—Ç–æ

```python
# –ü–æ–¥—Ä–æ–±–Ω–∞ —Ä–∞–∑–±–∏–≤–∫–∞ –Ω–∞ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ—Ç–æ
analysis_result = PricingService.get_pricing_analysis(
    location=warehouse,
    product=product,
    customer=customer,
    quantity=Decimal('50.000')
)

if analysis_result.ok:
    analysis = analysis_result.data
    
    # –í—Å–∏—á–∫–∏ —Ü–µ–Ω–æ–≤–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏
    pricing_summary = analysis['pricing_summary']
    discount_analysis = analysis['discount_analysis'] 
    price_comparison = analysis['price_comparison']
    recommendations = analysis['recommendations']
    decimal_info = analysis['decimal_precision_info']  # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ —Ç–æ—á–Ω–æ—Å—Ç
```

### Barcode —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ

```python
# –¶–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ –ø–æ –±–∞—Ä–∫–æ–¥ (–ø—Ä–æ–¥—É–∫—Ç –∏–ª–∏ packaging)
barcode_result = PricingService.get_barcode_pricing(
    barcode='1234567890123',
    location=warehouse,
    customer=customer
)

if barcode_result.ok:
    barcode_data = barcode_result.data
    price = barcode_data['price']                    # 2dp —Ç–æ—á–Ω–æ—Å—Ç
    pricing_type = barcode_data['pricing_type']      # 'PRODUCT' or 'PACKAGING'
    
    if barcode_data['packaging']:
        unit_price = barcode_data['unit_price']      # 2dp —Ç–æ—á–Ω–æ—Å—Ç
        conversion_factor = barcode_data['packaging']['conversion_factor']  # 3dp —Ç–æ—á–Ω–æ—Å—Ç
```

---

## –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∑–∞ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ

### 1. **–†–µ–¥ –Ω–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∏ (–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Å–µ–ª–µ–∫—Ü–∏—è)**

–°–∏—Å—Ç–µ–º–∞—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∏–∑–±–∏—Ä–∞ –Ω–∞–π-–¥–æ–±—Ä–∞—Ç–∞ –ø—Ä–∏–ª–æ–∂–∏–º–∞ —Ü–µ–Ω–∞ –∏–∑–ø–æ–ª–∑–≤–∞–π–∫–∏ —Ç–æ–∑–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:

1. **üéØ –ü—Ä–æ–º–æ—Ü–∏–∏** (–Ω–∞–π-–≤–∏—Å–æ–∫ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
2. **üë• –¶–µ–Ω–∏ –∑–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏ –≥—Ä—É–ø–∏**  
3. **üì¶ –°—Ç—ä–ø–∫–æ–≤–∏ —Ü–µ–Ω–∏** (–±–∞–∑–∏—Ä–∞–Ω–∏ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ)
4. **üí∞ –ë–∞–∑–æ–≤–∞ —Ü–µ–Ω–∞**
5. **üîÑ Fallback —Ü–µ–Ω–∞** (—Å–µ–±–µ—Å—Ç–æ–π–Ω–æ—Å—Ç + location markup)

```python
def _determine_final_price(base, promo, group, step, fallback):
    """–û–ø—Ä–µ–¥–µ–ª—è —Ñ–∏–Ω–∞–ª–Ω–∞—Ç–∞ —Ü–µ–Ω–∞ —Å—ä—Å –ø—Ä–∞–≤–∏–ª–Ω–∞ –¥–µ—Å–µ—Ç–∏—á–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç"""
    from core.utils.decimal_utils import round_currency
    
    selected_price = None
    rule_type = None
    
    if promo and promo > 0:
        selected_price, rule_type = promo, 'PROMOTION'
    elif group and group > 0:
        selected_price, rule_type = group, 'CUSTOMER_GROUP'
    elif step and step > 0:
        selected_price, rule_type = step, 'STEP_PRICE'
    elif base and base > 0:
        selected_price, rule_type = base, 'BASE_PRICE'
    else:
        selected_price, rule_type = fallback, 'FALLBACK'
    
    # –ì–∞—Ä–∞–Ω—Ç–∏—Ä–∞–π –ø—Ä–∞–≤–∏–ª–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç
    final_price = round_currency(selected_price)
    
    return final_price, rule_type
```

### 2. **Cost-Based –º–µ—Ç–æ–¥–∏ –∑–∞ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ**

```python
from core.utils.decimal_utils import round_currency

# –§–∏–∫—Å–∏—Ä–∞–Ω–∞ —Ü–µ–Ω–∞
ProductPrice.objects.create_for_location(
    location=warehouse,
    product=product,
    pricing_method='FIXED',
    base_price=Decimal('19.99')  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∞–≤–∏–ª–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç
)

# Markup-–±–∞–∑–∏—Ä–∞–Ω–æ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ
ProductPrice.objects.create_for_location(
    location=warehouse,
    product=product, 
    pricing_method='MARKUP',
    markup_percentage=Decimal('40.00')  # 40% markup –Ω–∞–¥ —Å–µ–±–µ—Å—Ç–æ–π–Ω–æ—Å—Ç
)

# Auto (–∏–∑–ø–æ–ª–∑–≤–∞ location's default markup)
ProductPrice.objects.create_for_location(
    location=warehouse,
    product=product,
    pricing_method='AUTO'  # –ò–∑–ø–æ–ª–∑–≤–∞ warehouse.default_markup_percentage
)
```

### 3. **–î–∏–Ω–∞–º–∏—á–Ω–æ –∏–∑—á–∏—Å–ª—è–≤–∞–Ω–µ –Ω–∞ —Ü–µ–Ω–∏**

```python
from core.utils.decimal_utils import round_currency, round_cost_price

def calculate_effective_price(self):
    """–ö–∞–ª–∫—É–ª–∏—Ä–∞ effective price —Å—ä—Å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–∞–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç"""
    if self.pricing_method == 'FIXED':
        self.effective_price = self.base_price  # –í–µ—á–µ —Å –ø—Ä–∞–≤–∏–ª–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç
        
    elif self.pricing_method == 'MARKUP':
        cost_price = self.get_current_cost_price()  # 4dp –æ—Ç inventory
        if cost_price and cost_price > 0:
            # –ò–∑—á–∏—Å–ª–∏ —Å –≤–∏—Å–æ–∫–∞ —Ç–æ—á–Ω–æ—Å—Ç
            markup_multiplier = 1 + (self.markup_percentage / 100)
            calculated_price = cost_price * markup_multiplier
            
            # –ó–∞–∫—Ä—ä–≥–ª–∏ –∑–∞ –¥–∏—Å–ø–ª–µ–π/—Å—ä—Ö—Ä–∞–Ω–µ–Ω–∏–µ
            self.effective_price = round_currency(calculated_price)
        else:
            self.effective_price = self.base_price or Decimal('0.00')
            
    elif self.pricing_method == 'AUTO':
        cost_price = self.get_current_cost_price()
        location_markup = getattr(self.priceable_location, 'default_markup_percentage', 0)
        
        if cost_price and cost_price > 0 and location_markup > 0:
            markup_multiplier = 1 + (location_markup / 100)
            calculated_price = cost_price * markup_multiplier
            self.effective_price = round_currency(calculated_price)
        else:
            self.effective_price = self.base_price or Decimal('0.00')
```

---

## VATCalculationService –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –î–î–° –∫–∞–ª–∫—É–ª–∞—Ü–∏–∏

```python
class PricingService:
    @staticmethod
    def get_product_pricing_with_vat(location, product, customer=None, quantity=None):
        """–ü–æ–ª—É—á–∞–≤–∞ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ –≤–∫–ª—é—á–∏—Ç–µ–ª–Ω–æ –î–î–° –¥–∞–Ω–Ω–∏"""
        from nomenclatures.services.vat_calculation_service import VATCalculationService
        
        # –ü–æ–ª—É—á–∏ –æ—Å–Ω–æ–≤–Ω–æ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ
        pricing_result = PricingService.get_product_pricing(
            location=location,
            product=product,
            customer=customer,
            quantity=quantity
        )
        
        if not pricing_result.ok:
            return pricing_result
        
        pricing_data = pricing_data.data
        net_price = pricing_data['final_price']  # 2dp —Ç–æ—á–Ω–æ—Å—Ç
        
        # –ü–æ–ª—É—á–∏ –î–î–° —Å—Ç–∞–≤–∫–∞
        vat_rate = VATCalculationService.get_vat_rate(product, location)
        
        # –ö–∞–ª–∫—É–ª–∏—Ä–∞–π –î–î–°
        from core.utils.decimal_utils import round_vat_amount, round_currency
        vat_amount = round_vat_amount(net_price * vat_rate / 100)
        gross_price = round_currency(net_price + vat_amount)
        
        # –î–æ–±–∞–≤–∏ –î–î–° –¥–∞–Ω–Ω–∏ –∫—ä–º —Ä–µ–∑—É–ª—Ç–∞—Ç–∞
        pricing_data['vat_data'] = {
            'net_price': net_price,
            'vat_rate': vat_rate,
            'vat_amount': vat_amount,
            'gross_price': gross_price
        }
        
        return Result.success(data=pricing_data)
```

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–∏ —Ç–æ—á–∫–∏

### **–° INVENTORY App:**

```python
from core.utils.decimal_utils import round_cost_price

def get_current_cost_price(self):
    """–ü–æ–ª—É—á–∞–≤–∞ —Å–µ–±–µ—Å—Ç–æ–π–Ω–æ—Å—Ç –æ—Ç inventory –∑–∞ markup –∫–∞–ª–∫—É–ª–∞—Ü–∏–∏"""
    try:
        from inventory.models import InventoryItem
        item = InventoryItem.objects.get(
            location=self.priceable_location,
            product=self.product
        )
        # InventoryItem.avg_cost –≤–µ—á–µ –∏–º–∞ 4dp —Ç–æ—á–Ω–æ—Å—Ç
        return item.avg_cost
    except InventoryItem.DoesNotExist:
        # Fallback –∫—ä–º product weighted average cost
        cost = self.product.weighted_avg_cost or Decimal('0.0000')
        return round_cost_price(cost)  # –ì–∞—Ä–∞–Ω—Ç–∏—Ä–∞–π 4dp —Ç–æ—á–Ω–æ—Å—Ç
```

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞ —Ü–µ–Ω–∏—Ç–µ:**
- –ö–æ–≥–∞—Ç–æ —Å–µ–±–µ—Å—Ç–æ–π–Ω–æ—Å—Ç—Ç–∞ –≤ inventory —Å–µ –ø—Ä–æ–º–µ–Ω–∏ –∑–Ω–∞—á–∏—Ç–µ–ª–Ω–æ (>5%), pricing service —Å–µ —É–≤–µ–¥–æ–º—è–≤–∞
- Markup-–±–∞–∑–∏—Ä–∞–Ω–∏—Ç–µ —Ü–µ–Ω–∏ —Å–µ –ø—Ä–µ–∏–∑—á–∏—Å–ª—è–≤–∞—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å –ø—Ä–∞–≤–∏–ª–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç
- –ò—Å—Ç–æ—Ä–∏—è—Ç–∞ –Ω–∞ –ø—Ä–æ–º–µ–Ω–∏—Ç–µ –≤ —Ü–µ–Ω–∏—Ç–µ —Å–µ –ø–æ–¥–¥—ä—Ä–∂–∞

### **–° PRODUCTS App:**

```python
from core.utils.decimal_utils import round_currency

def get_packaging_price(product, packaging):
    """–ü–æ–ª—É—á–∞–≤–∞ —Ü–µ–Ω–∞ –∑–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ packaging —Å –ø—Ä–∞–≤–∏–ª–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç"""
    try:
        pkg_price = PackagingPrice.objects.get(
            product=product,
            packaging=packaging,
            is_active=True
        )
        return pkg_price.price  # –í–µ—á–µ —Å 2dp —Ç–æ—á–Ω–æ—Å—Ç
    except PackagingPrice.DoesNotExist:
        # –ö–∞–ª–∫—É–ª–∏—Ä–∞–π –æ—Ç –±–∞–∑–æ–≤–∞—Ç–∞ —Ü–µ–Ω–∞
        base_price_result = PricingService.get_product_pricing(location, product)
        if base_price_result.ok:
            unit_price = base_price_result.data['final_price']  # 2dp —Ç–æ—á–Ω–æ—Å—Ç
            calculated_price = unit_price * packaging.conversion_factor
            return round_currency(calculated_price)  # –ü—Ä–∞–≤–∏–ª–Ω–æ –∑–∞–∫—Ä—ä–≥–ª—è–≤–∞–Ω–µ
        
        return Decimal('0.00')
```

---

## –®–∞–±–ª–æ–Ω–∏ –∑–∞ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ

### 1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞ –±–∞–∑–æ–≤–æ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ**

```python
from pricing.models import ProductPrice
from core.utils.decimal_utils import Decimal

# –§–∏–∫—Å–∏—Ä–∞–Ω–æ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ –∑–∞ retail –ª–æ–∫–∞—Ü–∏—è
ProductPrice.objects.create_for_location(
    location=retail_store,
    product=widget,
    pricing_method='FIXED',
    base_price=Decimal('24.99')  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ 2dp —Ç–æ—á–Ω–æ—Å—Ç
)

# Markup —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ –∑–∞ wholesale –ª–æ–∫–∞—Ü–∏—è  
ProductPrice.objects.create_for_location(
    location=warehouse,
    product=widget,
    pricing_method='MARKUP',
    markup_percentage=Decimal('25.00')  # 25% –Ω–∞–¥ —Å–µ–±–µ—Å—Ç–æ–π–Ω–æ—Å—Ç
)
```

### 2. **–†–∞–±–æ—Ç–∞ —Å –¥–µ—Å–µ—Ç–∏—á–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç**

```python
from core.utils.decimal_utils import round_currency, round_cost_price

def setup_dynamic_pricing():
    # –í—Ö–æ–¥–Ω–∏ –¥–∞–Ω–Ω–∏ –º–æ–≥–∞—Ç –¥–∞ –∏–º–∞—Ç —Ä–∞–∑–ª–∏—á–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç
    raw_cost = Decimal('15.256789')      # –û—Ç inventory —Å–∏—Å—Ç–µ–º–∞
    raw_markup = Decimal('33.333333')   # –û—Ç –∫–∞–ª–∫—É–ª–∞—Ü–∏–∏
    
    # –ò–∑–ø–æ–ª–∑–≤–∞–π –ø—Ä–∞–≤–∏–ª–Ω–æ—Ç–æ –∑–∞–∫—Ä—ä–≥–ª—è–≤–∞–Ω–µ
    cost_price = round_cost_price(raw_cost)     # 15.2568 –∑–∞ –∫–∞–ª–∫—É–ª–∞—Ü–∏–∏
    markup_pct = round(raw_markup, 2)           # 33.33 –∑–∞ markup
    
    # –ö–∞–ª–∫—É–ª–∏—Ä–∞–π —Å –≤–∏—Å–æ–∫–∞ —Ç–æ—á–Ω–æ—Å—Ç
    calculated_price = cost_price * (1 + markup_pct / 100)
    
    # –ó–∞–∫—Ä—ä–≥–ª–∏ –∑–∞ –¥–∏—Å–ø–ª–µ–π/—Å—ä—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    final_price = round_currency(calculated_price)  # 20.34 –∑–∞ –¥–∏—Å–ø–ª–µ–π
    
    return {
        'cost_price': cost_price,       # 4dp
        'markup_percentage': markup_pct, # 2dp
        'selling_price': final_price    # 2dp
    }
```

---

## API —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫

### PricingService –º–µ—Ç–æ–¥–∏

| –ú–µ—Ç–æ–¥ | –¶–µ–ª | –í—Ä—ä—â–∞ | –ö–ª—é—á–æ–≤–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ |
|-------|-----|-------|------------------|
| `get_product_pricing()` | –ü—ä–ª–Ω–æ –∏–∑—á–∏—Å–ª—è–≤–∞–Ω–µ –Ω–∞ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ—Ç–æ | Result | location, product, customer, quantity, date |
| `get_product_pricing_with_vat()` | –¶–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ –≤–∫–ª—é—á–∏—Ç–µ–ª–Ω–æ –î–î–° | Result | location, product, customer, quantity |
| `get_pricing_analysis()` | –ü–æ–¥—Ä–æ–±–Ω–∞ —Ä–∞–∑–±–∏–≤–∫–∞ –Ω–∞ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ—Ç–æ | Result | location, product, customer, quantity |
| `get_all_pricing_options()` | –í—Å–∏—á–∫–∏ –Ω–∞–ª–∏—á–Ω–∏ –ø—Ä–∞–≤–∏–ª–∞ –∑–∞ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ | Result | location, product, customer |
| `validate_pricing_setup()` | –í–∞–ª–∏–¥–∏—Ä–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Ç–∞ –Ω–∞ —Ü–µ–Ω–∏—Ç–µ | Result | location, product |
| `get_barcode_pricing()` | –¶–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ —á—Ä–µ–∑ —Ç—ä—Ä—Å–µ–Ω–µ –Ω–∞ –±–∞—Ä–∫–æ–¥ | Result | barcode, location, customer |

### –°—Ç—Ä—É–∫—Ç—É—Ä–∏ –æ—Ç –¥–∞–Ω–Ω–∏ –≤ Result

**–ü—ä–ª–µ–Ω —Ä–µ–∑—É–ª—Ç–∞—Ç –æ—Ç —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ—Ç–æ:**
```python
{
    'final_price': Decimal('21.24'),        # 2dp —Ç–æ—á–Ω–æ—Å—Ç
    'pricing_rule': 'CUSTOMER_GROUP',
    'base_price': Decimal('24.99'),         # 2dp —Ç–æ—á–Ω–æ—Å—Ç
    'promotional_price': None,
    'group_price': Decimal('21.24'),        # 2dp —Ç–æ—á–Ω–æ—Å—Ç
    'step_price': None,
    'fallback_price': Decimal('18.75'),     # 2dp —Ç–æ—á–Ω–æ—Å—Ç
    'cost_price': Decimal('15.0000'),       # 4dp —Ç–æ—á–Ω–æ—Å—Ç –æ—Ç inventory
    'quantity': Decimal('10.000'),          # 3dp —Ç–æ—á–Ω–æ—Å—Ç
    'location_code': 'WH01',
    'product_code': 'WIDGET123',
    'customer_info': {
        'customer_id': 42,
        'price_group': 'Wholesale'
    },
    'profit_metrics': {
        'profit_amount': Decimal('6.24'),    # 2dp —Ç–æ—á–Ω–æ—Å—Ç
        'markup_percentage': Decimal('41.60'),
        'margin_percentage': Decimal('29.38'),
        'cost_valid': True
    },
    'vat_data': {
        'net_price': Decimal('21.24'),       # 2dp —Ç–æ—á–Ω–æ—Å—Ç
        'vat_rate': Decimal('20.00'),
        'vat_amount': Decimal('4.25'),       # 2dp —Ç–æ—á–Ω–æ—Å—Ç
        'gross_price': Decimal('25.49')      # 2dp —Ç–æ—á–Ω–æ—Å—Ç
    },
    'decimal_precision_info': {
        'currency_precision': 2,
        'cost_precision': 4,
        'quantity_precision': 3
    }
}
```

---

## –ù–∞–π-–¥–æ–±—Ä–∏ –ø—Ä–∞–∫—Ç–∏–∫–∏

### 1. **–í–∏–Ω–∞–≥–∏ –∏–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ Result Pattern**

```python
# ‚úÖ –î–æ–±—Ä–æ
result = PricingService.get_product_pricing(location, product, customer)
if result.ok:
    price = result.data['final_price']           # 2dp —Ç–æ—á–Ω–æ—Å—Ç
    profit = result.data['profit_metrics']['profit_amount']  # 2dp —Ç–æ—á–Ω–æ—Å—Ç
else:
    handle_pricing_error(result.code, result.msg)

# ‚ùå –ò–∑–±—è–≥–≤–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–µ–Ω –¥–æ—Å—Ç—ä–ø –¥–æ –º–æ–¥–µ–ª –∑–∞ —Å–ª–æ–∂–Ω–æ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ
try:
    price = ProductPrice.objects.get(product=product).effective_price
except ProductPrice.DoesNotExist:
    price = Decimal('0.00')  # –õ–∏–ø—Å–≤–∞ –≥—Ä—É–ø–æ–≤–æ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ, —Å—Ç—ä–ø–∫–æ–≤–æ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ, –∏ —Ç.–Ω.
```

### 2. **–ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª–Ω–∞—Ç–∞ –¥–µ—Å–µ—Ç–∏—á–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç**

```python
# ‚úÖ –î–æ–±—Ä–æ - –∏–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–∞–Ω–∏—Ç–µ —É—Ç–∏–ª–∏—Ç–∏
from core.utils.decimal_utils import round_currency, round_cost_price

# –ó–∞ —Ü–µ–Ω–∏ –∫–æ–∏—Ç–æ —Å–µ –ø–æ–∫–∞–∑–≤–∞—Ç –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞
display_price = round_currency(Decimal('24.9876'))    # ‚Üí 24.99

# –ó–∞ –≤—ä—Ç—Ä–µ—à–Ω–∏ –∫–∞–ª–∫—É–ª–∞—Ü–∏–∏ –Ω–∞ —Å–µ–±–µ—Å—Ç–æ–π–Ω–æ—Å—Ç
cost = round_cost_price(Decimal('15.256789'))         # ‚Üí 15.2568

# –ó–∞ –î–î–° —Å—É–º–∏
vat = round_vat_amount(Decimal('4.8976'))             # ‚Üí 4.90

# ‚ùå –ò–∑–±—è–≥–≤–∞–π—Ç–µ - –¥–∏—Ä–µ–∫—Ç–Ω–æ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ –Ω–∞ round()
price = round(Decimal('24.9876'), 2)  # –ù–µ –∏–∑–ø–æ–ª–∑–≤–∞ –ø—Ä–∞–≤–∏–ª–Ω–∏—Ç–µ –ø—Ä–∞–≤–∏–ª–∞
```

### 3. **–í–∞–ª–∏–¥–∏—Ä–∞–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏—Ç–µ –Ω–∞ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ—Ç–æ**

```python
# ‚úÖ –î–æ–±—Ä–æ - –≤–∞–ª–∏–¥–∏—Ä–∞–π—Ç–µ –ø—Ä–µ–¥–∏ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ
validation = PricingService.validate_pricing_setup(location, product)
if validation.ok:
    pricing_result = PricingService.get_product_pricing(...)
else:
    # –û–±—Ä–∞–±–æ—Ç–µ—Ç–µ –ø—Ä–æ–±–ª–µ–º–∏ —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Ç–∞
    setup_base_pricing(location, product)

# ‚ùå –ò–∑–±—è–≥–≤–∞–π—Ç–µ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏—è —á–µ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ—Ç–æ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞
pricing_result = PricingService.get_product_pricing(...)  # –ú–æ–∂–µ –¥–∞ –≤—ä—Ä–Ω–µ fallback
```

### 4. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–∞–π—Ç–µ —Å –î–î–° –∫–∞–ª–∫—É–ª–∞—Ü–∏–∏—Ç–µ**

```python
# ‚úÖ –î–æ–±—Ä–æ - –∏–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ VATCalculationService –∑–∞ –î–î–°
result = PricingService.get_product_pricing_with_vat(
    location=location,
    product=product,
    customer=customer
)

if result.ok:
    net_price = result.data['vat_data']['net_price']      # 2dp —Ç–æ—á–Ω–æ—Å—Ç
    vat_amount = result.data['vat_data']['vat_amount']     # 2dp —Ç–æ—á–Ω–æ—Å—Ç
    gross_price = result.data['vat_data']['gross_price']   # 2dp —Ç–æ—á–Ω–æ—Å—Ç

# ‚ùå –ò–∑–±—è–≥–≤–∞–π—Ç–µ —Ä—ä—á–Ω–∏ –î–î–° –∫–∞–ª–∫—É–ª–∞—Ü–∏–∏
manual_vat = price * 0.20  # –ú–æ–∂–µ –¥–∞ –∏–º–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç
```

---

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**PRICING app –∑–∞–≤–∏—Å–∏ –æ—Ç:**
- Django framework
- CORE app (Result pattern, ILocation –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –¥–µ—Å–µ—Ç–∏—á–Ω–∏ —É—Ç–∏–ª–∏—Ç–∏)
- PRODUCTS app (Product, ProductPackaging –º–æ–¥–µ–ª–∏)
- INVENTORY app (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–∞ —Å–µ–±–µ—Å—Ç–æ–π–Ω–æ—Å—Ç–∏)
- NOMENCLATURES app (VATCalculationService)

**–î—Ä—É–≥–∏ apps –∑–∞–≤–∏—Å—è—Ç –æ—Ç PRICING:**
- SALES (—Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ –Ω–∞ –ø–æ—Ä—ä—á–∫–∏)
- POS (—Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ –ø–æ –±–∞—Ä–∫–æ–¥)
- REPORTS (–∞–Ω–∞–ª–∏–∑ –Ω–∞ –ø–µ—á–∞–ª–±–∞—Ç–∞)
- NOMENCLATURES (–î–î–° –∫–∞–ª–∫—É–ª–∞—Ü–∏–∏)

---

## –ò—Å—Ç–æ—Ä–∏—è –Ω–∞ –≤–µ—Ä—Å–∏–∏—Ç–µ

- **v1.0** - –û—Å–Ω–æ–≤–Ω–æ —Ñ–∏–∫—Å–∏—Ä–∞–Ω–æ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ
- **v1.1** - –î–æ–±–∞–≤–µ–Ω–æ markup-–±–∞–∑–∏—Ä–∞–Ω–æ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ
- **v1.2** - –¶–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ –∑–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏ –≥—Ä—É–ø–∏
- **v1.3** - –°—Ç—ä–ø–∫–æ–≤–æ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ –∏ –ø—Ä–æ–º–æ—Ü–∏–∏
- **v1.4** - Generic location –ø–æ–¥–¥—Ä—ä–∂–∫–∞
- **v1.5** - Packaging —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ
- **v2.0** - Result pattern —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ä–∞–Ω–µ
- **v2.1** - –ü–æ–¥–æ–±—Ä–µ–Ω–∏ API-—Ç–∞ –∑–∞ –∞–Ω–∞–ª–∏–∑ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
- **v3.0** - –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–∞–Ω–∞ –¥–µ—Å–µ—Ç–∏—á–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç, VATCalculationService –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

---

*–ü–æ—Å–ª–µ–¥–Ω–∞ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è: 2025-09-05*  
*–í–µ—Ä—Å–∏—è: 3.0*  
*–ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞–Ω–æ —Å–ø–æ—Ä–µ–¥ –∞–∫—Ç—É–∞–ª–Ω–∏—è –∫–æ–¥ —Å –¥–µ—Å–µ—Ç–∏—á–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç –∏ –î–î–° –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è*