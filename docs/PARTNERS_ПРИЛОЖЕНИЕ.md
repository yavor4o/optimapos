# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ PARTNERS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ

## üéØ –ü—Ä–µ–≥–ª–µ–¥

**PARTNERS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ** —É–ø—Ä–∞–≤–ª—è–≤–∞ –±–∏–∑–Ω–µ—Å –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ç–∞ –≤ OptimaPOS, –æ–±—Ä–∞–±–æ—Ç–≤–∞–π–∫–∏ –∫–∞–∫—Ç–æ –∫–ª–∏–µ–Ω—Ç–∏, —Ç–∞–∫–∞ –∏ –¥–æ—Å—Ç–∞–≤—á–∏—Ü–∏ —Å —Ç–µ—Ö–Ω–∏—Ç–µ —Å–ª–æ–∂–Ω–∏ –±–∏–∑–Ω–µ—Å –∏–∑–∏—Å–∫–≤–∞–Ω–∏—è –≤–∫–ª—é—á–∏—Ç–µ–ª–Ω–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –∫—Ä–µ–¥–∏—Ç–∏, —Ü–µ–Ω–æ–≤–∏ –≥—Ä—É–ø–∏, –≥—Ä–∞—Ñ–∏—Ü–∏ –∑–∞ –¥–æ—Å—Ç–∞–≤–∫–∞, –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å–∞–π—Ç–æ–≤–µ –∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏.

## üìã –°—ä–¥—ä—Ä–∂–∞–Ω–∏–µ

1. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
2. [–û—Å–Ω–æ–≤–Ω–∏ –º–æ–¥–µ–ª–∏](#–æ—Å–Ω–æ–≤–Ω–∏-–º–æ–¥–µ–ª–∏)
3. [–£—Å–ª—É–≥–∏](#—É—Å–ª—É–≥–∏)
4. [–ë–∏–∑–Ω–µ—Å –ª–æ–≥–∏–∫–∞](#–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
5. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–∏ —Ç–æ—á–∫–∏](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–∏-—Ç–æ—á–∫–∏)
6. [–®–∞–±–ª–æ–Ω–∏ –∑–∞ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ](#—à–∞–±–ª–æ–Ω–∏-–∑–∞-–∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ)
7. [API —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫](#api-—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫)
8. [–ù–∞–π-–¥–æ–±—Ä–∏ –ø—Ä–∞–∫—Ç–∏–∫–∏](#–Ω–∞–π-–¥–æ–±—Ä–∏-–ø—Ä–∞–∫—Ç–∏–∫–∏)

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
PARTNERS –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ:
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ base.py           # PartnerBase, PartnerScheduleBase
‚îÇ   ‚îú‚îÄ‚îÄ customers.py      # Customer, CustomerSite, CustomerDaySchedule
‚îÇ   ‚îî‚îÄ‚îÄ suppliers.py      # Supplier, SupplierDivision, SupplierDaySchedule
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ customer_service.py  # –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –∫–ª–∏–µ–Ω—Ç–∏ –∏ –∞–Ω–∞–ª–∏–∑–∏
‚îÇ   ‚îî‚îÄ‚îÄ supplier_service.py  # –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –¥–æ—Å—Ç–∞–≤—á–∏—Ü–∏ –∏ –∞–Ω–∞–ª–∏–∑–∏
‚îú‚îÄ‚îÄ admin/
‚îÇ   ‚îú‚îÄ‚îÄ customers.py      # –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∏
‚îÇ   ‚îî‚îÄ‚îÄ suppliers.py      # –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –¥–æ—Å—Ç–∞–≤—á–∏—Ü–∏
‚îî‚îÄ‚îÄ views.py              # API endpoints
```

### –§–∏–ª–æ—Å–æ—Ñ–∏—è –Ω–∞ –¥–∏–∑–∞–π–Ω–∞

- **üè¢ –ë–∏–∑–Ω–µ—Å-—Ü–µ–Ω—Ç—Ä–∏—á–µ–Ω** - –ú–æ–¥–µ–ª–∏—Ä–∞ —Ä–µ–∞–ª–Ω–∏ –±–∏–∑–Ω–µ—Å –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∏ –ø—Ä–æ—Ü–µ—Å–∏
- **üí∞ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –∫—Ä–µ–¥–∏—Ç–∏** - –í–≥—Ä–∞–¥–µ–Ω–∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏ –∏ –ª–∏–º–∏—Ç–∏
- **üìÖ Schedule-Aware** - –ì—Ä–∞—Ñ–∏—Ü–∏ –∑–∞ –¥–æ—Å—Ç–∞–≤–∫–∞ –∏ –ø–æ—Ä—ä—á–∫–∏ –∑–∞ –ø–∞—Ä—Ç–Ω—å–æ—Ä
- **üè∑Ô∏è –ë–∞–∑–∏—Ä–∞–Ω –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏** - –ö–ª–∏–µ–Ω—Ç—Å–∫–∏ –≥—Ä—É–ø–∏, VIP —Å—Ç–∞—Ç—É—Å, —Ü–µ–Ω–æ–≤–∏ –Ω–∏–≤–∞
- **üè¢ Multi-Site –ø–æ–¥–¥—Ä—ä–∂–∫–∞** - –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –ª–æ–∫–∞—Ü–∏–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç
- **üîÑ Integration-Ready** - –ë–µ–∑–ø—Ä–æ–±–ª–µ–º–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–æ–¥–∞–∂–±–∏, —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ –∏ –ø–æ–∫—É–ø–∫–∏
- **üìä Analytics-Driven** - –ë–æ–≥–∞—Ç–∏ –≤—ä–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞ –æ—Ç—á–µ—Ç–∏ –∏ dashboard

---

## –û—Å–Ω–æ–≤–Ω–∏ –º–æ–¥–µ–ª–∏

### 1. **PartnerBase** (–ê–±—Å—Ç—Ä–∞–∫—Ç–Ω–∞ –±–∞–∑–∞)

**–¶–µ–ª**: –°–ø–æ–¥–µ–ª–µ–Ω–∏ –ø–æ–ª–µ—Ç–∞ –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∑–∞ –≤—Å–∏—á–∫–∏ –±–∏–∑–Ω–µ—Å –ø–∞—Ä—Ç–Ω—å–æ—Ä–∏

```python
# –û—Å–Ω–æ–≤–Ω–∞ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç
code = models.CharField(unique=True, max_length=20)  # –ö—Ä–∞—Ç—ä–∫ —É–Ω–∏–∫–∞–ª–µ–Ω –∫–æ–¥ (ABC, PIXEL)
name = models.CharField(max_length=200)              # –ü—ä–ª–Ω–æ –±–∏–∑–Ω–µ—Å –∏–º–µ

# –î–∞–Ω—ä—á–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
vat_number = models.CharField(max_length=20)         # –î–î–°/–ë–£–õ–°–¢–ê–¢ –Ω–æ–º–µ—Ä
vat_registered = models.BooleanField(default=True)   # –î–î–° —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–µ–Ω —Å—Ç–∞—Ç—É—Å

# –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
contact_person = models.CharField(max_length=100)
city = models.CharField(max_length=50)
address = models.TextField()
phone = models.CharField(max_length=20)
email = models.EmailField()

# –°—Ç–∞—Ç—É—Å
is_active = models.BooleanField(default=True)
notes = models.TextField(blank=True)
```

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–æ—á–∏—Å—Ç–≤–∞–Ω–µ –Ω–∞ –¥–∞–Ω–Ω–∏:**
```python
def clean(self):
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–∞–Ω–µ
    self.name = self.name.strip()
    self.vat_number = self.vat_number.strip().upper()
    self.email = self.email.strip().lower()
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è
    if not self.name.strip():
        raise ValidationError({'name': '–ò–º–µ—Ç–æ –Ω–µ –º–æ–∂–µ –¥–∞ –±—ä–¥–µ –ø—Ä–∞–∑–Ω–æ'})
```

### 2. **Customer** (–†–∞–∑—à–∏—Ä—è–≤–∞ PartnerBase)

**–¶–µ–ª**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∏ —Å –∫—Ä–µ–¥–∏—Ç, —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ –∏ –ø–ª–∞–Ω–∏—Ä–∞–Ω–µ

```python
from core.models.fields import CurrencyField

# –ö–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∏
type = models.CharField(
    choices=[('COMPANY', '–§–∏—Ä–º–∞'), ('PERSON', '–§–∏–∑–∏—á–µ—Å–∫–æ –ª–∏—Ü–µ')]
)
category = models.CharField(
    choices=[('REGULAR', '–†–µ–¥–æ–≤–µ–Ω'), ('VIP', 'VIP'), ('PROBLEMATIC', '–ü—Ä–æ–±–ª–µ–º–µ–Ω')]
)

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –∫—Ä–µ–¥–∏—Ç–∏
credit_limit = CurrencyField()              # –ú–∞–∫—Å–∏–º–∞–ª–µ–Ω —Ä–∞–∑—Ä–µ—à–µ–Ω –∫—Ä–µ–¥–∏—Ç (2dp —Ç–æ—á–Ω–æ—Å—Ç)
payment_delay_days = models.IntegerField()  # –î–Ω–∏ –∑–∞ –æ—Ç–ª–æ–∂–µ–Ω–æ –ø–ª–∞—â–∞–Ω–µ
credit_blocked = models.BooleanField(default=False)  # –ë–ª–æ–∫–∏—Ä–∞–Ω–µ –Ω–∞ –∫—Ä–µ–¥–∏—Ç–Ω–∏ –ø—Ä–æ–¥–∞–∂–±–∏
sales_blocked = models.BooleanField(default=False)   # –ë–ª–æ–∫–∏—Ä–∞–Ω–µ –Ω–∞ –≤—Å–∏—á–∫–∏ –ø—Ä–æ–¥–∞–∂–±–∏

# –¶–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ
price_group = models.ForeignKey('nomenclatures.PriceGroup', null=True, blank=True)
discount_percent = models.DecimalField(max_digits=5, decimal_places=2, default=0)

# –ë–∏–∑–Ω–µ—Å –ª–æ–≥–∏–∫–∞ –º–µ—Ç–æ–¥–∏
def can_buy(self):
    return self.is_active and not self.sales_blocked

def can_buy_on_credit(self):
    return self.can_buy() and not self.credit_blocked and self.credit_limit > 0

def get_effective_discount(self):
    if self.price_group:
        return self.price_group.discount_percentage
    return self.discount_percent or 0
```

### 3. **CustomerSite** (–õ–æ–∫–∞—Ü–∏–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∏)

**–¶–µ–ª**: –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –∞–¥—Ä–µ—Å–∏ –∑–∞ –¥–æ—Å—Ç–∞–≤–∫–∞/—Ñ–∞–∫—Ç—É—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç

```python
# –ò–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç –Ω–∞ —Å–∞–π—Ç–∞
customer = models.ForeignKey(Customer, on_delete=models.CASCADE)
name = models.CharField(max_length=100)  # –ò–º–µ/–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –Ω–∞ —Å–∞–π—Ç–∞

# –ê–¥—Ä–µ—Å–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
city = models.CharField(max_length=50)
address = models.TextField()
contact_person = models.CharField(max_length=100)
phone = models.CharField(max_length=20)
email = models.EmailField(blank=True)

# –¢–∏–ø–æ–≤–µ —Å–∞–π—Ç–æ–≤–µ
is_delivery_address = models.BooleanField(default=True)
is_billing_address = models.BooleanField(default=False)
is_primary = models.BooleanField(default=False)  # –°–∞–º–æ –µ–¥–∏–Ω –Ω–∞ –∫–ª–∏–µ–Ω—Ç

# –°–ø–µ—Ü–∏–∞–ª–Ω–∏ —É—Å–ª–æ–≤–∏—è
special_discount = models.DecimalField(max_digits=5, decimal_places=2, default=0)
```

**–ü—Ä–∞–≤–∏–ª–∞ –∑–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è:**
```python
def clean(self):
    # –ì–∞—Ä–∞–Ω—Ç–∏—Ä–∞–π —Å–∞–º–æ –µ–¥–∏–Ω primary —Å–∞–π—Ç –Ω–∞ –∫–ª–∏–µ–Ω—Ç
    if self.is_primary:
        existing_primary = CustomerSite.objects.filter(
            customer=self.customer,
            is_primary=True
        ).exclude(pk=self.pk)
        
        if existing_primary.exists():
            raise ValidationError('–ö–ª–∏–µ–Ω—Ç—ä—Ç –º–æ–∂–µ –¥–∞ –∏–º–∞ —Å–∞–º–æ –µ–¥–∏–Ω –æ—Å–Ω–æ–≤–µ–Ω —Å–∞–π—Ç')
```

### 4. **Supplier** (–†–∞–∑—à–∏—Ä—è–≤–∞ PartnerBase)

**–¶–µ–ª**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –¥–æ—Å—Ç–∞–≤—á–∏—Ü–∏ —Å –æ—Ç–¥–µ–ª–µ–Ω–∏—è –∏ –≥—Ä–∞—Ñ–∏—Ü–∏ –∑–∞ –¥–æ—Å—Ç–∞–≤–∫–∞

```python
from core.models.fields import CurrencyField

# –§–∏–Ω–∞–Ω—Å–æ–≤–∏ —É—Å–ª–æ–≤–∏—è
credit_limit = CurrencyField()               # –ö—Ä–µ–¥–∏—Ç–µ–Ω –ª–∏–º–∏—Ç —Å –¥–æ—Å—Ç–∞–≤—á–∏–∫–∞ (2dp —Ç–æ—á–Ω–æ—Å—Ç)
payment_days = models.IntegerField()         # –î–Ω–∏ –∑–∞ –ø–ª–∞—â–∞–Ω–µ

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
delivery_blocked = models.BooleanField(default=False)  # –ë–ª–æ–∫–∏—Ä–∞–Ω–µ –Ω–∞ –≤—Å–∏—á–∫–∏ –¥–æ—Å—Ç–∞–≤–∫–∏
can_deliver_today = models.BooleanField(default=False)  # –§–ª–∞–≥ –∑–∞ –±—ä—Ä–∑–∞ –¥–æ—Å—Ç–∞–≤–∫–∞

# –ë–∏–∑–Ω–µ—Å –ª–æ–≥–∏–∫–∞
def can_deliver(self):
    return self.is_active and not self.delivery_blocked

def get_effective_payment_days(self):
    # –ú–æ–∂–µ –¥–∞ —Å–µ –ø—Ä–µ–Ω–∞–ø–∏—Å–≤–∞ –æ—Ç –æ—Ç–¥–µ–ª–µ–Ω–∏–µ
    return self.payment_days
```

### 5. **SupplierDivision** (–û—Ç–¥–µ–ª–µ–Ω–∏—è –Ω–∞ –¥–æ—Å—Ç–∞–≤—á–∏—Ü–∏)

**–¶–µ–ª**: –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω–∏ –æ—Ç–¥–µ–ª–µ–Ω–∏—è –≤ —Ä–∞–º–∫–∏—Ç–µ –Ω–∞ –¥–æ—Å—Ç–∞–≤—á–∏—Ü–∏

```python
supplier = models.ForeignKey(Supplier, on_delete=models.CASCADE)
name = models.CharField(max_length=100)      # –ò–º–µ –Ω–∞ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ—Ç–æ
code = models.CharField(max_length=20)       # –ö–æ–¥ –Ω–∞ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ—Ç–æ

# Division-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∏ —É—Å–ª–æ–≤–∏—è
payment_days = models.IntegerField(null=True, blank=True)  # –ü—Ä–µ–Ω–∞–ø–∏—Å–≤–∞ —É—Å–ª–æ–≤–∏—è—Ç–∞ –∑–∞ –ø–ª–∞—â–∞–Ω–µ –Ω–∞ –¥–æ—Å—Ç–∞–≤—á–∏–∫–∞
contact_person = models.CharField(max_length=100)
phone = models.CharField(max_length=20)
email = models.EmailField(blank=True)

def get_effective_payment_days(self):
    return self.payment_days or self.supplier.payment_days
```

### 6. **–ì—Ä–∞—Ñ–∏—Ü–∏ –Ω–∞ –ø–∞—Ä—Ç–Ω—å–æ—Ä–∏** (–°–µ–¥–º–∏—á–Ω–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏)

**–ì—Ä–∞—Ñ–∏–∫ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∏:**
```python
class CustomerDaySchedule(models.Model):
    customer = models.ForeignKey(Customer, on_delete=models.CASCADE)
    day = models.CharField(
        max_length=3,
        choices=[('mon', '–ü–æ–Ω–µ–¥–µ–ª–Ω–∏–∫'), ('tue', '–í—Ç–æ—Ä–Ω–∏–∫'), ('wed', '–°—Ä—è–¥–∞'), 
                ('thu', '–ß–µ—Ç–≤—ä—Ä—Ç—ä–∫'), ('fri', '–ü–µ—Ç—ä–∫'), ('sat', '–°—ä–±–æ—Ç–∞'), ('sun', '–ù–µ–¥–µ–ª—è')]
    )
    
    # –î–µ–π–Ω–æ—Å—Ç–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞
    expects_order = models.BooleanField(default=False)     # –ü—Ä–∞–≤–∏ –ø–æ—Ä—ä—á–∫–∏ —Ç–æ–∑–∏ –¥–µ–Ω
    expects_delivery = models.BooleanField(default=False)  # –û—á–∞–∫–≤–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ —Ç–æ–∑–∏ –¥–µ–Ω
    
    # –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–Ω–∏—è –∑–∞ –≤—Ä–µ–º–µ
    preferred_delivery_time_from = models.TimeField(null=True, blank=True)
    preferred_delivery_time_to = models.TimeField(null=True, blank=True)
```

**–ì—Ä–∞—Ñ–∏–∫ –Ω–∞ –¥–æ—Å—Ç–∞–≤—á–∏—Ü–∏:**
```python  
class SupplierDaySchedule(models.Model):
    supplier = models.ForeignKey(Supplier, on_delete=models.CASCADE)
    day = models.CharField(
        max_length=3,
        choices=[('mon', '–ü–æ–Ω–µ–¥–µ–ª–Ω–∏–∫'), ('tue', '–í—Ç–æ—Ä–Ω–∏–∫'), ('wed', '–°—Ä—è–¥–∞'),
                ('thu', '–ß–µ—Ç–≤—ä—Ä—Ç—ä–∫'), ('fri', '–ü–µ—Ç—ä–∫'), ('sat', '–°—ä–±–æ—Ç–∞'), ('sun', '–ù–µ–¥–µ–ª—è')]
    )
    
    # –î–µ–π–Ω–æ—Å—Ç–∏ –Ω–∞ –¥–æ—Å—Ç–∞–≤—á–∏–∫–∞
    expects_order = models.BooleanField(default=False)     # –ü—Ä–∏–µ–º–∞ –ø–æ—Ä—ä—á–∫–∏ —Ç–æ–∑–∏ –¥–µ–Ω
    makes_delivery = models.BooleanField(default=False)    # –ü—Ä–∞–≤–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ —Ç–æ–∑–∏ –¥–µ–Ω
    
    # –ö—Ä–∞–π–Ω–∏ —Å—Ä–æ–∫–æ–≤–µ –∑–∞ –ø–æ—Ä—ä—á–∫–∏
    order_deadline_time = models.TimeField(null=True, blank=True)  # –ö—Ä–∞–µ–Ω —Å—Ä–æ–∫ –∑–∞ –ø–æ—Ä—ä—á–∫–∏
    delivery_time_from = models.TimeField(null=True, blank=True)
    delivery_time_to = models.TimeField(null=True, blank=True)
```

---

## –£—Å–ª—É–≥–∏

### 1. **CustomerService** (Result Pattern)

```python
from partners.services import CustomerService

# –ü–æ–ª—É—á–∞–≤–∞ –∏–∑—á–µ—Ä–ø–∞—Ç–µ–ª–Ω–∏ –¥–∞–Ω–Ω–∏ –∑–∞ dashboard –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞
result = CustomerService.get_dashboard_data(customer_id=42)
if result.ok:
    dashboard = result.data
    basic_info = dashboard['basic_info']
    financial = dashboard['financial']
    sites = dashboard['sites']
    schedule = dashboard['schedule']
    statistics = dashboard['statistics']
```

**–ö–ª—é—á–æ–≤–∏ –º–µ—Ç–æ–¥–∏:**
- `get_dashboard_data(customer_id)` - –ü—ä–ª–µ–Ω –ø—Ä–µ–≥–ª–µ–¥ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞
- `get_financial_data(customer)` - –ò–∑–ø–æ–ª–∑–≤–∞–Ω–µ –Ω–∞ –∫—Ä–µ–¥–∏—Ç, –∏—Å—Ç–æ—Ä–∏—è –Ω–∞ –ø–ª–∞—â–∞–Ω–∏—è
- `get_sites_data(customer)` - –í—Å–∏—á–∫–∏ –ª–æ–∫–∞—Ü–∏–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞
- `get_schedule_data(customer)` - –°–µ–¥–º–∏—á–µ–Ω –≥—Ä–∞—Ñ–∏–∫ –∑–∞ –ø–æ—Ä—ä—á–∫–∏/–¥–æ—Å—Ç–∞–≤–∫–∏
- `get_statistics_data(customer)` - –ê–Ω–∞–ª–∏–∑–∏ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—è—Ç–∞ –Ω–∞ –ø–æ–∫—É–ø–∫–∏
- `validate_customer_operation(customer, amount)` - –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫—Ä–µ–¥–∏—Ç/–ø—Ä–æ–¥–∞–∂–±–∏

### 2. **SupplierService** (Result Pattern)

```python
from partners.services import SupplierService

# –ü–æ–ª—É—á–∞–≤–∞ dashboard –Ω–∞ –¥–æ—Å—Ç–∞–≤—á–∏–∫–∞ —Å –≤—Å–∏—á–∫–∏ –æ—Ç–¥–µ–ª–µ–Ω–∏—è
result = SupplierService.get_dashboard_data(supplier_id=15)
if result.ok:
    dashboard = result.data
    basic_info = dashboard['basic_info']
    divisions = dashboard['divisions']
    financial = dashboard['financial']
    deliveries = dashboard['deliveries']

# –í–∞–ª–∏–¥–∏—Ä–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –∑–∞ –ø–æ–∫—É–ø–∫–∞
validation = SupplierService.validate_supplier_operation(
    supplier=supplier,
    amount=Decimal('5000.00')
)
if not validation.ok:
    handle_supplier_error(validation.code, validation.msg)
```

**–ö–ª—é—á–æ–≤–∏ –º–µ—Ç–æ–¥–∏:**
- `get_dashboard_data(supplier_id)` - –ü—ä–ª–µ–Ω –ø—Ä–µ–≥–ª–µ–¥ –Ω–∞ –¥–æ—Å—Ç–∞–≤—á–∏–∫–∞
- `get_divisions_data(supplier)` - –ê–∫—Ç–∏–≤–Ω–∏ –æ—Ç–¥–µ–ª–µ–Ω–∏—è –∏ —É—Å–ª–æ–≤–∏—è
- `get_financial_data(supplier)` - –ò–∑–ø–æ–ª–∑–≤–∞–Ω–µ –Ω–∞ –∫—Ä–µ–¥–∏—Ç, –Ω–µ–ø–ª–∞—Ç–µ–Ω–∏ –ø–æ—Ä—ä—á–∫–∏
- `get_delivery_data(supplier, date_range)` - –ò—Å—Ç–æ—Ä–∏—è –Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
- `get_statistics_data(supplier)` - –ê–Ω–∞–ª–∏–∑–∏ –Ω–∞ –æ–±–µ–º–∞ –Ω–∞ –ø–æ–∫—É–ø–∫–∏
- `validate_supplier_operation(supplier, amount)` - –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫—Ä–µ–¥–∏—Ç–µ–Ω –ª–∏–º–∏—Ç

---

## –ë–∏–∑–Ω–µ—Å –ª–æ–≥–∏–∫–∞

### 1. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –∫—Ä–µ–¥–∏—Ç–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∏**

```python
from core.models.fields import CurrencyField
from core.utils.decimal_utils import round_currency

class Customer:
    def can_buy(self):
        """–û—Å–Ω–æ–≤–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞ –ø–æ–∫—É–ø–∫–∞"""
        return self.is_active and not self.sales_blocked
        
    def can_buy_on_credit(self):
        """–í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞ –∫—Ä–µ–¥–∏—Ç–Ω–∞ –ø–æ–∫—É–ø–∫–∞"""
        return (self.can_buy() and 
                not self.credit_blocked and 
                self.credit_limit > 0)

    def get_available_credit(self):
        """–ü–æ–ª—É—á–∞–≤–∞ –Ω–∞–ª–∏—á–µ–Ω –∫—Ä–µ–¥–∏—Ç —Å –ø—Ä–∞–≤–∏–ª–Ω–∞ –¥–µ—Å–µ—Ç–∏—á–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç"""
        used_credit = self.get_used_credit()  # 2dp —Ç–æ—á–Ω–æ—Å—Ç
        available = self.credit_limit - used_credit
        return round_currency(max(available, Decimal('0.00')))

# Service-–Ω–∏–≤–æ –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫—Ä–µ–¥–∏—Ç
def validate_customer_operation(customer, amount):
    """–í–∞–ª–∏–¥–∏—Ä–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏—è —Å –ø—Ä–∞–≤–∏–ª–Ω–∞ –¥–µ—Å–µ—Ç–∏—á–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç"""
    if not customer.can_buy():
        return Result.error('CUSTOMER_BLOCKED', '–ö–ª–∏–µ–Ω—Ç—ä—Ç –Ω–µ –º–æ–∂–µ –¥–∞ –ø—Ä–∞–≤–∏ –ø–æ–∫—É–ø–∫–∏')
    
    # –ì–∞—Ä–∞–Ω—Ç–∏—Ä–∞–π –ø—Ä–∞–≤–∏–ª–Ω–∞ –¥–µ—Å–µ—Ç–∏—á–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç –∑–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ—Ç–æ
    amount = round_currency(amount)
    available_credit = customer.get_available_credit()
        
    if amount > available_credit:
        return Result.error(
            'CREDIT_EXCEEDED', 
            f'–ü–æ–∫—É–ø–∫–∞—Ç–∞ {amount} –Ω–∞–¥–≤–∏—à–∞–≤–∞ –Ω–∞–ª–∏—á–Ω–∏—è –∫—Ä–µ–¥–∏—Ç {available_credit}'
        )
        
    return Result.success()
```

### 2. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ –Ω–∞ –¥–æ—Å—Ç–∞–≤—á–∏—Ü–∏**

```python
class Supplier:
    def can_deliver(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ –≤—ä–∑–º–æ–∂–Ω–æ—Å—Ç –∑–∞ –¥–æ—Å—Ç–∞–≤–∫–∞"""
        return self.is_active and not self.delivery_blocked

# –ü–æ–ª—É—á–∞–≤–∞ –¥–Ω–µ—à–Ω–∏—Ç–µ –¥–æ—Å—Ç–∞–≤—á–∏—Ü–∏ –∑–∞ –¥–æ—Å—Ç–∞–≤–∫–∞
def get_today_delivery_suppliers():
    """–í—Ä—ä—â–∞ –¥–æ—Å—Ç–∞–≤—á–∏—Ü–∏ –∫–æ–∏—Ç–æ –¥–æ—Å—Ç–∞–≤—è—Ç –¥–Ω–µ—Å"""
    today = timezone.now().strftime('%a').lower()[:3]  # 'mon', 'tue', –∏ —Ç.–Ω.
    
    return Supplier.objects.filter(
        day_schedules__day=today,
        day_schedules__makes_delivery=True,
        is_active=True,
        delivery_blocked=False
    ).distinct()
```

### 3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–∞ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ—Ç–æ**

```python
class Customer:
    def get_effective_discount(self):
        """–ü–æ–ª—É—á–∞–≤–∞ –ø—Ä–∏–ª–æ–∂–∏–º –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç—Å—Ç—ä–ø–∫–∞"""
        # –¶–µ–Ω–æ–≤–∞—Ç–∞ –≥—Ä—É–ø–∞ –∏–º–∞ –ø—Ä–µ–¥–∏–º—Å—Ç–≤–æ
        if self.price_group and hasattr(self.price_group, 'discount_percentage'):
            return self.price_group.discount_percentage
        
        # Fallback –∫—ä–º –¥–∏—Ä–µ–∫—Ç–Ω–∞ –æ—Ç—Å—Ç—ä–ø–∫–∞
        return self.discount_percent or 0

# –ò–∑–ø–æ–ª–∑–≤–∞–Ω–µ –≤ pricing service
def calculate_customer_price(base_price, customer):
    """–ö–∞–ª–∫—É–ª–∏—Ä–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∞ —Ü–µ–Ω–∞ —Å –ø—Ä–∞–≤–∏–ª–Ω–∞ –¥–µ—Å–µ—Ç–∏—á–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç"""
    from core.utils.decimal_utils import round_currency
    
    discount = customer.get_effective_discount()
    discounted_price = base_price * (1 - discount / 100)
    return round_currency(discounted_price)
```

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–∏ —Ç–æ—á–∫–∏

### **–° PRICING App:**

```python
# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∞ —Ü–µ–Ω–æ–≤–∞ –≥—Ä—É–ø–∞
class Customer:
    price_group = models.ForeignKey('nomenclatures.PriceGroup', null=True, blank=True)
    discount_percent = models.DecimalField(max_digits=5, decimal_places=2, default=0)
    
    def get_effective_discount(self):
        if self.price_group:
            return self.price_group.discount_percentage
        return self.discount_percent or 0

# –ò–∑–ø–æ–ª–∑–≤–∞–Ω–æ –≤ PricingService
def get_customer_pricing(location, product, customer):
    if customer and customer.price_group:
        group_price = ProductPriceByGroup.objects.filter(
            location=location,
            product=product,
            customer_group=customer.price_group
        ).first()
        
        if group_price:
            return group_price.price  # –í–µ—á–µ —Å 2dp —Ç–æ—á–Ω–æ—Å—Ç
    return None
```

### **–° PURCHASES App:**

```python
# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–∞ –¥–æ—Å—Ç–∞–≤—á–∏—Ü–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∏ –∑–∞ –ø–æ–∫—É–ø–∫–∞
class PurchaseOrder:
    supplier = models.ForeignKey('partners.Supplier')
    
    def clean(self):
        # –í–∞–ª–∏–¥–∏—Ä–∞ —á–µ –¥–æ—Å—Ç–∞–≤—á–∏–∫—ä—Ç –º–æ–∂–µ –¥–∞ –¥–æ—Å—Ç–∞–≤—è
        if not self.supplier.can_deliver():
            raise ValidationError('–î–æ—Å—Ç–∞–≤–∫–∞—Ç–∞ –Ω–∞ –¥–æ—Å—Ç–∞–≤—á–∏–∫–∞ –µ –±–ª–æ–∫–∏—Ä–∞–Ω–∞')

# –§–∏–Ω–∞–Ω—Å–æ–≤–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
def get_supplier_financial_data(supplier):
    """–ü–æ–ª—É—á–∞–≤–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∏ –¥–∞–Ω–Ω–∏ –∑–∞ –¥–æ—Å—Ç–∞–≤—á–∏–∫ —Å –ø—Ä–∞–≤–∏–ª–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç"""
    from core.utils.decimal_utils import round_currency
    
    # –ü–æ–ª—É—á–∏ –Ω–µ–ø–ª–∞—Ç–µ–Ω–∏ –ø–æ—Ä—ä—á–∫–∏ –∑–∞ –ø–æ–∫—É–ø–∫–∞
    unpaid_orders = PurchaseOrder.objects.filter(
        supplier=supplier,
        status__in=['pending', 'approved']
    ).aggregate(
        unpaid_amount=Sum('total'),
        unpaid_count=Count('id')
    )
    
    # –ü—Ä–æ–≤–µ—Ä–∏ –Ω–∞–ª–∏—á–Ω–æ—Å—Ç –Ω–∞ –∫—Ä–µ–¥–∏—Ç
    used_credit = unpaid_orders['unpaid_amount'] or Decimal('0.00')
    used_credit = round_currency(used_credit)  # –ì–∞—Ä–∞–Ω—Ç–∏—Ä–∞–π 2dp —Ç–æ—á–Ω–æ—Å—Ç
    
    available_credit = round_currency(supplier.credit_limit - used_credit)
    
    return {
        'used_credit': used_credit,
        'available_credit': available_credit,
        'unpaid_count': unpaid_orders['unpaid_count']
    }
```

---

## –®–∞–±–ª–æ–Ω–∏ –∑–∞ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ

### 1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç —Å—ä—Å —Å–∞–π—Ç–æ–≤–µ**

```python
from core.utils.decimal_utils import Decimal

# –°—ä–∑–¥–∞–π –∫–ª–∏–µ–Ω—Ç
customer = Customer.objects.create(
    code='ACME001',
    name='–ê–ö–ú–ï –ö–æ—Ä–ø–æ—Ä–µ–π—à—ä–Ω',
    type=Customer.COMPANY,
    vat_number='BG123456789',
    credit_limit=Decimal('10000.00'),  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ 2dp —Ç–æ—á–Ω–æ—Å—Ç
    payment_delay_days=30,
    price_group=wholesale_group,
    category=Customer.VIP
)

# –î–æ–±–∞–≤–∏ –æ—Å–Ω–æ–≤–µ–Ω —Å–∞–π—Ç
primary_site = CustomerSite.objects.create(
    customer=customer,
    name='–¶–µ–Ω—Ç—Ä–∞–ª–∞',
    city='–°–æ—Ñ–∏—è',
    address='–ë–∏–∑–Ω–µ—Å –ø–∞—Ä–∫, –°–≥—Ä–∞–¥–∞ –ê',
    contact_person='–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤',
    phone='+359888123456',
    is_primary=True,
    is_delivery_address=True,
    is_billing_address=True
)

# –î–æ–±–∞–≤–∏ –≥—Ä–∞—Ñ–∏–∫ –∑–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
CustomerDaySchedule.objects.create(
    customer=customer,
    day='tue',  # –í—Ç–æ—Ä–Ω–∏–∫
    expects_order=True,
    expects_delivery=False
)

CustomerDaySchedule.objects.create(
    customer=customer,
    day='fri',  # –ü–µ—Ç—ä–∫
    expects_delivery=True,
    preferred_delivery_time_from='09:00',
    preferred_delivery_time_to='17:00'
)
```

### 2. **–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç –≤ –ø—Ä–æ–¥–∞–∂–±–∏**

```python
from core.utils.decimal_utils import round_currency

def process_sales_order(customer, order_data):
    """–û–±—Ä–∞–±–æ—Ç–≤–∞ –ø–æ—Ä—ä—á–∫–∞ –∑–∞ –ø—Ä–æ–¥–∞–∂–±–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞"""
    # –í–∞–ª–∏–¥–∏—Ä–∞ —á–µ –∫–ª–∏–µ–Ω—Ç—ä—Ç –º–æ–∂–µ –¥–∞ –∫—É–ø—É–≤–∞
    if not customer.can_buy():
        return Result.error(
            'CUSTOMER_BLOCKED',
            f'–ö–ª–∏–µ–Ω—Ç {customer.name} –µ –±–ª–æ–∫–∏—Ä–∞–Ω –æ—Ç –ø–æ–∫—É–ø–∫–∏'
        )
    
    # –í–∞–ª–∏–¥–∏—Ä–∞ –∫—Ä–µ–¥–∏—Ç –∑–∞ –∫—Ä–µ–¥–∏—Ç–Ω–∏ –ø—Ä–æ–¥–∞–∂–±–∏
    if order_data['payment_method'] == 'CREDIT':
        if not customer.can_buy_on_credit():
            return Result.error(
                'CREDIT_BLOCKED', 
                '–ö—Ä–µ–¥–∏—Ç—ä—Ç –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞ –µ –±–ª–æ–∫–∏—Ä–∞–Ω –∏–ª–∏ –ª–∏–º–∏—Ç—ä—Ç –µ –Ω—É–ª–∞'
            )
        
        # –ü—Ä–æ–≤–µ—Ä–∏ —Å—É–º–∞ —Å–ø—Ä—è–º–æ –ª–∏–º–∏—Ç —Å –ø—Ä–∞–≤–∏–ª–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç
        order_total = round_currency(order_data['total'])
        available_credit = customer.get_available_credit()
        
        if order_total > available_credit:
            return Result.error(
                'CREDIT_EXCEEDED',
                f'–û–±—â–æ –ø–æ—Ä—ä—á–∫–∞ {order_total} –Ω–∞–¥–≤–∏—à–∞–≤–∞ –∫—Ä–µ–¥–∏—Ç–µ–Ω –ª–∏–º–∏—Ç {available_credit}'
            )
    
    # –ü—Ä–∏–ª–∞–≥–∞–π –∫–ª–∏–µ–Ω—Ç—Å–∫–∞ –æ—Ç—Å—Ç—ä–ø–∫–∞
    discount = customer.get_effective_discount()
    if discount > 0:
        order_data['discount_percent'] = discount
    
    return Result.success(data=order_data)
```

### 3. **–†–∞–±–æ—Ç–∞ —Å –¥–µ—Å–µ—Ç–∏—á–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç –≤ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∏—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**

```python
from core.utils.decimal_utils import round_currency

class CustomerService:
    @staticmethod
    def calculate_customer_financial_summary(customer):
        """–ö–∞–ª–∫—É–ª–∏—Ä–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ —Ä–µ–∑—é–º–µ —Å –ø—Ä–∞–≤–∏–ª–Ω–∞ –¥–µ—Å–µ—Ç–∏—á–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç"""
        from django.db.models import Sum
        
        # –ü–æ–ª—É—á–∏ —Å—É–º–∏—Ç–µ —Å database aggregation
        financial_data = SalesOrder.objects.filter(
            customer=customer
        ).aggregate(
            total_orders=Sum('total_amount'),
            unpaid_amount=Sum('unpaid_amount')
        )
        
        # –ì–∞—Ä–∞–Ω—Ç–∏—Ä–∞–π –ø—Ä–∞–≤–∏–ª–Ω–∞ –¥–µ—Å–µ—Ç–∏—á–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç
        total_orders = financial_data['total_orders'] or Decimal('0.00')
        unpaid_amount = financial_data['unpaid_amount'] or Decimal('0.00')
        
        total_orders = round_currency(total_orders)      # 2dp —Ç–æ—á–Ω–æ—Å—Ç
        unpaid_amount = round_currency(unpaid_amount)    # 2dp —Ç–æ—á–Ω–æ—Å—Ç
        
        # –ö–∞–ª–∫—É–ª–∏—Ä–∞–π –Ω–∞–ª–∏—á–µ–Ω –∫—Ä–µ–¥–∏—Ç
        used_credit = unpaid_amount
        available_credit = round_currency(customer.credit_limit - used_credit)
        
        return {
            'credit_limit': customer.credit_limit,       # –í–µ—á–µ —Å 2dp —Ç–æ—á–Ω–æ—Å—Ç
            'used_credit': used_credit,                  # 2dp —Ç–æ—á–Ω–æ—Å—Ç
            'available_credit': available_credit,        # 2dp —Ç–æ—á–Ω–æ—Å—Ç
            'total_orders_amount': total_orders,         # 2dp —Ç–æ—á–Ω–æ—Å—Ç
            'unpaid_amount': unpaid_amount              # 2dp —Ç–æ—á–Ω–æ—Å—Ç
        }
```

---

## API —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫

### Result —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –æ—Ç –¥–∞–Ω–Ω–∏

**Customer Dashboard:**
```python
{
    'basic_info': {
        'id': 42,
        'name': '–ê–ö–ú–ï –ö–æ—Ä–ø–æ—Ä–µ–π—à—ä–Ω',
        'code': 'ACME001',
        'type': 'COMPANY',
        'category': 'VIP',
        'is_active': True,
        'sales_blocked': False,
        'credit_blocked': False,
        'can_buy': True,
        'can_buy_on_credit': True
    },
    'financial': {
        'credit_limit': Decimal('10000.00'),        # 2dp —Ç–æ—á–Ω–æ—Å—Ç
        'used_credit': Decimal('2500.00'),          # 2dp —Ç–æ—á–Ω–æ—Å—Ç
        'available_credit': Decimal('7500.00'),     # 2dp —Ç–æ—á–Ω–æ—Å—Ç
        'payment_delay_days': 30,
        'total_orders_amount': Decimal('25000.00'), # 2dp —Ç–æ—á–Ω–æ—Å—Ç
        'unpaid_amount': Decimal('2500.00')         # 2dp —Ç–æ—á–Ω–æ—Å—Ç
    },
    'sites': [
        {
            'id': 1,
            'name': '–¶–µ–Ω—Ç—Ä–∞–ª–∞',
            'city': '–°–æ—Ñ–∏—è',
            'address': '–ë–∏–∑–Ω–µ—Å –ø–∞—Ä–∫, –°–≥—Ä–∞–¥–∞ –ê',
            'is_primary': True,
            'is_delivery_address': True,
            'special_discount': Decimal('0.00')      # 2dp —Ç–æ—á–Ω–æ—Å—Ç
        }
    ],
    'schedule': {
        'order_days': ['tue'],
        'delivery_days': ['fri'],
        'delivery_preferences': [
            {
                'day': 'fri',
                'time_from': '09:00',
                'time_to': '17:00'
            }
        ]
    }
}
```

**Supplier Dashboard:**
```python
{
    'basic_info': {
        'id': 15,
        'name': '–ü—Ä–µ–º–∏—É–º –î–∏—Å—Ç—Ä–∏–±—É—Ç–æ—Ä –û–û–î',
        'code': 'DIST001',
        'contact_person': '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤',
        'is_active': True,
        'delivery_blocked': False,
        'can_deliver': True
    },
    'divisions': [
        {
            'id': 5,
            'name': '–û—Ç–¥–µ–ª–µ–Ω–∏–µ —Ö—Ä–∞–Ω–∏',
            'code': 'FOODS',
            'contact_person': '–ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–∞',
            'payment_days': 30
        }
    ],
    'financial': {
        'credit_limit': Decimal('50000.00'),        # 2dp —Ç–æ—á–Ω–æ—Å—Ç
        'used_credit': Decimal('15000.00'),         # 2dp —Ç–æ—á–Ω–æ—Å—Ç
        'available_credit': Decimal('35000.00'),    # 2dp —Ç–æ—á–Ω–æ—Å—Ç
        'payment_days': 45,
        'total_orders_amount': Decimal('125000.00'), # 2dp —Ç–æ—á–Ω–æ—Å—Ç
        'unpaid_count': 5
    },
    'schedule': {
        'order_days': [
            {
                'day': 'mon',
                'deadline': '14:00'
            }
        ],
        'delivery_days': [
            {
                'day': 'wed',
                'time_from': '08:00',
                'time_to': '16:00'
            }
        ]
    }
}
```

---

## –ù–∞–π-–¥–æ–±—Ä–∏ –ø—Ä–∞–∫—Ç–∏–∫–∏

### 1. **–í–∏–Ω–∞–≥–∏ –∏–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ Result Pattern**

```python
# ‚úÖ –î–æ–±—Ä–æ
result = CustomerService.get_dashboard_data(customer_id)
if result.ok:
    dashboard = result.data
    financial = dashboard['financial']
else:
    handle_error(result.code, result.msg)

# ‚ùå –ò–∑–±—è–≥–≤–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–µ–Ω –¥–æ—Å—Ç—ä–ø –¥–æ –º–æ–¥–µ–ª –∑–∞ —Å–ª–æ–∂–Ω–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏
try:
    customer = Customer.objects.get(id=customer_id)
    # –†—ä—á–Ω–æ –∏–∑–≥—Ä–∞–∂–¥–∞–Ω–µ –Ω–∞ dashboard - –ª–∏–ø—Å–≤–∞ error handling, –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç
except Customer.DoesNotExist:
    pass
```

### 2. **–ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª–Ω–∞—Ç–∞ –¥–µ—Å–µ—Ç–∏—á–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç**

```python
# ‚úÖ –î–æ–±—Ä–æ - –∏–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–∞–Ω–∏—Ç–µ —É—Ç–∏–ª–∏—Ç–∏
from core.utils.decimal_utils import round_currency

def calculate_customer_discount(base_price, discount_percent):
    # –ö–∞–ª–∫—É–ª–∏—Ä–∞–π —Å –≤–∏—Å–æ–∫–∞ —Ç–æ—á–Ω–æ—Å—Ç
    discount_amount = base_price * (discount_percent / 100)
    
    # –ó–∞–∫—Ä—ä–≥–ª–∏ –∑–∞ –¥–∏—Å–ø–ª–µ–π/—Å—ä—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    final_discount = round_currency(discount_amount)  # 2dp —Ç–æ—á–Ω–æ—Å—Ç
    final_price = round_currency(base_price - final_discount)
    
    return final_price, final_discount

# ‚ùå –ò–∑–±—è–≥–≤–∞–π—Ç–µ - —Ä—ä—á–Ω–æ –∑–∞–∫—Ä—ä–≥–ª—è–≤–∞–Ω–µ
discount = round(base_price * 0.15, 2)  # –ú–æ–∂–µ –¥–∞ –∏–º–∞ –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç–∏
```

### 3. **–í–∞–ª–∏–¥–∏—Ä–∞–π—Ç–µ –±–∏–∑–Ω–µ—Å –æ–ø–µ—Ä–∞—Ü–∏–∏**

```python
# ‚úÖ –î–æ–±—Ä–æ - –≤–∞–ª–∏–¥–∏—Ä–∞–π—Ç–µ –ø—Ä–µ–¥–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞
validation = CustomerService.validate_customer_operation(customer, amount)
if validation.ok:
    proceed_with_sale(customer, amount)
else:
    return validation

# ‚ùå –ò–∑–±—è–≥–≤–∞–π—Ç–µ –ø—Ä–µ—Å–∫–∞—á–∞–Ω–µ –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è
if customer.is_active:  # –ù–µ–ø—ä–ª–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è
    proceed_with_sale(customer, amount)
```

### 4. **–û–±—Ä–∞–±–æ—Ç–≤–∞–π—Ç–µ —Å–∞–π—Ç–æ–≤–µ—Ç–µ –ø—Ä–∞–≤–∏–ª–Ω–æ**

```python
# ‚úÖ –î–æ–±—Ä–æ - –ø–æ–ª—É—á–∏ –ø–æ–¥—Ö–æ–¥—è—â —Å–∞–π—Ç
delivery_site = customer.sites.filter(is_delivery_address=True).first()
if not delivery_site:
    delivery_site = customer.sites.filter(is_primary=True).first()

billing_site = customer.sites.filter(is_billing_address=True).first()
if not billing_site:
    billing_site = customer.sites.filter(is_primary=True).first()

# ‚ùå –ò–∑–±—è–≥–≤–∞–π—Ç–µ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏—è —á–µ —Å–∞–π—Ç–æ–≤–µ—Ç–µ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—Ç
delivery_address = customer.sites.first().address  # –ú–æ–∂–µ –¥–∞ —Å–µ –ø—Ä–æ–≤–∞–ª–∏
```

---

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**PARTNERS app –∑–∞–≤–∏—Å–∏ –æ—Ç:**
- Django framework
- CORE app (Result pattern, –¥–µ—Å–µ—Ç–∏—á–Ω–∏ —É—Ç–∏–ª–∏—Ç–∏)
- NOMENCLATURES app (PriceGroup –º–æ–¥–µ–ª)

**–î—Ä—É–≥–∏ apps –∑–∞–≤–∏—Å—è—Ç –æ—Ç PARTNERS:**
- PURCHASES (Supplier –º–æ–¥–µ–ª)
- SALES (Customer –º–æ–¥–µ–ª)  
- PRICING (–∫–ª–∏–µ–Ω—Ç—Å–∫–æ –≥—Ä—É–ø–æ–≤–æ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ)
- REPORTS (–∞–Ω–∞–ª–∏–∑–∏ –Ω–∞ –ø–∞—Ä—Ç–Ω—å–æ—Ä–∏)

---

## –ò—Å—Ç–æ—Ä–∏—è –Ω–∞ –≤–µ—Ä—Å–∏–∏—Ç–µ

- **v1.0** - –û—Å–Ω–æ–≤–Ω–∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏ –∏ –¥–æ—Å—Ç–∞–≤—á–∏—á–µ—Å–∫–∏ –º–æ–¥–µ–ª–∏
- **v1.1** - –î–æ–±–∞–≤–µ–Ω–∞ multi-site –ø–æ–¥–¥—Ä—ä–∂–∫–∞ –∑–∞ –∫–ª–∏–µ–Ω—Ç–∏
- **v1.2** - –î–æ–±–∞–≤–µ–Ω–∏ –æ—Ç–¥–µ–ª–µ–Ω–∏—è –Ω–∞ –¥–æ—Å—Ç–∞–≤—á–∏—Ü–∏
- **v1.3** - –î–æ–±–∞–≤–µ–Ω–∏ —Å–µ–¥–º–∏—á–Ω–∏ –≥—Ä–∞—Ñ–∏—Ü–∏
- **v1.4** - –ü–æ–¥–æ–±—Ä–µ–Ω–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –∫—Ä–µ–¥–∏—Ç–∏
- **v1.5** - –î–æ–±–∞–≤–µ–Ω–∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ VIP —Å—Ç–∞—Ç—É—Å
- **v2.0** - Result pattern service —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ä–∞–Ω–µ
- **v2.1** - –ü–æ–¥–æ–±—Ä–µ–Ω–∏ dashboard –∏ –∞–Ω–∞–ª–∏–∑–∏
- **v3.0** - –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–∞–Ω–∞ –¥–µ—Å–µ—Ç–∏—á–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç, –ø–æ–¥–æ–±—Ä–µ–Ω–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞ —Ç–æ—á–Ω–æ—Å—Ç

---

*–ü–æ—Å–ª–µ–¥–Ω–∞ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è: 2025-09-05*  
*–í–µ—Ä—Å–∏—è: 3.0*  
*–ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞–Ω–æ —Å–ø–æ—Ä–µ–¥ –∞–∫—Ç—É–∞–ª–Ω–∏—è –∫–æ–¥ —Å –¥–µ—Å–µ—Ç–∏—á–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç*