{% load static %}
<!DOCTYPE html>
<html class="h-full" data-kt-theme="true" data-kt-theme-mode="light" dir="ltr" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token }}">

    <title>{% block title %}FreshMart - Система за доставки{% endblock %}</title>

    <!-- Favicons -->
    <link href="{% static 'media/app/apple-touch-icon.png' %}" rel="apple-touch-icon" sizes="180x180"/>
    <link href="{% static 'media/app/favicon-32x32.png' %}" rel="icon" sizes="32x32" type="image/png"/>
    <link href="{% static 'media/app/favicon-16x16.png' %}" rel="icon" sizes="16x16" type="image/png"/>
    <link href="{% static 'media/app/favicon.ico' %}" rel="shortcut icon"/>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>

    <!-- Vendor Styles -->
    <link href="{% static 'vendors/apexcharts/apexcharts.css' %}" rel="stylesheet"/>
    <link href="{% static 'vendors/keenicons/styles.bundle.css' %}" rel="stylesheet"/>

    <!-- Main Styles -->
    <link href="{% static 'css/styles.css' %}" rel="stylesheet"/>

    <!-- Tailwind CSS (ако използваш) -->
    <script src="https://cdn.tailwindcss.com"></script>

    {% block extra_css %}{% endblock %}
</head>
<body class="antialiased flex h-full text-base text-foreground bg-background demo1 kt-sidebar-fixed kt-header-fixed">
{#    {% include 'frontend/base/partials/theme-mode.html' %}#}

    <!-- Page -->
    <!-- Main -->
    <div class="flex grow">
        {% include 'frontend/base/partials/sidebar.html' %}

        <!-- Wrapper -->
        <div class="kt-wrapper flex grow flex-col">
            {% include 'frontend/base/partials/header.html' %}

            <!-- Content -->
            <main class="grow pt-5" id="content" role="content">
                {% block content %}{% endblock %}
            </main>
            <!-- End of Content -->

            {% include 'frontend/base/partials/footer.html' %}
        </div>
        <!-- End of Wrapper -->
    </div>
    <!-- End of Main -->
    <!-- End of Page -->

     <!-- Main Content -->


    <!-- Core Scripts -->
    <script src="{% static 'js/core.bundle.js' %}"></script>

    <!-- Vendor Scripts -->
    <script src="{% static 'vendors/ktui/ktui.min.js' %}"></script>
    <script src="{% static 'vendors/apexcharts/apexcharts.min.js' %}"></script>

    <!-- App Scripts -->
    <script src="{% static 'js/widgets/general.js' %}"></script>
    <script src="{% static 'js/layouts/demo1.js' %}"></script>

    <!-- Django CSRF Token for AJAX -->
    <script>
        // Глобална променлива за CSRF token
        window.CSRF_TOKEN = "{{ csrf_token }}";

        // Функция за получаване на CSRF token от cookie
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // Настройка на AJAX за Django
        const csrftoken = getCookie('csrftoken');

        // Ако използваш jQuery
        if (typeof $ !== 'undefined') {
            $.ajaxSetup({
                beforeSend: function(xhr, settings) {
                    if (!(/^(GET|HEAD|OPTIONS|TRACE)$/.test(settings.type)) && !this.crossDomain) {
                        xhr.setRequestHeader("X-CSRFToken", csrftoken);
                    }
                }
            });
        }

        // За fetch API
        window.djangoFetch = function(url, options = {}) {
            options.headers = options.headers || {};
            options.headers['X-CSRFToken'] = csrftoken;
            return fetch(url, options);
        };
    </script>

    {% block extra_js %}{% endblock %}
</body>
</html>