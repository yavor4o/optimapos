# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ PRODUCTS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ

## üéØ –ü—Ä–µ–≥–ª–µ–¥

**PRODUCTS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ** —É–ø—Ä–∞–≤–ª—è–≤–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤–∏—è –∫–∞—Ç–∞–ª–æ–≥ –≤ OptimaPOS, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—è–π–∫–∏ –∏–∑—á–µ—Ä–ø–∞—Ç–µ–ª–Ω–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –∂–∏–∑–Ω–µ–Ω–∏—è —Ü–∏–∫—ä–ª –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏—Ç–µ, packaging –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –±–∞—Ä–∫–æ–¥/PLU –ø–æ–¥–¥—Ä—ä–∂–∫–∞ –∏ –±–µ–∑–ø—Ä–æ–±–ª–µ–º–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å—ä—Å —Å–∫–ª–∞–¥, —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ –∏ —Å–∏—Å—Ç–µ–º–∏ –∑–∞ –ø—Ä–æ–¥–∞–∂–±–∏. –¢–æ —Å–µ —Ñ–æ–∫—É—Å–∏—Ä–∞ –Ω–∞ —Å—Ç–∞—Ç–∏—á–Ω–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤–∏ –¥–µ—Ñ–∏–Ω–∏—Ü–∏–∏ –¥–æ–∫–∞—Ç–æ –¥–µ–ª–µ–≥–∏—Ä–∞ –¥–∏–Ω–∞–º–∏—á–Ω–∏ –¥–∞–Ω–Ω–∏ –∫—ä–º —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–∞–Ω–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

## üìã –°—ä–¥—ä—Ä–∂–∞–Ω–∏–µ

1. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
2. [–û—Å–Ω–æ–≤–Ω–∏ –º–æ–¥–µ–ª–∏](#–æ—Å–Ω–æ–≤–Ω–∏-–º–æ–¥–µ–ª–∏)
3. [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –∂–∏–∑–Ω–µ–Ω–∏—è —Ü–∏–∫—ä–ª –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏—Ç–µ](#—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–Ω–∞-–∂–∏–∑–Ω–µ–Ω–∏—è-—Ü–∏–∫—ä–ª-–Ω–∞-–ø—Ä–æ–¥—É–∫—Ç–∏—Ç–µ)
4. [Packaging —Å–∏—Å—Ç–µ–º–∞](#packaging-—Å–∏—Å—Ç–µ–º–∞)
5. [–£—Å–ª—É–≥–∏](#—É—Å–ª—É–≥–∏)
6. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–∏ —Ç–æ—á–∫–∏](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–∏-—Ç–æ—á–∫–∏)
7. [–®–∞–±–ª–æ–Ω–∏ –∑–∞ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ](#—à–∞–±–ª–æ–Ω–∏-–∑–∞-–∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ)
8. [API —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫](#api-—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫)
9. [–ù–∞–π-–¥–æ–±—Ä–∏ –ø—Ä–∞–∫—Ç–∏–∫–∏](#–Ω–∞–π-–¥–æ–±—Ä–∏-–ø—Ä–∞–∫—Ç–∏–∫–∏)

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
PRODUCTS –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ:
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ products.py         # Product, ProductPLU, ProductLifecycleChoices
‚îÇ   ‚îî‚îÄ‚îÄ packaging.py        # ProductPackaging, ProductBarcode
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ product_service.py  # –¢—ä—Ä—Å–µ–Ω–µ, lookup, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ lifecycle_service.py # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –∂–∏–∑–Ω–µ–Ω–∏—è —Ü–∏–∫—ä–ª
‚îÇ   ‚îî‚îÄ‚îÄ validation_service.py # –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏
‚îú‚îÄ‚îÄ admin.py                # –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏
‚îî‚îÄ‚îÄ views.py                # API endpoints
```

### –§–∏–ª–æ—Å–æ—Ñ–∏—è –Ω–∞ –¥–∏–∑–∞–π–Ω–∞

- **üìä –§–æ–∫—É—Å –Ω–∞ —Å—Ç–∞—Ç–∏—á–Ω–∞—Ç–∞ –¥–µ—Ñ–∏–Ω–∏—Ü–∏—è** - –ü—Ä–æ–¥—É–∫—Ç–∏—Ç–µ —Å—ä—Ö—Ä–∞–Ω—è–≤–∞—Ç —Å—Ç–∞—Ç–∏—á–Ω–∏ –¥–∞–Ω–Ω–∏, –¥–∏–Ω–∞–º–∏—á–Ω–∏ –¥–∞–Ω–Ω–∏ –≤ –¥—Ä—É–≥–∏ apps
- **üîÑ Lifecycle-Driven** - –ü—ä–ª–µ–Ω –∂–∏–∑–Ω–µ–Ω —Ü–∏–∫—ä–ª –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∞ –æ—Ç NEW –¥–æ ARCHIVED
- **üì¶ –ì—ä–≤–∫–∞–≤–æ packaging** - –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –µ–¥–∏–Ω–∏—Ü–∏ –∏ packaging –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- **üè∑Ô∏è Multi-Identification** - –ö–æ–¥–æ–≤–µ, –±–∞—Ä–∫–æ–¥–æ–≤–µ, PLU –∫–æ–¥–æ–≤–µ –∑–∞ —Ä–∞–∑–ª–∏—á–Ω–∏ —Å–ª—É—á–∞–∏
- **üîç –û–ø—Ç–∏–º–∏–∑–∏—Ä–∞–Ω–æ –∑–∞ —Ç—ä—Ä—Å–µ–Ω–µ** - –ë—ä—Ä–∑–æ —Ç—ä—Ä—Å–µ–Ω–µ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏ –ø–æ –≤—Å—è–∫–∞–∫—ä–≤ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- **‚öôÔ∏è Integration-Ready** - –ß–∏—Å—Ç–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å—ä—Å —Å–∫–ª–∞–¥, —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ, –ø—Ä–æ–¥–∞–∂–±–∏
- **‚úÖ Heavy –≤–∞–ª–∏–¥–∞—Ü–∏—è** - –ò–∑—á–µ—Ä–ø–∞—Ç–µ–ª–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –±–∏–∑–Ω–µ—Å –ø—Ä–∞–≤–∏–ª–∞

---

## –û—Å–Ω–æ–≤–Ω–∏ –º–æ–¥–µ–ª–∏

### 1. **Product** (–ì–ª–∞–≤–Ω–∞ –¥–µ—Ñ–∏–Ω–∏—Ü–∏—è –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç)

**–¶–µ–ª**: –û—Å–Ω–æ–≤–µ–Ω –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∫–∞—Ç–∞–ª–æ–≥ —Å—ä—Å —Å—Ç–∞—Ç–∏—á–Ω–∏ –¥–µ—Ñ–∏–Ω–∏—Ü–∏–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –∂–∏–∑–Ω–µ–Ω–∏—è —Ü–∏–∫—ä–ª

```python
from core.models.fields import QuantityField

# –û—Å–Ω–æ–≤–Ω–∞ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç
code = models.CharField(unique=True, max_length=50)     # –í—ä—Ç—Ä–µ—à–µ–Ω –∫–æ–¥ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç
name = models.CharField(max_length=255)                 # –ò–º–µ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∞
description = models.TextField()                        # –ü–æ–¥—Ä–æ–±–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ

# –ö–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è (—á—Ä–µ–∑ NOMENCLATURES)
brand = models.ForeignKey('nomenclatures.Brand')
product_group = models.ForeignKey('nomenclatures.ProductGroup')
product_type = models.ForeignKey('nomenclatures.ProductType')

# –ï–¥–∏–Ω–∏—Ü–∏ –∏ –∏–∑–º–µ—Ä–≤–∞–Ω–∏—è
base_unit = models.ForeignKey('nomenclatures.UnitOfMeasure')
unit_type = models.CharField(
    choices=[('PIECE', '–ë—Ä–æ–π–∫–∏'), ('WEIGHT', '–¢–µ–≥–ª–æ'), ('VOLUME', '–û–±–µ–º'), ('LENGTH', '–î—ä–ª–∂–∏–Ω–∞')]
)

# –î–∞–Ω—ä—á–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
tax_group = models.ForeignKey('nomenclatures.TaxGroup')

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞ –ø—Ä–æ—Å–ª–µ–¥—è–≤–∞–Ω–µ
track_batches = models.BooleanField(default=False)
track_serial_numbers = models.BooleanField(default=False)
requires_expiry_date = models.BooleanField(default=False)

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –∂–∏–∑–Ω–µ–Ω–∏—è —Ü–∏–∫—ä–ª
lifecycle_status = models.CharField(
    max_length=20,
    choices=ProductLifecycleChoices.choices,
    default=ProductLifecycleChoices.NEW
)
sales_blocked = models.BooleanField(default=False)
purchase_blocked = models.BooleanField(default=False)
allow_negative_sales = models.BooleanField(default=False)
```

**–°—ä—Å—Ç–æ—è–Ω–∏—è –Ω–∞ –∂–∏–∑–Ω–µ–Ω–∏—è —Ü–∏–∫—ä–ª:**
```python
class ProductLifecycleChoices:
    NEW = 'NEW'                    # –ù–æ–≤ –ø—Ä–æ–¥—É–∫—Ç, –≤—Å–µ –æ—â–µ –Ω–µ –µ –∞–∫—Ç–∏–≤–µ–Ω
    ACTIVE = 'ACTIVE'              # –ê–∫—Ç–∏–≤–µ–Ω –ø—Ä–æ–¥—É–∫—Ç, –º–æ–∂–µ –¥–∞ —Å–µ –∫—É–ø—É–≤–∞/–ø—Ä–æ–¥–∞–≤–∞
    PHASE_OUT = 'PHASE_OUT'        # –ò–∑–≤–µ–∂–¥–∞–Ω–µ –æ—Ç —É–ø–æ—Ç—Ä–µ–±–∞, —Å–∞–º–æ –ø—Ä–æ–¥–∞–∂–±–∞ (–±–µ–∑ –ø–æ–∫—É–ø–∫–∞)
    DISCONTINUED = 'DISCONTINUED'  # –ü—Ä–µ–∫—Ä–∞—Ç–µ–Ω, –±–µ–∑ –ø—Ä–æ–¥–∞–∂–±–∏/–ø–æ–∫—É–ø–∫–∏
    ARCHIVED = 'ARCHIVED'          # –ê—Ä—Ö–∏–≤–∏—Ä–∞–Ω, —Å–∞–º–æ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏
```

**–î–∏–Ω–∞–º–∏—á–Ω–∏ —Å–≤–æ–π—Å—Ç–≤–∞ (–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å INVENTORY):**
```python
from core.utils.decimal_utils import round_quantity, round_cost_price, round_currency

@property
def total_stock(self) -> Decimal:
    """–û–±—â —Å–∫–ª–∞–¥ –≤ –≤—Å–∏—á–∫–∏ –ª–æ–∫–∞—Ü–∏–∏"""
    from inventory.models import InventoryItem
    total = InventoryItem.objects.filter(product=self).aggregate(
        total=Sum('current_qty')
    )['total'] or Decimal('0.000')
    
    return round_quantity(total)  # 3dp —Ç–æ—á–Ω–æ—Å—Ç –∑–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞

@property  
def weighted_avg_cost(self) -> Decimal:
    """–ü—Ä–µ—Ç–µ–≥–ª–µ–Ω–∞ —Å—Ä–µ–¥–Ω–∞ —Å–µ–±–µ—Å—Ç–æ–π–Ω–æ—Å—Ç –≤ –≤—Å–∏—á–∫–∏ –ª–æ–∫–∞—Ü–∏–∏"""
    from inventory.models import InventoryItem
    from core.utils.decimal_utils import round_cost_price
    
    items = InventoryItem.objects.filter(
        product=self, 
        current_qty__gt=0
    )
    
    total_value = Decimal('0.0000')
    total_qty = Decimal('0.000')
    
    for item in items:
        if item.current_qty > 0 and item.avg_cost > 0:
            value = item.current_qty * item.avg_cost
            total_value += value
            total_qty += item.current_qty
    
    if total_qty > 0:
        avg_cost = total_value / total_qty
        return round_cost_price(avg_cost)  # 4dp –∑–∞ –∫–∞–ª–∫—É–ª–∞—Ü–∏–æ–Ω–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç
    
    return Decimal('0.0000')

@property
def stock_value(self) -> Decimal:
    """–û–±—â–∞ —Å—Ç–æ–π–Ω–æ—Å—Ç –Ω–∞ —Å–∫–ª–∞–¥–∞ –≤ –≤—Å–∏—á–∫–∏ –ª–æ–∫–∞—Ü–∏–∏"""
    from inventory.models import InventoryItem
    
    total_value = Decimal('0.0000')
    items = InventoryItem.objects.filter(product=self, current_qty__gt=0)
    
    for item in items:
        if item.avg_cost > 0:
            value = item.current_qty * item.avg_cost
            total_value += value
    
    return round_currency(total_value)  # 2dp –∑–∞ –¥–∏—Å–ø–ª–µ–π
```

### 2. **ProductPackaging** (–ê–ª—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∏ –µ–¥–∏–Ω–∏—Ü–∏)

**–¶–µ–ª**: –î–µ—Ñ–∏–Ω–∏—Ä–∞ –∞–ª—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ packaging/–µ–¥–∏–Ω–∏—Ü–∏ –∑–∞ –ø—Ä–æ–¥—É–∫—Ç–∏

```python
from core.models.fields import QuantityField

# –î–µ—Ñ–∏–Ω–∏—Ü–∏—è –Ω–∞ –æ–ø–∞–∫–æ–≤–∫–∞
product = models.ForeignKey(Product, on_delete=models.CASCADE)
unit = models.ForeignKey('nomenclatures.UnitOfMeasure', on_delete=models.PROTECT)
conversion_factor = QuantityField()  # –ö–æ–ª–∫–æ –±–∞–∑–æ–≤–∏ –µ–¥–∏–Ω–∏—Ü–∏ (3dp —Ç–æ—á–Ω–æ—Å—Ç)

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ
allow_sale = models.BooleanField(default=True)           # –ú–æ–∂–µ –¥–∞ —Å–µ –ø—Ä–æ–¥–∞–≤–∞ –≤ —Ç–∞–∑–∏ –µ–¥–∏–Ω–∏—Ü–∞
allow_purchase = models.BooleanField(default=True)       # –ú–æ–∂–µ –¥–∞ —Å–µ –∫—É–ø—É–≤–∞ –≤ —Ç–∞–∑–∏ –µ–¥–∏–Ω–∏—Ü–∞
is_default_sale_unit = models.BooleanField(default=False)
is_default_purchase_unit = models.BooleanField(default=False)

# –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
is_active = models.BooleanField(default=True)

# –ü—Ä–∏–º–µ—Ä: Widget (–±–∞–∑–∞: –±—Ä–æ–π–∫–∏)
# - –ï–¥–∏–Ω–∏—á–Ω–∞ –±—Ä–æ–π–∫–∞:  conversion_factor = 1.000
# - –ö—É—Ç–∏—è —Å 12:       conversion_factor = 12.000
# - –ö–∞—Å–∞ —Å 144:       conversion_factor = 144.000
```

**–ë–∏–∑–Ω–µ—Å –ø—Ä–∞–≤–∏–ª–∞:**
```python
from core.utils.decimal_utils import round_quantity

def clean(self):
    # PIECE –ø—Ä–æ–¥—É–∫—Ç–∏ —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–º–∞—Ç —Ü–µ–ª–∏ —á–∏—Å–ª–∞ –∑–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
    if self.product.unit_type == 'PIECE':
        # –ó–∞–∫—Ä—ä–≥–ª–∏ –¥–æ –ø—Ä–∞–≤–∏–ª–Ω–∞—Ç–∞ —Ç–æ—á–Ω–æ—Å—Ç –∑–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞
        rounded_factor = round_quantity(self.conversion_factor)
        if rounded_factor != int(rounded_factor):
            raise ValidationError('PIECE –ø—Ä–æ–¥—É–∫—Ç–∏ –Ω–µ –º–æ–≥–∞—Ç –¥–∞ –∏–º–∞—Ç –¥—Ä–æ–±–Ω–∏ packaging')
    
    # –°–∞–º–æ –µ–¥–∏–Ω default –Ω–∞ —Ç–∏–ø
    if self.is_default_sale_unit:
        existing = ProductPackaging.objects.filter(
            product=self.product,
            is_default_sale_unit=True
        ).exclude(pk=self.pk)
        if existing.exists():
            raise ValidationError('–†–∞–∑—Ä–µ—à–µ–Ω–∞ –µ —Å–∞–º–æ –µ–¥–Ω–∞ default –µ–¥–∏–Ω–∏—Ü–∞ –∑–∞ –ø—Ä–æ–¥–∞–∂–±–∞')
```

### 3. **ProductBarcode** (–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –±–∞—Ä–∫–æ–¥–æ–≤–µ)

**–¶–µ–ª**: –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –±–∞—Ä–∫–æ–¥–æ–≤–µ –∑–∞ –ø—Ä–æ–¥—É–∫—Ç/packaging –∫–æ–º–±–∏–Ω–∞—Ü–∏—è

```python
# –î–µ—Ñ–∏–Ω–∏—Ü–∏—è –Ω–∞ –±–∞—Ä–∫–æ–¥
barcode = models.CharField(unique=True, max_length=50)   # –î–µ–π—Å—Ç–≤–∏—Ç–µ–ª–Ω–∏—è—Ç –±–∞—Ä–∫–æ–¥
product = models.ForeignKey(Product, on_delete=models.CASCADE)
packaging = models.ForeignKey(ProductPackaging, null=True, blank=True)

# –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏ —Å—Ç–∞—Ç—É—Å
is_primary = models.BooleanField(default=False)          # –ì–ª–∞–≤–µ–Ω –±–∞—Ä–∫–æ–¥ –∑–∞ –ø—Ä–æ–¥—É–∫—Ç–∞
is_active = models.BooleanField(default=True)
priority = models.IntegerField(default=0)                # –ü–æ-–≤–∏—Å–æ–∫–æ = –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–Ω–æ
```

**–¢–∏–ø–æ–≤–µ –±–∞—Ä–∫–æ–¥–æ–≤–µ:**
- **–ü—Ä–æ–¥—É–∫—Ç–æ–≤–∏ –±–∞—Ä–∫–æ–¥–æ–≤–µ**: Scan ‚Üí –ø–æ–ª—É—á–∏ –ø—Ä–æ–¥—É–∫—Ç (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ = 1 –±–∞–∑–æ–≤–∞ –µ–¥–∏–Ω–∏—Ü–∞)
- **Packaging –±–∞—Ä–∫–æ–¥–æ–≤–µ**: Scan ‚Üí –ø–æ–ª—É—á–∏ –ø—Ä–æ–¥—É–∫—Ç + packaging info (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ = conversion_factor)

### 4. **ProductPLU** (Weight-Based –ø—Ä–æ–¥—É–∫—Ç–∏)

**–¶–µ–ª**: PLU –∫–æ–¥–æ–≤–µ –∑–∞ scale/weight-based –ø—Ä–æ–¥—É–∫—Ç–∏

```python
# PLU –¥–µ—Ñ–∏–Ω–∏—Ü–∏—è
product = models.ForeignKey(Product, on_delete=models.CASCADE)
plu_code = models.CharField(max_length=10)               # PLU –∫–æ–¥ (—Ü–∏—Ñ—Ä–∏)
is_primary = models.BooleanField(default=False)
priority = models.IntegerField(default=0)

# –í–∞–ª–∏–¥–∞—Ü–∏—è
def clean(self):
    # –°–∞–º–æ –∑–∞ weight-based –ø—Ä–æ–¥—É–∫—Ç–∏
    if self.product.unit_type != 'WEIGHT':
        raise ValidationError('PLU –∫–æ–¥–æ–≤–µ —Å–∞–º–æ –∑–∞ weight-based –ø—Ä–æ–¥—É–∫—Ç–∏')
```

---

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –∂–∏–∑–Ω–µ–Ω–∏—è —Ü–∏–∫—ä–ª –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏—Ç–µ

### –°—ä—Å—Ç–æ—è–Ω–∏—è –∏ –ø—Ä–µ—Ö–æ–¥–∏ –Ω–∞ –∂–∏–∑–Ω–µ–Ω–∏—è —Ü–∏–∫—ä–ª

```python
class ProductLifecycleService:
    
    @staticmethod
    def transition_to_active(product):
        """–ü—Ä–µ–º–∏–Ω–∞ –ø—Ä–æ–¥—É–∫—Ç –∫—ä–º ACTIVE —Å—Ç–∞—Ç—É—Å"""
        from core.utils.result import Result
        
        if product.lifecycle_status == ProductLifecycleChoices.NEW:
            product.lifecycle_status = ProductLifecycleChoices.ACTIVE
            product.sales_blocked = False
            product.purchase_blocked = False
            product.save()
            
            return Result.success(
                data={'product': product, 'new_status': 'ACTIVE'},
                msg=f'–ü—Ä–æ–¥—É–∫—Ç {product.code} –µ –∞–∫—Ç–∏–≤–∏—Ä–∞–Ω'
            )
        
        return Result.error(
            'INVALID_TRANSITION',
            f'–ù–µ –º–æ–∂–µ –¥–∞ —Å–µ –∞–∫—Ç–∏–≤–∏—Ä–∞ –ø—Ä–æ–¥—É–∫—Ç –æ—Ç —Å—Ç–∞—Ç—É—Å {product.lifecycle_status}'
        )
    
    @staticmethod
    def phase_out_product(product):
        """–ó–∞–ø–æ—á–Ω–∏ –∏–∑–≤–µ–∂–¥–∞–Ω–µ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç –æ—Ç —É–ø–æ—Ç—Ä–µ–±–∞"""
        product.lifecycle_status = ProductLifecycleChoices.PHASE_OUT
        product.purchase_blocked = True  # –ù–µ –º–æ–∂–µ –¥–∞ —Å–µ –∫—É–ø—É–≤–∞
        product.sales_blocked = False    # –í—Å–µ –æ—â–µ –º–æ–∂–µ –¥–∞ —Å–µ –ø—Ä–æ–¥–∞–≤–∞
        product.save()
        
        return Result.success(
            data={'product': product},
            msg=f'–ü—Ä–æ–¥—É–∫—Ç {product.code} –µ –≤ –ø—Ä–æ—Ü–µ—Å –Ω–∞ –∏–∑–≤–µ–∂–¥–∞–Ω–µ'
        )
```

### –ë–∏–∑–Ω–µ—Å –ø—Ä–∞–≤–∏–ª–∞ –∑–∞ –∂–∏–∑–Ω–µ–Ω–∏—è —Ü–∏–∫—ä–ª

```python
def can_purchase(self):
    """–ú–æ–∂–µ –ª–∏ –ø—Ä–æ–¥—É–∫—Ç—ä—Ç –¥–∞ —Å–µ –∫—É–ø—É–≤–∞"""
    return (
        self.lifecycle_status in [ProductLifecycleChoices.NEW, ProductLifecycleChoices.ACTIVE] and
        not self.purchase_blocked
    )

def can_sell(self):
    """–ú–æ–∂–µ –ª–∏ –ø—Ä–æ–¥—É–∫—Ç—ä—Ç –¥–∞ —Å–µ –ø—Ä–æ–¥–∞–≤–∞"""
    return (
        self.lifecycle_status in [ProductLifecycleChoices.ACTIVE, ProductLifecycleChoices.PHASE_OUT] and
        not self.sales_blocked
    )

def requires_batch_tracking(self):
    """–ò–∑–∏—Å–∫–≤–∞ –ª–∏ –ø—Ä–æ–¥—É–∫—Ç—ä—Ç batch —Å–ª–µ–¥–µ–Ω–µ"""
    return self.track_batches or self.requires_expiry_date
```

---

## Packaging —Å–∏—Å—Ç–µ–º–∞

### Packaging hierarchy

```python
class ProductPackaging:
    
    def get_base_quantity(self, packaging_quantity):
        """–ü—Ä–µ–æ–±—Ä–∞–∑—É–≤–∞ packaging –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ –±–∞–∑–æ–≤–∏ –µ–¥–∏–Ω–∏—Ü–∏"""
        from core.utils.decimal_utils import round_quantity
        
        base_qty = packaging_quantity * self.conversion_factor
        return round_quantity(base_qty)  # 3dp —Ç–æ—á–Ω–æ—Å—Ç
    
    def get_packaging_quantity(self, base_quantity):
        """–ü—Ä–µ–æ–±—Ä–∞–∑—É–≤–∞ –±–∞–∑–æ–≤–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ packaging –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ"""
        from core.utils.decimal_utils import round_quantity
        
        if self.conversion_factor > 0:
            pkg_qty = base_quantity / self.conversion_factor
            return round_quantity(pkg_qty)
        
        return Decimal('0.000')
    
    @property
    def display_name(self):
        """–î–∏—Å–ø–ª–µ–π –∏–º–µ –∑–∞ packaging"""
        if self.conversion_factor == 1:
            return self.unit.name
        else:
            return f"{self.unit.name} (x{int(self.conversion_factor)})"
```

### Packaging –≤–∞–ª–∏–¥–∞—Ü–∏—è

```python
def validate_packaging_consistency():
    """–í–∞–ª–∏–¥–∏—Ä–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—Ç–∞ –Ω–∞ packaging —Å–∏—Å—Ç–µ–º–∞—Ç–∞"""
    from core.utils.result import Result
    
    errors = []
    
    # –ü—Ä–æ–≤–µ—Ä–∏ —á–µ –∏–º–∞ –ø–æ–Ω–µ –µ–¥–∏–Ω –∞–∫—Ç–∏–≤–µ–Ω packaging –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç
    products_without_packaging = Product.objects.filter(
        packaging_set__isnull=True,
        lifecycle_status__in=['ACTIVE', 'NEW']
    )
    
    for product in products_without_packaging:
        errors.append(f'–ü—Ä–æ–¥—É–∫—Ç {product.code} –Ω—è–º–∞ packaging –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è')
    
    # –ü—Ä–æ–≤–µ—Ä–∏ –∑–∞ –¥—É–±–ª–∏—Ä–∞–Ω–∏ default packaging
    duplicate_defaults = ProductPackaging.objects.values('product').annotate(
        default_sale_count=Count('id', filter=Q(is_default_sale_unit=True)),
        default_purchase_count=Count('id', filter=Q(is_default_purchase_unit=True))
    ).filter(
        Q(default_sale_count__gt=1) | Q(default_purchase_count__gt=1)
    )
    
    for item in duplicate_defaults:
        product = Product.objects.get(id=item['product'])
        errors.append(f'–ü—Ä–æ–¥—É–∫—Ç {product.code} –∏–º–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–æ default packaging')
    
    if errors:
        return Result.error('PACKAGING_VALIDATION_FAILED', '; '.join(errors))
    
    return Result.success(msg='Packaging –≤–∞–ª–∏–¥–∞—Ü–∏—è—Ç–∞ –ø—Ä–µ–º–∏–Ω–∞ —É—Å–ø–µ—à–Ω–æ')
```

---

## –£—Å–ª—É–≥–∏

### 1. **ProductService** - –û—Å–Ω–æ–≤–Ω–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø—Ä–æ–¥—É–∫—Ç–∏

```python
from products.services import ProductService

# –¢—ä—Ä—Å–µ–Ω–µ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏ –ø–æ —Ä–∞–∑–ª–∏—á–Ω–∏ –∫—Ä–∏—Ç–µ—Ä–∏–∏
result = ProductService.search_products(
    search_term='widget',
    category='electronics',
    lifecycle_status='ACTIVE',
    has_stock=True
)

# Lookup –ø–æ –±–∞—Ä–∫–æ–¥/PLU/–∫–æ–¥
result = ProductService.lookup_by_identifier(
    identifier='1234567890123',  # –ú–æ–∂–µ –¥–∞ –µ –±–∞—Ä–∫–æ–¥, PLU –∏–ª–∏ –∫–æ–¥
    identifier_type='auto'       # –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ—Ç–∫—Ä–∏–≤–∞–Ω–µ
)

# –ü–æ–ª—É—á–∞–≤–∞–Ω–µ –Ω–∞ –ø—ä–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ –ø—Ä–æ–¥—É–∫—Ç
result = ProductService.get_product_details(
    product_id=42,
    include_stock=True,
    include_pricing=True,
    location=warehouse
)
```

### 2. **LifecycleService** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –∂–∏–∑–Ω–µ–Ω–∏—è —Ü–∏–∫—ä–ª

```python
from products.services import LifecycleService

# –ê–∫—Ç–∏–≤–∏—Ä–∞–Ω–µ –Ω–∞ –Ω–æ–≤ –ø—Ä–æ–¥—É–∫—Ç
result = LifecycleService.activate_product(product)

# –ó–∞–ø–æ—á–Ω–∏ –∏–∑–≤–µ–∂–¥–∞–Ω–µ –æ—Ç —É–ø–æ—Ç—Ä–µ–±–∞
result = LifecycleService.phase_out_product(
    product=product,
    reason='–ó–∞–º–µ–Ω–µ–Ω —Å –Ω–æ–≤ –º–æ–¥–µ–ª'
)

# –ü—Ä–µ–∫—Ä–∞—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç
result = LifecycleService.discontinue_product(
    product=product,
    archive_date=date.today() + timedelta(days=90)
)
```

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–∏ —Ç–æ—á–∫–∏

### **–° INVENTORY App:**

```python
# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–∞ stock –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
class Product:
    @property
    def current_stock_by_location(self):
        """–¢–µ–∫—É—â —Å–∫–ª–∞–¥ –ø–æ –ª–æ–∫–∞—Ü–∏–∏ —Å –ø—Ä–∞–≤–∏–ª–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç"""
        from inventory.models import InventoryItem
        from core.utils.decimal_utils import round_quantity
        
        stock_data = {}
        items = InventoryItem.objects.filter(product=self, current_qty__gt=0)
        
        for item in items:
            stock_data[item.location.code] = {
                'current_qty': round_quantity(item.current_qty),      # 3dp —Ç–æ—á–Ω–æ—Å—Ç
                'available_qty': round_quantity(item.available_qty),  # 3dp —Ç–æ—á–Ω–æ—Å—Ç
                'avg_cost': item.avg_cost,                            # 4dp —Ç–æ—á–Ω–æ—Å—Ç
                'stock_value': round_currency(item.stock_value)       # 2dp —Ç–æ—á–Ω–æ—Å—Ç
            }
        
        return stock_data
```

### **–° PRICING App:**

```python
# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∑–∞ —Ü–µ–Ω–∏
def get_product_with_pricing(product_id, location, customer=None):
    """–ü–æ–ª—É—á–∞–≤–∞ –ø—Ä–æ–¥—É–∫—Ç —Å —Ü–µ–Ω–æ–≤–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"""
    from pricing.services import PricingService
    
    product = Product.objects.get(id=product_id)
    
    # –ü–æ–ª—É—á–∏ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ
    pricing_result = PricingService.get_product_pricing(
        location=location,
        product=product,
        customer=customer
    )
    
    product_data = {
        'product': product,
        'pricing': pricing_result.data if pricing_result.ok else None,
        'stock_info': product.current_stock_by_location.get(location.code, {}),
        'packaging_options': list(product.packaging_set.filter(
            is_active=True,
            allow_sale=True
        ))
    }
    
    return product_data
```

### **–° NOMENCLATURES App:**

```python
# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∑–∞ –î–î–° –∫–∞–ª–∫—É–ª–∞—Ü–∏–∏
def get_product_vat_info(product, location=None):
    """–ü–æ–ª—É—á–∞–≤–∞ –î–î–° –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ –ø—Ä–æ–¥—É–∫—Ç"""
    from nomenclatures.services.vat_calculation_service import VATCalculationService
    
    # –ü–æ–ª—É—á–∏ –î–î–° —Å—Ç–∞–≤–∫–∞ –∑–∞ –ø—Ä–æ–¥—É–∫—Ç–∞
    vat_rate = VATCalculationService.get_vat_rate(product, location)
    
    return {
        'tax_group': product.tax_group.name if product.tax_group else '–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞',
        'vat_rate': vat_rate,
        'vat_exempt': vat_rate == 0
    }
```

---

## –®–∞–±–ª–æ–Ω–∏ –∑–∞ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ

### 1. **–°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç —Å packaging**

```python
from core.utils.decimal_utils import Decimal

# –°—ä–∑–¥–∞–π –æ—Å–Ω–æ–≤–µ–Ω –ø—Ä–æ–¥—É–∫—Ç
product = Product.objects.create(
    code='WIDGET001',
    name='Premium Widget',
    description='–í–∏—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω widget –∑–∞ –ø—Ä–æ—Ñ–µ—Å–∏–æ–Ω–∞–ª–Ω–∞ —É–ø–æ—Ç—Ä–µ–±–∞',
    brand=electronics_brand,
    product_group=widgets_group,
    base_unit=piece_unit,
    unit_type='PIECE',
    track_batches=True,
    lifecycle_status=ProductLifecycleChoices.NEW
)

# –î–æ–±–∞–≤–∏ packaging –æ–ø—Ü–∏–∏
# –ï–¥–∏–Ω–∏—á–Ω–∞ –±—Ä–æ–π–∫–∞
single_packaging = ProductPackaging.objects.create(
    product=product,
    unit=piece_unit,
    conversion_factor=Decimal('1.000'),  # 3dp —Ç–æ—á–Ω–æ—Å—Ç
    is_default_sale_unit=True,
    is_default_purchase_unit=False
)

# –ö—É—Ç–∏—è —Å 12 –±—Ä–æ–π–∫–∏
box_packaging = ProductPackaging.objects.create(
    product=product,
    unit=box_unit,
    conversion_factor=Decimal('12.000'),  # 3dp —Ç–æ—á–Ω–æ—Å—Ç
    is_default_purchase_unit=True
)

# –ö–∞—Å–∞ —Å 144 –±—Ä–æ–π–∫–∏
case_packaging = ProductPackaging.objects.create(
    product=product,
    unit=case_unit,
    conversion_factor=Decimal('144.000')  # 3dp —Ç–æ—á–Ω–æ—Å—Ç
)
```

### 2. **–†–∞–±–æ—Ç–∞ —Å –±–∞—Ä–∫–æ–¥–æ–≤–µ**

```python
# –î–æ–±–∞–≤–∏ –±–∞—Ä–∫–æ–¥–æ–≤–µ –∑–∞ —Ä–∞–∑–ª–∏—á–Ω–∏ packaging –Ω–∏–≤–∞
ProductBarcode.objects.create(
    barcode='1234567890123',  # –ï–¥–∏–Ω–∏—á–µ–Ω –ø—Ä–æ–¥—É–∫—Ç
    product=product,
    packaging=single_packaging,
    is_primary=True,
    priority=100
)

ProductBarcode.objects.create(
    barcode='9876543210987',  # –ö—É—Ç–∏—è
    product=product,
    packaging=box_packaging,
    priority=90
)

ProductBarcode.objects.create(
    barcode='5555666677778',  # –ö–∞—Å–∞
    product=product,
    packaging=case_packaging,
    priority=80
)
```

### 3. **–¢—ä—Ä—Å–µ–Ω–µ –∏ lookup –æ–ø–µ—Ä–∞—Ü–∏–∏**

```python
# –¢—ä—Ä—Å–µ–Ω–µ –ø–æ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∫—Ä–∏—Ç–µ—Ä–∏–∏
def search_products_with_precision():
    result = ProductService.search_products(
        search_term='widget',
        lifecycle_status=['ACTIVE', 'PHASE_OUT'],
        has_stock=True,
        location=warehouse
    )
    
    if result.ok:
        for product_data in result.data['products']:
            product = product_data['product']
            stock_info = product_data['stock_info']
            
            print(f"–ü—Ä–æ–¥—É–∫—Ç: {product.name}")
            print(f"–°–∫–ª–∞–¥: {stock_info['current_qty']} {product.base_unit.symbol}")
            print(f"–°—Ç–æ–π–Ω–æ—Å—Ç: {stock_info['stock_value']} –ª–≤.")

# Lookup –ø–æ –±–∞—Ä–∫–æ–¥ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ—Ç–∫—Ä–∏–≤–∞–Ω–µ –Ω–∞ packaging
def barcode_lookup_with_packaging(barcode_value):
    result = ProductService.lookup_by_identifier(barcode_value)
    
    if result.ok:
        lookup_data = result.data
        product = lookup_data['product']
        packaging = lookup_data['packaging']
        
        if packaging:
            quantity_per_scan = packaging.conversion_factor
            print(f"–ë–∞—Ä–∫–æ–¥ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–≤–∞ {quantity_per_scan} {product.base_unit.symbol}")
        else:
            print(f"–ë–∞—Ä–∫–æ–¥ –∑–∞ –µ–¥–∏–Ω–∏—á–µ–Ω {product.name}")
```

---

## API —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫

### ProductService –º–µ—Ç–æ–¥–∏

| –ú–µ—Ç–æ–¥ | –¶–µ–ª | –í—Ä—ä—â–∞ | –ö–ª—é—á–æ–≤–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ |
|-------|-----|-------|------------------|
| `search_products()` | –¢—ä—Ä—Å–µ–Ω–µ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏ | Result | search_term, filters, pagination |
| `lookup_by_identifier()` | –¢—ä—Ä—Å–µ–Ω–µ –ø–æ –±–∞—Ä–∫–æ–¥/PLU/–∫–æ–¥ | Result | identifier, identifier_type |
| `get_product_details()` | –ü–æ–¥—Ä–æ–±–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è | Result | product_id, include_options |
| `validate_product_data()` | –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–µ–¥–∏ –∑–∞–ø–∞–∑–≤–∞–Ω–µ | Result | product_data |

### Result —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –æ—Ç –¥–∞–Ω–Ω–∏

**–î–µ—Ç–∞–π–ª–∏ –∑–∞ –ø—Ä–æ–¥—É–∫—Ç:**
```python
{
    'product': {
        'id': 42,
        'code': 'WIDGET001',
        'name': 'Premium Widget',
        'lifecycle_status': 'ACTIVE',
        'unit_type': 'PIECE',
        'can_purchase': True,
        'can_sell': True,
        'track_batches': True
    },
    'stock_info': {
        'total_stock': Decimal('150.000'),          # 3dp —Ç–æ—á–Ω–æ—Å—Ç
        'weighted_avg_cost': Decimal('15.2500'),    # 4dp —Ç–æ—á–Ω–æ—Å—Ç
        'stock_value': Decimal('3787.50'),          # 2dp —Ç–æ—á–Ω–æ—Å—Ç
        'locations': {
            'WH01': {
                'current_qty': Decimal('100.000'),   # 3dp —Ç–æ—á–Ω–æ—Å—Ç
                'available_qty': Decimal('85.000'),  # 3dp —Ç–æ—á–Ω–æ—Å—Ç
                'avg_cost': Decimal('15.0000'),      # 4dp —Ç–æ—á–Ω–æ—Å—Ç
                'stock_value': Decimal('1500.00')    # 2dp —Ç–æ—á–Ω–æ—Å—Ç
            }
        }
    },
    'packaging_options': [
        {
            'id': 1,
            'unit_name': '–±—Ä.',
            'conversion_factor': Decimal('1.000'),    # 3dp —Ç–æ—á–Ω–æ—Å—Ç
            'display_name': '–±—Ä.',
            'is_default_sale': True
        },
        {
            'id': 2,
            'unit_name': '–∫—É—Ç–∏—è',
            'conversion_factor': Decimal('12.000'),   # 3dp —Ç–æ—á–Ω–æ—Å—Ç
            'display_name': '–∫—É—Ç–∏—è (x12)',
            'is_default_purchase': True
        }
    ],
    'barcodes': [
        {
            'barcode': '1234567890123',
            'packaging_id': 1,
            'is_primary': True
        }
    ]
}
```

---

## –ù–∞–π-–¥–æ–±—Ä–∏ –ø—Ä–∞–∫—Ç–∏–∫–∏

### 1. **–í–∏–Ω–∞–≥–∏ –∏–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª–Ω–∞—Ç–∞ –¥–µ—Å–µ—Ç–∏—á–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç**

```python
# ‚úÖ –î–æ–±—Ä–æ - –∏–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–∞–Ω–∏—Ç–µ —É—Ç–∏–ª–∏—Ç–∏
from core.utils.decimal_utils import round_quantity, round_cost_price

def create_packaging_with_precision():
    packaging = ProductPackaging.objects.create(
        product=product,
        unit=box_unit,
        conversion_factor=round_quantity(Decimal('12.000'))  # 3dp —Ç–æ—á–Ω–æ—Å—Ç
    )
    
    # –ö–∞–ª–∫—É–ª–∞—Ü–∏–∏ —Å –ø—Ä–∞–≤–∏–ª–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç
    base_qty = round_quantity(packaging.conversion_factor * Decimal('5.000'))
    
    return packaging

# ‚ùå –ò–∑–±—è–≥–≤–∞–π—Ç–µ - –¥–∏—Ä–µ–∫—Ç–Ω–æ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ –Ω–∞ Decimal –±–µ–∑ –ø—Ä–∞–≤–∏–ª–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç
conversion = Decimal('12')  # –ú–æ–∂–µ –¥–∞ –∏–º–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç
```

### 2. **–ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ lifecycle —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**

```python
# ‚úÖ –î–æ–±—Ä–æ - –ø—Ä–æ–≤–µ—Ä—è–≤–∞–π—Ç–µ lifecycle —Å—Ç–∞—Ç—É—Å
def can_process_product_operation(product, operation_type):
    if operation_type == 'purchase':
        if not product.can_purchase():
            return Result.error(
                'PRODUCT_CANNOT_PURCHASE',
                f'–ü—Ä–æ–¥—É–∫—Ç {product.code} –Ω–µ –º–æ–∂–µ –¥–∞ —Å–µ –∫—É–ø—É–≤–∞ –≤ —Å—Ç–∞—Ç—É—Å {product.lifecycle_status}'
            )
    
    elif operation_type == 'sale':
        if not product.can_sell():
            return Result.error(
                'PRODUCT_CANNOT_SELL', 
                f'–ü—Ä–æ–¥—É–∫—Ç {product.code} –Ω–µ –º–æ–∂–µ –¥–∞ —Å–µ –ø—Ä–æ–¥–∞–≤–∞ –≤ —Å—Ç–∞—Ç—É—Å {product.lifecycle_status}'
            )
    
    return Result.success()

# ‚ùå –ò–∑–±—è–≥–≤–∞–π—Ç–µ - –∏–≥–Ω–æ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ lifecycle —Å—Ç–∞—Ç—É—Å
def process_without_lifecycle_check():
    # –î–∏—Ä–µ–∫—Ç–Ω–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ - –º–æ–∂–µ –¥–∞ –¥–æ–≤–µ–¥–µ –¥–æ –≥—Ä–µ—à–∫–∏
    pass
```

### 3. **–í–∞–ª–∏–¥–∏—Ä–∞–π—Ç–µ packaging –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Ç–∞**

```python
# ‚úÖ –î–æ–±—Ä–æ - –≤–∞–ª–∏–¥–∏—Ä–∞–π—Ç–µ packaging –ø—Ä–µ–¥–∏ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ
def setup_product_packaging(product, packaging_configs):
    validation_result = ProductService.validate_packaging_configs(
        product, packaging_configs
    )
    
    if not validation_result.ok:
        return validation_result
    
    # –ü—Ä–æ–¥—ä–ª–∂–∏ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
    for config in packaging_configs:
        ProductPackaging.objects.create(
            product=product,
            unit=config['unit'],
            conversion_factor=round_quantity(config['conversion_factor']),
            **config.get('options', {})
        )

# ‚ùå –ò–∑–±—è–≥–≤–∞–π—Ç–µ - —Å—ä–∑–¥–∞–≤–∞–Ω–µ –±–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏—è
ProductPackaging.objects.create(...)  # –ú–æ–∂–µ –¥–∞ –Ω–∞—Ä—É—à–∏ consistency
```

### 4. **–ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–∞–Ω–∏—Ç–µ —Å–≤–æ–π—Å—Ç–≤–∞ –ø—Ä–∞–≤–∏–ª–Ω–æ**

```python
# ‚úÖ –î–æ–±—Ä–æ - –∏–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ –∫–µ—à–∏—Ä–∞–Ω–∏ properties –∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–Ω–æ—Å—Ç
def get_product_summary_efficient(product):
    # –ò–∑–ø–æ–ª–∑–≤–∞–π properties –∫–æ–∏—Ç–æ —Å–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–∞–Ω–∏
    stock_data = {
        'total_stock': product.total_stock,          # –ö–µ—à–∏—Ä–∞–Ω–∞ –∑–∞—è–≤–∫–∞
        'avg_cost': product.weighted_avg_cost,       # –ö–∞–ª–∫—É–ª–∏—Ä–∞–Ω–∞ —Å –ø—Ä–∞–≤–∏–ª–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç
        'stock_value': product.stock_value           # 2dp —Ç–æ—á–Ω–æ—Å—Ç –∑–∞ –¥–∏—Å–ø–ª–µ–π
    }
    
    return stock_data

# ‚ùå –ò–∑–±—è–≥–≤–∞–π—Ç–µ - —Ä—ä—á–Ω–∏ –∑–∞—è–≤–∫–∏ –∑–∞ –¥–∞–Ω–Ω–∏ –∫–æ–∏—Ç–æ —Å–∞ –¥–æ—Å—Ç—ä–ø–Ω–∏ –∫–∞—Ç–æ properties
def get_product_summary_inefficient(product):
    # –†—ä—á–Ω–∏ –∑–∞—è–≤–∫–∏ - –±–∞–≤–Ω–æ –∏ –º–æ–∂–µ –¥–∞ –∏–º–∞ –≥—Ä–µ—à–∫–∏ –≤ —Ç–æ—á–Ω–æ—Å—Ç—Ç–∞
    items = InventoryItem.objects.filter(product=product)
    total = sum(item.current_qty for item in items)  # –ù–µ–ø—Ä–∞–≤–∏–ª–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç
```

---

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**PRODUCTS app –∑–∞–≤–∏—Å–∏ –æ—Ç:**
- Django framework
- CORE app (Result pattern, –¥–µ—Å–µ—Ç–∏—á–Ω–∏ —É—Ç–∏–ª–∏—Ç–∏)
- NOMENCLATURES app (Brand, ProductGroup, UnitOfMeasure, TaxGroup –º–æ–¥–µ–ª–∏)

**–î—Ä—É–≥–∏ apps –∑–∞–≤–∏—Å—è—Ç –æ—Ç PRODUCTS:**
- INVENTORY (Product –º–æ–¥–µ–ª –∑–∞ stock tracking)
- PRICING (Product –º–æ–¥–µ–ª –∑–∞ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ)
- PURCHASES (Product –º–æ–¥–µ–ª –∑–∞ –ø–æ–∫—É–ø–∫–∏)
- SALES (Product –º–æ–¥–µ–ª –∑–∞ –ø—Ä–æ–¥–∞–∂–±–∏)

---

## –ò—Å—Ç–æ—Ä–∏—è –Ω–∞ –≤–µ—Ä—Å–∏–∏—Ç–µ

- **v1.0** - –û—Å–Ω–æ–≤–Ω–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤–∏ –º–æ–¥–µ–ª–∏
- **v1.1** - –î–æ–±–∞–≤–µ–Ω–æ packaging —Å–∏—Å—Ç–µ–º–∞
- **v1.2** - Lifecycle —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- **v1.3** - –ë–∞—Ä–∫–æ–¥ –∏ PLU –ø–æ–¥–¥—Ä—ä–∂–∫–∞
- **v1.4** - –ü–æ–¥–æ–±—Ä–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è
- **v2.0** - Result pattern services
- **v2.1** - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å—ä—Å —Å–∫–ª–∞–¥ –∏ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ
- **v3.0** - –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–∞–Ω–∞ –¥–µ—Å–µ—Ç–∏—á–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–∞–Ω–∏ properties

---

*–ü–æ—Å–ª–µ–¥–Ω–∞ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è: 2025-09-05*  
*–í–µ—Ä—Å–∏—è: 3.0*  
*–ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞–Ω–æ —Å–ø–æ—Ä–µ–¥ –∞–∫—Ç—É–∞–ª–Ω–∏—è –∫–æ–¥ —Å –¥–µ—Å–µ—Ç–∏—á–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç*