# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ INVENTORY –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ

## üéØ –ü—Ä–µ–≥–ª–µ–¥

**INVENTORY –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ** —É–ø—Ä–∞–≤–ª—è–≤–∞ —Ü—è–ª–æ—Ç–æ —Å–ª–µ–¥–µ–Ω–µ –Ω–∞ —Å–∫–ª–∞–¥–∞, —Å–∫–ª–∞–¥–æ–≤–∏ –¥–≤–∏–∂–µ–Ω–∏—è –∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ä–≤ —Å–∫–ª–∞–¥–æ–≤–µ—Ç–µ –≤ OptimaPOS. –¢–æ —Å–ª—É–∂–∏ –∫–∞—Ç–æ —Ü–µ–Ω—Ç—Ä–∞–ª–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –∑–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞, –ª–æ–∫–∞—Ü–∏–∏, batch —Å–ª–µ–¥–µ–Ω–µ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–∞–Ω–∏ —Å–∫–ª–∞–¥–æ–≤–∏ –¥–≤–∏–∂–µ–Ω–∏—è –∑–∞–¥–µ–π—Å—Ç–≤–∞–Ω–∏ –æ—Ç –ø—Ä–æ–º–µ–Ω–∏ –≤ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ç–µ.

## üìã –°—ä–¥—ä—Ä–∂–∞–Ω–∏–µ

1. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
2. [–û—Å–Ω–æ–≤–Ω–∏ –º–æ–¥–µ–ª–∏](#–æ—Å–Ω–æ–≤–Ω–∏-–º–æ–¥–µ–ª–∏)  
3. [–£—Å–ª—É–≥–∏](#—É—Å–ª—É–≥–∏)
4. [–°–∏—Å—Ç–µ–º–∞ –∑–∞ —Å–∫–ª–∞–¥–æ–≤–∏ –¥–≤–∏–∂–µ–Ω–∏—è](#—Å–∏—Å—Ç–µ–º–∞-–∑–∞-—Å–∫–ª–∞–¥–æ–≤–∏-–¥–≤–∏–∂–µ–Ω–∏—è)
5. [Batch —Å–ª–µ–¥–µ–Ω–µ](#batch-—Å–ª–µ–¥–µ–Ω–µ)
6. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥–æ–∫—É–º–µ–Ω—Ç–Ω–∞—Ç–∞ —Å–∏—Å—Ç–µ–º–∞](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è-—Å-–¥–æ–∫—É–º–µ–Ω—Ç–Ω–∞—Ç–∞-—Å–∏—Å—Ç–µ–º–∞)
7. [–î–µ—Å–µ—Ç–∏—á–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç](#–¥–µ—Å–µ—Ç–∏—á–Ω–∞-—Ç–æ—á–Ω–æ—Å—Ç)
8. [–®–∞–±–ª–æ–Ω–∏ –∑–∞ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ](#—à–∞–±–ª–æ–Ω–∏-–∑–∞-–∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ)
9. [API —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫](#api-—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫)

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
INVENTORY –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ:
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ locations.py         # InventoryLocation
‚îÇ   ‚îú‚îÄ‚îÄ movements.py         # InventoryMovement (–∏–∑—Ç–æ—á–Ω–∏–∫ –Ω–∞ –∏—Å—Ç–∏–Ω–∞—Ç–∞)
‚îÇ   ‚îî‚îÄ‚îÄ items.py            # InventoryItem, InventoryBatch (–∫–µ—à–∏—Ä–∞–Ω–∏ –¥–∞–Ω–Ω–∏)
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ movement_service.py  # –°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ –¥–≤–∏–∂–µ–Ω–∏—è –∏ FIFO –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ inventory_service.py # –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Å–∫–ª–∞–¥–∞ –∏ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ admin.py                # Admin –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îî‚îÄ‚îÄ views.py               # API endpoints
```

### –§–∏–ª–æ—Å–æ—Ñ–∏—è –Ω–∞ –¥–∏–∑–∞–π–Ω–∞

- **üéØ Movement-Centric** - –í—Å–∏—á–∫–∏ —Å–∫–ª–∞–¥–æ–≤–∏ –ø—Ä–æ–º–µ–Ω–∏ —Å–µ —Å–ª–µ–¥—è—Ç –∫–∞—Ç–æ –¥–≤–∏–∂–µ–Ω–∏—è
- **üìä –ò–∑—Ç–æ—á–Ω–∏–∫ –Ω–∞ –∏—Å—Ç–∏–Ω–∞—Ç–∞** - InventoryMovement –µ –∞–≤—Ç–æ—Ä–∏—Ç–∞—Ç–∏–≤–Ω–∏—è—Ç –∑–∞–ø–∏—Å
- **‚ö° –ö–µ—à–∏—Ä–∞–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–Ω–æ—Å—Ç** - InventoryItem/InventoryBatch –∑–∞ –±—ä—Ä–∑–∏ –∑–∞—è–≤–∫–∏
- **üîÑ Event-Driven** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏ –¥–≤–∏–∂–µ–Ω–∏—è –æ—Ç –ø—Ä–æ–º–µ–Ω–∏ –≤ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ç–µ
- **üè∑Ô∏è Batch —Å–ª–µ–¥–µ–Ω–µ** - –ü—ä–ª–Ω–∞ FIFO –ø–æ–¥–¥—Ä—ä–∂–∫–∞ —Å –¥–∞—Ç–∏ –Ω–∞ –∏–∑—Ç–∏—á–∞–Ω–µ
- **üîí Concurrency –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç** - –ê—Ç–æ–º–Ω–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø—Ä–∞–≤–∏–ª–Ω–æ –∑–∞–∫–ª—é—á–≤–∞–Ω–µ
- **üí∞ –î–µ—Å–µ—Ç–∏—á–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç** - 4dp –∑–∞ —Å–µ–±–µ—Å—Ç–æ–π–Ω–æ—Å—Ç–∏, 2dp –∑–∞ –¥–∏—Å–ø–ª–µ–π —Ü–µ–Ω–∏

---

## –û—Å–Ω–æ–≤–Ω–∏ –º–æ–¥–µ–ª–∏

### 1. **InventoryMovement** (–ò–∑—Ç–æ—á–Ω–∏–∫ –Ω–∞ –∏—Å—Ç–∏–Ω–∞—Ç–∞)

**–¶–µ–ª**: –ó–∞–ø–∏—Å–≤–∞ –≤—Å—è–∫–∞ —Å–∫–ª–∞–¥–æ–≤–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å –ø—ä–ª–µ–Ω audit trail

```python
from core.models.fields import CostPriceField, CurrencyField, QuantityField

class InventoryMovement(models.Model):
    # –ö–ª—é—á–æ–≤–∏ –ø–æ–ª–µ—Ç–∞
    movement_type = models.CharField(
        choices=['IN', 'OUT', 'TRANSFER', 'ADJUSTMENT', 'PRODUCTION', 'CYCLE_COUNT']
    )
    quantity = QuantityField()  # –í–∏–Ω–∞–≥–∏ –ø–æ–ª–æ–∂–∏—Ç–µ–ª–Ω–∞ (—Ç–∏–ø—ä—Ç –æ–ø—Ä–µ–¥–µ–ª—è –ø–æ—Å–æ–∫–∞—Ç–∞)
    cost_price = CostPriceField()  # –ï–¥–∏–Ω–∏—á–Ω–∞ —Å–µ–±–µ—Å—Ç–æ–π–Ω–æ—Å—Ç –∑–∞ —Ç–æ–≤–∞ –¥–≤–∏–∂–µ–Ω–∏–µ (4dp)
    sale_price = CurrencyField()  # –ï–¥–∏–Ω–∏—á–Ω–∞ –ø—Ä–æ–¥–∞–∂–Ω–∞ —Ü–µ–Ω–∞ –∑–∞ –ø—Ä–æ—Å–ª–µ–¥—è–≤–∞–Ω–µ –Ω–∞ –ø–µ—á–∞–ª–±–∞—Ç–∞ (2dp)
    profit_amount = CurrencyField()  # –ö–∞–ª–∫—É–ª–∏—Ä–∞–Ω–∞: sale_price - cost_price

    # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥–æ–∫—É–º–µ–Ω—Ç–∏
    source_document_type = models.CharField(max_length=50)  # e.g., 'DELIVERY', 'SALE'
    source_document_number = models.CharField(max_length=100)
    source_document_line_id = models.PositiveIntegerField()

    # Batch/Lot —Å–ª–µ–¥–µ–Ω–µ
    batch_number = models.CharField(max_length=100)
    expiry_date = models.DateField(null=True)
    serial_number = models.CharField(max_length=100, blank=True)

    # Transfer-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∏
    from_location = models.ForeignKey(InventoryLocation, on_delete=models.PROTECT)
    to_location = models.ForeignKey(InventoryLocation, on_delete=models.PROTECT, null=True)
```

**–ö–ª—é—á–æ–≤–∏ —Å–≤–æ–π—Å—Ç–≤–∞:**
- `effective_quantity` - –ó–Ω–∞–∫–æ–≤–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–∑–∏—Ä–∞–Ω–æ –Ω–∞ —Ç–∏–ø–∞ –¥–≤–∏–∂–µ–Ω–∏–µ
- `total_cost_value` - quantity √ó cost_price  
- `total_profit` - quantity √ó profit_amount
- `profit_margin_percentage` - –ü–µ—á–∞–ª–±–∞ –∫–∞—Ç–æ –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –ø—Ä–æ–¥–∞–∂–Ω–∞—Ç–∞ —Ü–µ–Ω–∞

**–î–µ—Å–µ—Ç–∏—á–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
```python
from core.utils.decimal_utils import round_cost_price, round_currency

def save(self, *args, **kwargs):
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∞–≤–∏–ª–Ω–æ –∑–∞–∫—Ä—ä–≥–ª—è–≤–∞–Ω–µ
    if self.cost_price:
        self.cost_price = round_cost_price(self.cost_price)  # 4dp
    if self.sale_price:
        self.sale_price = round_currency(self.sale_price)    # 2dp
    super().save(*args, **kwargs)
```

### 2. **InventoryItem** (–ö–µ—à –∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–Ω–æ—Å—Ç)

**–¶–µ–ª**: –ë—ä—Ä–∑ –¥–æ—Å—Ç—ä–ø –¥–æ —Ç–µ–∫—É—â–∏ –Ω–∏–≤–∞ –Ω–∞ —Å–∫–ª–∞–¥–∞ –∑–∞ –ª–æ–∫–∞—Ü–∏—è/–ø—Ä–æ–¥—É–∫—Ç

```python
class InventoryItem(models.Model):
    # –¢–µ–∫—É—â–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ
    current_qty = QuantityField()      # –û–±—â–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞ —Ä–∞–∑–ø–æ–ª–æ–∂–µ–Ω–∏–µ
    reserved_qty = QuantityField()     # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑–µ—Ä–≤–∏—Ä–∞–Ω–æ –∑–∞ –ø–æ—Ä—ä—á–∫–∏
    avg_cost = CostPriceField()        # –ü—Ä–µ—Ç–µ–≥–ª–µ–Ω–∞ —Å—Ä–µ–¥–Ω–∞ —Å–µ–±–µ—Å—Ç–æ–π–Ω–æ—Å—Ç (4dp)

    # –ò–∑–≤–µ–¥–µ–Ω–∏ —Å–≤–æ–π—Å—Ç–≤–∞
    @property
    def available_qty(self):
        return self.current_qty - self.reserved_qty

    @property 
    def stock_value(self):
        from core.utils.decimal_utils import round_currency
        return round_currency(self.current_qty * self.avg_cost)
```

**–û—Å–≤–µ–∂–∞–≤–∞–Ω–µ –Ω–∞ –∫–µ—à–∞**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞–Ω –æ—Ç MovementService –æ–ø–µ—Ä–∞—Ü–∏–∏

### 3. **InventoryBatch** (Batch —Å–ª–µ–¥–µ–Ω–µ)

**–¶–µ–ª**: –ü—Ä–æ—Å–ª–µ–¥—è–≤–∞ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª–Ω–∏ –ø–∞—Ä—Ç–∏–¥–∏ –∑–∞ FIFO –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –¥–∞—Ç–∏ –Ω–∞ –∏–∑—Ç–∏—á–∞–Ω–µ

```python
class InventoryBatch(models.Model):
    # Batch –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç
    batch_number = models.CharField(max_length=100)
    expiry_date = models.DateField(null=True)

    # –ö–æ–ª–∏—á–µ—Å—Ç–≤–∞
    received_qty = QuantityField()      # –ü—ä—Ä–≤–æ–Ω–∞—á–∞–ª–Ω–æ –ø–æ–ª—É—á–µ–Ω–æ
    remaining_qty = QuantityField()     # –í—Å–µ –æ—â–µ –Ω–∞–ª–∏—á–Ω–æ
    cost_price = CostPriceField()       # –°–µ–±–µ—Å—Ç–æ–π–Ω–æ—Å—Ç –∑–∞ —Ç–∞–∑–∏ –ø–∞—Ä—Ç–∏–¥–∞ (4dp)

    # Batch —Å—Ç–∞—Ç—É—Å
    is_unknown_batch = models.BooleanField(default=False)  # –ê–≤—Ç–æ-–≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–∞ –ø–∞—Ä—Ç–∏–¥–∞
    received_date = models.DateField()
```

### 4. **InventoryLocation**

**–¶–µ–ª**: –î–µ—Ñ–∏–Ω–∏—Ä–∞ —Å–∫–ª–∞–¥–æ–≤–∏ –ª–æ–∫–∞—Ü–∏–∏ —Å—ä—Å —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è

```python
class InventoryLocation(models.Model):
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ –ª–æ–∫–∞—Ü–∏—è—Ç–∞
    allow_negative_stock = models.BooleanField(default=False)
    should_track_batches = models.BooleanField(default=True)

    # –ú–µ—Ç–æ–¥–∏
    def should_track_batches(self, product):
        return self.track_batches and product.track_batches
```

---

## –£—Å–ª—É–≥–∏

### 1. **MovementService** - –û—Å–Ω–æ–≤–Ω–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –¥–≤–∏–∂–µ–Ω–∏—è

**–ü—ä—Ä–≤–∏—á–µ–Ω API (Result Pattern):**

```python
from inventory.services.movement_service import MovementService
from core.utils.decimal_utils import Decimal

# –í—Ö–æ–¥—è—â —Å–∫–ª–∞–¥
result = MovementService.create_incoming_stock(
    location=warehouse,
    product=product,
    quantity=Decimal('100.000'),
    cost_price=Decimal('12.5000'),  # 4dp —Ç–æ—á–Ω–æ—Å—Ç –∑–∞ —Å–µ–±–µ—Å—Ç–æ–π–Ω–æ—Å—Ç–∏
    source_document_type='DELIVERY',
    source_document_number='DEL-001',
    batch_number='BATCH-2024-001'
)

# –ò–∑—Ö–æ–¥—è—â —Å–∫–ª–∞–¥ (FIFO)
result = MovementService.create_outgoing_stock(
    location=warehouse,
    product=product,
    quantity=Decimal('50.000'),
    source_document_type='SALE',
    sale_price=Decimal('18.00'),  # 2dp –∑–∞ –¥–∏—Å–ø–ª–µ–π —Ü–µ–Ω–∏
    use_fifo=True
)

# –°–∫–ª–∞–¥–æ–≤ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä
result = MovementService.create_stock_transfer(
    from_location=warehouse_a,
    to_location=warehouse_b,
    product=product,
    quantity=Decimal('25.000')
)

# –ö–æ—Ä–µ–∫—Ü–∏—è –Ω–∞ —Å–∫–ª–∞–¥–∞
result = MovementService.create_stock_adjustment(
    location=warehouse,
    product=product,
    adjustment_qty=Decimal('-5.000'),  # –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª–Ω–æ –∑–∞ –Ω–∞–º–∞–ª—è–≤–∞–Ω–µ
    reason='–ü–æ–≤—Ä–µ–¥–µ–Ω–∏ —Å—Ç–æ–∫–∏'
)
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥–æ–∫—É–º–µ–Ω—Ç–∏:**
```python
# –û–±—Ä–∞–±–æ—Ç–≤–∞ –¥–æ–∫—É–º–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
result = MovementService.process_document_movements(delivery_document)

# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–∞ –¥–≤–∏–∂–µ–Ω–∏—è —Å—ä—Å —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞
result = MovementService.sync_movements_with_document(purchase_order)
```

### 2. **InventoryService** - –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Å–∫–ª–∞–¥–∞ –∏ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏–∏

```python
from inventory.services.inventory_service import InventoryService

# –ü—Ä–æ–≤–µ—Ä—è–≤–∞ –Ω–∞–ª–∏—á–Ω–æ—Å—Ç –Ω–∞ —Å–∫–ª–∞–¥–∞
result = InventoryService.validate_availability(
    location, product, Decimal('75.000')
)
if result.ok:
    available_qty = result.data['available_qty']
    can_fulfill = result.data['can_fulfill']

# –ù–∞–ª–∏—á–Ω–æ—Å—Ç –Ω–∞ –ø–∞—Ä—Ç–∏–¥–∏ (FIFO-aware)
result = InventoryService.validate_batch_availability(
    location, product, Decimal('75.000')
)
if result.ok:
    batch_details = result.data['batch_details']

# –†–µ–∑–µ—Ä–≤–∏—Ä–∞ —Å–∫–ª–∞–¥
result = InventoryService.reserve_stock_qty(
    location, product, Decimal('25.000')
)

# –†–µ–∑—é–º–µ –Ω–∞ —Å–∫–ª–∞–¥–∞
result = InventoryService.get_stock_summary(location, product)
stock_data = result.data
```

---

## –°–∏—Å—Ç–µ–º–∞ –∑–∞ —Å–∫–ª–∞–¥–æ–≤–∏ –¥–≤–∏–∂–µ–Ω–∏—è

### –¢–∏–ø–æ–≤–µ –¥–≤–∏–∂–µ–Ω–∏—è

| –¢–∏–ø | –ü–æ—Å–æ–∫–∞ | –¶–µ–ª | –ü—Ä–∏–º–µ—Ä |
|-----|--------|-----|--------|
| `IN` | –í—Ö–æ–¥—è—â–æ | –ü–æ–∫—É–ø–∫–∏, –ø–æ–ª—É—á–∞–≤–∞–Ω–∏—è | –ü–æ–ª—É—á–∞–≤–∞–Ω–µ –Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞ |
| `OUT` | –ò–∑—Ö–æ–¥—è—â–æ | –ü—Ä–æ–¥–∞–∂–±–∏, –∏–∑–¥–∞–≤–∞–Ω–∏—è | –ò–∑–ø—ä–ª–Ω–µ–Ω–∏–µ –Ω–∞ –ø—Ä–æ–¥–∞–∂–±–∞ |
| `TRANSFER` | –ò –¥–≤–µ—Ç–µ | –ú–µ–∂–¥—É –ª–æ–∫–∞—Ü–∏–∏ | –°–∫–ª–∞–¥–æ–≤ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä |
| `ADJUSTMENT` | –ò –¥–≤–µ—Ç–µ | –ö–æ—Ä–µ–∫—Ü–∏–∏ | –ö–æ—Ä–µ–∫—Ü–∏–∏ –æ—Ç –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è |
| `PRODUCTION` | –í—Ö–æ–¥—è—â–æ | –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ | –°–≥–ª–æ–±—è–≤–∞–Ω–µ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç |
| `CYCLE_COUNT` | –ò –¥–≤–µ—Ç–µ | –°–∫–ª–∞–¥–æ–≤–∏ –æ–¥–∏—Ç–∏ | –ö–æ—Ä–µ–∫—Ü–∏–∏ –æ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–æ –±—Ä–æ–µ–Ω–µ |

### FIFO –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ–Ω FIFO –∑–∞ batch-tracked –ø—Ä–æ–¥—É–∫—Ç–∏:**

```python
# –ü—Ä–∏ —Å—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ –∏–∑—Ö–æ–¥—è—â–æ –¥–≤–∏–∂–µ–Ω–∏–µ –∑–∞ batch-tracked –ø—Ä–æ–¥—É–∫—Ç
movements = MovementService._create_fifo_outgoing_movements(
    location, product, quantity=Decimal('100.000'),
    sale_price=Decimal('15.00')
)

# –†–µ–∑—É–ª—Ç–∏—Ä–∞ –≤ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –¥–≤–∏–∂–µ–Ω–∏—è –æ—Ç —Ä–∞–∑–ª–∏—á–Ω–∏ –ø–∞—Ä—Ç–∏–¥–∏:
# Movement 1: 60 –µ–¥–∏–Ω–∏—Ü–∏ –æ—Ç BATCH-A @ —Å–µ–±–µ—Å—Ç–æ–π–Ω–æ—Å—Ç $10.00
# Movement 2: 40 –µ–¥–∏–Ω–∏—Ü–∏ –æ—Ç BATCH-B @ —Å–µ–±–µ—Å—Ç–æ–π–Ω–æ—Å—Ç $12.00
# –û–±—â–∞—Ç–∞ –ø–µ—á–∞–ª–±–∞ —Å–µ –∫–∞–ª–∫—É–ª–∏—Ä–∞ –∑–∞ –≤—Å—è–∫–∞ –ø–∞—Ä—Ç–∏–¥–∞
```

### –ü—Ä–æ—Å–ª–µ–¥—è–≤–∞–Ω–µ –Ω–∞ –ø–µ—á–∞–ª–±–∞—Ç–∞

**–ü–æ–¥–æ–±—Ä–µ–Ω Movement –º–æ–¥–µ–ª:**
- `sale_price` - –ï–¥–∏–Ω–∏—á–Ω–∞ –ø—Ä–æ–¥–∞–∂–Ω–∞ —Ü–µ–Ω–∞ –∑–∞ OUT –¥–≤–∏–∂–µ–Ω–∏—è (2dp —Ç–æ—á–Ω–æ—Å—Ç)
- `profit_amount` - –ö–∞–ª–∫—É–ª–∏—Ä–∞–Ω–∞ –ø–µ—á–∞–ª–±–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü–∞ (2dp —Ç–æ—á–Ω–æ—Å—Ç)
- `total_profit` —Å–≤–æ–π—Å—Ç–≤–æ - –û–±—â–∞ –ø–µ—á–∞–ª–±–∞ –∑–∞ –¥–≤–∏–∂–µ–Ω–∏–µ—Ç–æ
- `profit_margin_percentage` - –ú–∞—Ä–∂ –∫–∞—Ç–æ –ø—Ä–æ—Ü–µ–Ω—Ç

**–ê–Ω–∞–ª–∏–∑ –Ω–∞ –ø–µ—á–∞–ª–±–∞—Ç–∞:**
```python
# –ü–æ–ª—É—á–∞–≤–∞ —Ä–µ–∑—é–º–µ –Ω–∞ –ø–µ—á–∞–ª–±–∞—Ç–∞ –∑–∞ –ª–æ–∫–∞—Ü–∏—è
summary = InventoryMovement.get_profit_summary(
    location=warehouse,
    date_from=start_date,
    date_to=end_date
)

# –†–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ –≤–∫–ª—é—á–≤–∞—Ç:
# - total_revenue, total_cost, total_profit
# - profit_margin_percentage
# - –ë—Ä–æ–π –¥–≤–∏–∂–µ–Ω–∏—è –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
```

---

## Batch —Å–ª–µ–¥–µ–Ω–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–∏ –ø–∞—Ä—Ç–∏–¥–∏

**–ó–∞ –ø—Ä–æ–¥—É–∫—Ç–∏ –∏–∑–∏—Å–∫–≤–∞—â–∏ batch —Å–ª–µ–¥–µ–Ω–µ:**
```python
# –ö–æ–≥–∞—Ç–æ –Ω–µ –µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–µ–Ω batch_number –∑–∞ –≤—Ö–æ–¥—è—â–æ –¥–≤–∏–∂–µ–Ω–∏–µ
auto_batch = f"AUTO_{product.code}_{date}_{location.code}"
# –ü—Ä–∏–º–µ—Ä: "AUTO_WIDGET123_241201_WH01"
```

### Batch –≤–∞–ª–∏–¥–∞—Ü–∏—è

```python
def clean(self):
    # –ê–≤—Ç–æ-–≥–µ–Ω–µ—Ä–∏—Ä–∞ –ø–∞—Ä—Ç–∏–¥–∞ –∑–∞ tracked –ø—Ä–æ–¥—É–∫—Ç–∏
    if (self.product and self.product.track_batches and
            self.movement_type == self.IN and not self.batch_number):
        self.batch_number = self.generate_auto_batch()
```

### FIFO Batch –∫–æ–Ω—Å—É–º–∞—Ü–∏—è

**–†–µ–¥**: `created_at` ASC (–Ω–∞–π-—Å—Ç–∞—Ä–∏—Ç–µ –ø—ä—Ä–≤–æ)
```python
available_batches = InventoryBatch.objects.filter(
    location=location,
    product=product, 
    remaining_qty__gt=0
).order_by('created_at')

for batch in available_batches:
    qty_from_batch = min(remaining_qty, batch.remaining_qty)
    # –°—ä–∑–¥–∞–≤–∞ –¥–≤–∏–∂–µ–Ω–∏–µ –æ—Ç —Ç–∞–∑–∏ –ø–∞—Ä—Ç–∏–¥–∞
    # –ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞ batch.remaining_qty
```

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥–æ–∫—É–º–µ–Ω—Ç–Ω–∞—Ç–∞ —Å–∏—Å—Ç–µ–º–∞

### Status-Driven —Å—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ –¥–≤–∏–∂–µ–Ω–∏—è

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á—Ä–µ–∑ DocumentTypeStatus:**

```python
# –ö–æ–≥–∞—Ç–æ —Å–µ –ø—Ä–æ–º–µ–Ω—è —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞
current_config = DocumentTypeStatus.objects.filter(
    document_type=document.document_type,
    status__code=document.status,
    is_active=True
).first()

if current_config.creates_inventory_movements:
    # –°—ä–∑–¥–∞–≤–∞ –¥–≤–∏–∂–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
    movements = MovementService.process_document_movements(document)
```

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–Ω–∏ –¥–≤–∏–∂–µ–Ω–∏—è

**–£–º–Ω–∞ Sync –ª–æ–≥–∏–∫–∞:**
```python
def sync_movements_with_document(document):
    # 1. –ü—Ä–æ–≤–µ—Ä—è–≤–∞ –¥–∞–ª–∏ –∫–æ—Ä–µ–∫—Ü–∏—è—Ç–∞ –µ –ø–æ–∑–≤–æ–ª–µ–Ω–∞ –æ—Ç status –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Ç–∞
    if not current_config.allows_movement_correction:
        return error
    
    # 2. –ò–∑—Ç—Ä–∏–≤–∞ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—â–∏ –¥–≤–∏–∂–µ–Ω–∏—è
    original_movements.delete()
    reversal_movements.delete()
    
    # 3. –ü—Ä–µ—Å—ä–∑–¥–∞–≤–∞ –∞–∫–æ —Å—Ç–∞—Ç—É—Å—ä—Ç –∏–∑–∏—Å–∫–≤–∞ –¥–≤–∏–∂–µ–Ω–∏—è
    if current_config.creates_inventory_movements:
        new_movements = create_from_document(document)
```

### –ü–æ–¥–¥—ä—Ä–∂–∞–Ω–∏ —Ç–∏–ø–æ–≤–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏

| –¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç | –¢–∏–ø –¥–≤–∏–∂–µ–Ω–∏–µ | Trigger —Å—Ç–∞—Ç—É—Å | –ë–µ–ª–µ–∂–∫–∏ |
|--------------|-------------|---------------|---------|
| DeliveryReceipt | IN | completed | –°—ä–∑–¥–∞–≤–∞ –≤—Ö–æ–¥—è—â —Å–∫–ª–∞–¥ |
| PurchaseOrder | IN | approved (–∞–∫–æ auto_receive) | –û–ø—Ü–∏–æ–Ω–∞–ª–Ω–æ –∞–≤—Ç–æ-–ø–æ–ª—É—á–∞–≤–∞–Ω–µ |
| SalesOrder | OUT | shipped | –°—ä–∑–¥–∞–≤–∞ –∏–∑—Ö–æ–¥—è—â —Å–∫–ª–∞–¥ |
| StockTransfer | TRANSFER | completed | –ú–µ–∂–¥—É –ª–æ–∫–∞—Ü–∏–∏ |
| StockAdjustment | ADJUSTMENT | approved | –ö–æ—Ä–µ–∫—Ü–∏–∏ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ |

---

## –î–µ—Å–µ—Ç–∏—á–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å—ä—Å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–∞–Ω–∏—Ç–µ –ø–æ–ª–µ—Ç–∞

```python
from core.models.fields import CostPriceField, CurrencyField, QuantityField
from core.utils.decimal_utils import round_cost_price, round_currency

class InventoryMovement(models.Model):
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ 3dp —Ç–æ—á–Ω–æ—Å—Ç –∑–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
    quantity = QuantityField()
    
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ 4dp —Ç–æ—á–Ω–æ—Å—Ç –∑–∞ –∫–∞–ª–∫—É–ª–∞—Ü–∏–æ–Ω–Ω–∏ —Ü–µ–Ω–∏
    cost_price = CostPriceField()
    
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ 2dp —Ç–æ—á–Ω–æ—Å—Ç –∑–∞ –¥–∏—Å–ø–ª–µ–π —Ü–µ–Ω–∏
    sale_price = CurrencyField()
    profit_amount = CurrencyField()
```

### –ö–∞–ª–∫—É–ª–∞—Ü–∏–æ–Ω–Ω–∞ –ª–æ–≥–∏–∫–∞

```python
def calculate_profit_amount(self):
    """–ö–∞–ª–∫—É–ª–∏—Ä–∞ –ø–µ—á–∞–ª–±–∞ –∏–∑–ø–æ–ª–∑–≤–∞–π–∫–∏ –ø—Ä–∞–≤–∏–ª–Ω–∞—Ç–∞ –¥–µ—Å–µ—Ç–∏—á–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç"""
    if self.sale_price and self.cost_price:
        # –ú–µ–∂–¥–∏–Ω–Ω–∏ –∫–∞–ª–∫—É–ª–∞—Ü–∏–∏ —Å –ø–æ-–≤–∏—Å–æ–∫–∞ —Ç–æ—á–Ω–æ—Å—Ç
        profit_per_unit = self.sale_price - self.cost_price
        # –§–∏–Ω–∞–ª–Ω–æ –∑–∞–∫—Ä—ä–≥–ª—è–≤–∞–Ω–µ –∑–∞ –¥–∏—Å–ø–ª–µ–π
        self.profit_amount = round_currency(profit_per_unit)
    return self.profit_amount

@property
def total_profit(self):
    """–û–±—â–∞ –ø–µ—á–∞–ª–±–∞ –∑–∞ –¥–≤–∏–∂–µ–Ω–∏–µ—Ç–æ"""
    if self.profit_amount:
        total = self.quantity * self.profit_amount
        return round_currency(total)
    return Decimal('0.00')
```

### Weighted Average Cost –∫–∞–ª–∫—É–ª–∞—Ü–∏—è

```python
def update_average_cost(self, new_quantity, new_cost):
    """–ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞ –ø—Ä–µ—Ç–µ–≥–ª–µ–Ω–∞—Ç–∞ —Å—Ä–µ–¥–Ω–∞ —Å–µ–±–µ—Å—Ç–æ–π–Ω–æ—Å—Ç —Å –ø—Ä–∞–≤–∏–ª–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç"""
    from core.utils.decimal_utils import round_cost_price
    
    current_value = self.current_qty * self.avg_cost
    new_value = new_quantity * new_cost
    total_qty = self.current_qty + new_quantity
    
    if total_qty > 0:
        # –ö–∞–ª–∫—É–ª–∏—Ä–∞ —Å –≤–∏—Å–æ–∫–∞ —Ç–æ—á–Ω–æ—Å—Ç, –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ä–≥–ª—è –∑–∞ —Å—ä—Ö—Ä–∞–Ω–µ–Ω–∏–µ
        new_avg = (current_value + new_value) / total_qty
        self.avg_cost = round_cost_price(new_avg)  # 4dp –∑–∞ –∫–∞–ª–∫—É–ª–∞—Ü–∏–∏
```

---

## –®–∞–±–ª–æ–Ω–∏ –∑–∞ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ

### 1. **Document Processing Pattern**

```python
# –í DocumentService –∫–æ–≥–∞—Ç–æ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ –ø—Ä–æ–º–µ–Ω—è –∫—ä–º 'completed'
from inventory.services.movement_service import MovementService

def transition_to_completed(self):
    # –î—Ä—É–≥–∞ –ª–æ–≥–∏–∫–∞ –∑–∞ –ø—Ä–æ–º—è–Ω–∞ –Ω–∞ —Å—Ç–∞—Ç—É—Å...
    
    # –ü—Ä–æ–≤–µ—Ä—è–≤–∞ –¥–∞–ª–∏ —Ç–æ–∑–∏ —Å—Ç–∞—Ç—É—Å —Å—ä–∑–¥–∞–≤–∞ –¥–≤–∏–∂–µ–Ω–∏—è
    if self.status_config.creates_inventory_movements:
        movement_result = MovementService.process_document_movements(self.document)
        if not movement_result.ok:
            return Result.error('MOVEMENT_FAILED', movement_result.msg)
    
    return Result.success()
```

### 2. **Sales Integration Pattern**

```python
# –í sales –æ–±—Ä–∞–±–æ—Ç–∫–∞
def fulfill_order_line(order_line):
    # –ü—Ä–æ–≤–µ—Ä—è–≤–∞ –Ω–∞–ª–∏—á–Ω–æ—Å—Ç
    availability = InventoryService.validate_availability(
        location, product, order_line.quantity
    )
    
    if not availability.ok:
        return availability  # –ù–µ–¥–æ—Å—Ç–∞—Ç—ä—á–µ–Ω —Å–∫–ª–∞–¥
    
    # –°—ä–∑–¥–∞–≤–∞ –∏–∑—Ö–æ–¥—è—â–æ –¥–≤–∏–∂–µ–Ω–∏–µ —Å –ø—Ä–æ—Å–ª–µ–¥—è–≤–∞–Ω–µ –Ω–∞ –ø–µ—á–∞–ª–±–∞—Ç–∞
    movement_result = MovementService.create_outgoing_stock(
        location=warehouse,
        product=order_line.product,
        quantity=order_line.quantity,
        source_document_type='SALE',
        source_document_number=order.number,
        sale_price=order_line.unit_price,
        use_fifo=True
    )
    
    return movement_result
```

### 3. **Reservation Pattern**

```python
# –†–µ–∑–µ—Ä–≤–∏—Ä–∞ —Å–∫–ª–∞–¥ –∑–∞ —á–∞–∫–∞—â–∏ –ø–æ—Ä—ä—á–∫–∏
def reserve_stock_for_order(order):
    for line in order.lines.all():
        reserve_result = InventoryService.reserve_stock_qty(
            location=order.location,
            product=line.product,
            quantity=line.quantity,
            reason=f"–†–µ–∑–µ—Ä–≤–∏—Ä–∞–Ω–æ –∑–∞ –ø–æ—Ä—ä—á–∫–∞ {order.number}"
        )
        
        if not reserve_result.ok:
            # –û–±—Ä–∞–±–æ—Ç–≤–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç—ä—á–µ–Ω —Å–∫–ª–∞–¥
            return reserve_result
    
    return Result.success()
```

### 4. **–î–µ—Å–µ—Ç–∏—á–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç Pattern**

```python
# –ü—Ä–∞–≤–∏–ª–Ω–∞ —Ä–∞–±–æ—Ç–∞ —Å —Ü–µ–Ω–∏ –∏ –∫–∞–ª–∫—É–ª–∞—Ü–∏–∏
from core.utils.decimal_utils import round_cost_price, round_currency

def process_inventory_transaction():
    # –í—Ö–æ–¥–Ω–∏ –¥–∞–Ω–Ω–∏ –º–æ–≥–∞—Ç –¥–∞ –∏–º–∞—Ç —Ä–∞–∑–ª–∏—á–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç
    raw_cost = Decimal('15.256789')
    raw_price = Decimal('24.9876')
    
    # –ò–∑–ø–æ–ª–∑–≤–∞–π –ø—Ä–∞–≤–∏–ª–Ω–æ—Ç–æ –∑–∞–∫—Ä—ä–≥–ª—è–≤–∞–Ω–µ –∑–∞ —Ä–∞–∑–ª–∏—á–Ω–∏ —Ü–µ–ª–∏
    storage_cost = round_cost_price(raw_cost)    # 15.2568 –∑–∞ –∫–∞–ª–∫—É–ª–∞—Ü–∏–∏
    display_price = round_currency(raw_price)    # 24.99 –∑–∞ –¥–∏—Å–ø–ª–µ–π
    
    # –°—ä–∑–¥–∞–π –¥–≤–∏–∂–µ–Ω–∏–µ —Å –ø—Ä–∞–≤–∏–ª–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç
    result = MovementService.create_incoming_stock(
        cost_price=storage_cost,    # 4dp –∑–∞ —Ç–æ—á–Ω–∏ –∫–∞–ª–∫—É–ª–∞—Ü–∏–∏
        sale_price=display_price,   # 2dp –∑–∞ –¥–∏—Å–ø–ª–µ–π
        ...
    )
```

---

## API —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫

### MovementService –º–µ—Ç–æ–¥–∏

| –ú–µ—Ç–æ–¥ | –¶–µ–ª | –í—Ä—ä—â–∞ | –ö–ª—é—á–æ–≤–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ |
|-------|-----|-------|------------------|
| `create_incoming_stock()` | –î–æ–±–∞–≤—è inventory | Result | location, product, quantity, cost_price |
| `create_outgoing_stock()` | –ü—Ä–µ–º–∞—Ö–≤–∞ inventory | Result | location, product, quantity, sale_price |
| `create_stock_transfer()` | –¢—Ä–∞–Ω—Å—Ñ–µ—Ä –º–µ–∂–¥—É –ª–æ–∫–∞—Ü–∏–∏ | Result | from_location, to_location, product, quantity |
| `create_stock_adjustment()` | –ö–æ—Ä–µ–∫—Ü–∏–∏ –Ω–∞ inventory | Result | location, product, adjustment_qty, reason |
| `process_document_movements()` | –ê–≤—Ç–æ-—Å—ä–∑–¥–∞–≤–∞ –æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç | Result | document |
| `sync_movements_with_document()` | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–∞ —Å –ø—Ä–æ–º–µ–Ω–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞ | Result | document |

### InventoryService –º–µ—Ç–æ–¥–∏

| –ú–µ—Ç–æ–¥ | –¶–µ–ª | –í—Ä—ä—â–∞ | –ö–ª—é—á–æ–≤–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ |
|-------|-----|-------|------------------|
| `validate_availability()` | –ü—Ä–æ–≤–µ—Ä—è–≤–∞ –Ω–∏–≤–∞ –Ω–∞ —Å–∫–ª–∞–¥–∞ | Result | location, product, required_qty |
| `validate_batch_availability()` | –ü—Ä–æ–≤–µ—Ä—è–≤–∞ batch —Å–∫–ª–∞–¥ (FIFO) | Result | location, product, required_qty |
| `reserve_stock_qty()` | –†–µ–∑–µ—Ä–≤–∏—Ä–∞ inventory | Result | location, product, quantity |
| `release_reservation()` | –û—Å–≤–æ–±–æ–∂–¥–∞–≤–∞ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—è | Result | location, product, quantity |
| `get_stock_summary()` | –ü—ä–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ —Å–∫–ª–∞–¥–∞ | Result | location, product |

### Result —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –æ—Ç –¥–∞–Ω–Ω–∏

**–†–µ–∑—É–ª—Ç–∞—Ç –æ—Ç —Å—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ –¥–≤–∏–∂–µ–Ω–∏–µ:**
```python
{
    'movement_id': 12345,
    'quantity': Decimal('100.000'),
    'cost_price': Decimal('12.5000'),  # 4dp —Ç–æ—á–Ω–æ—Å—Ç
    'sale_price': Decimal('18.00'),    # 2dp —Ç–æ—á–Ω–æ—Å—Ç
    'location_code': 'WH01',
    'product_code': 'WIDGET123',
    'batch_number': 'BATCH-001',
    'cache_updated': True,
    'profit_amount': Decimal('5.50'),   # 2dp —Ç–æ—á–Ω–æ—Å—Ç
    'total_profit': Decimal('550.00')   # 2dp —Ç–æ—á–Ω–æ—Å—Ç
}
```

**–†–µ–∑—É–ª—Ç–∞—Ç –æ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–Ω–æ—Å—Ç:**
```python
{
    'available': True,
    'current_qty': Decimal('500.000'),     # 3dp —Ç–æ—á–Ω–æ—Å—Ç
    'available_qty': Decimal('450.000'),   # 3dp —Ç–æ—á–Ω–æ—Å—Ç
    'reserved_qty': Decimal('50.000'),     # 3dp —Ç–æ—á–Ω–æ—Å—Ç
    'can_fulfill': True,
    'shortage': Decimal('0.000'),
    'avg_cost': Decimal('10.2500'),        # 4dp —Ç–æ—á–Ω–æ—Å—Ç
    'stock_value': Decimal('5125.00'),     # 2dp –∑–∞ –¥–∏—Å–ø–ª–µ–π
    'product_code': 'WIDGET123',
    'location_code': 'WH01'
}
```

**–†–µ–∑—É–ª—Ç–∞—Ç –æ—Ç batch –Ω–∞–ª–∏—á–Ω–æ—Å—Ç:**
```python
{
    'total_available': Decimal('450.000'),
    'can_fulfill': True,
    'batch_count': 3,
    'batch_details': [
        {
            'batch_number': 'BATCH-A',
            'remaining_qty': Decimal('200.000'),      # 3dp —Ç–æ—á–Ω–æ—Å—Ç
            'cost_price': Decimal('10.0000'),         # 4dp —Ç–æ—á–Ω–æ—Å—Ç
            'expiry_date': '2024-12-31',
            'is_expired': False,
            'can_use_qty': Decimal('100.000')
        }
        # ... –ø–æ–≤–µ—á–µ –ø–∞—Ä—Ç–∏–¥–∏
    ]
}
```

---

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –≥—Ä–µ—à–∫–∏

### –û–±—â–∏ –∫–æ–¥–æ–≤–µ –∑–∞ –≥—Ä–µ—à–∫–∏

| –ö–æ–¥ | –ó–Ω–∞—á–µ–Ω–∏–µ | –†–µ—à–µ–Ω–∏–µ |
|-----|----------|---------|
| `INSUFFICIENT_STOCK` | –ù–µ–¥–æ—Å—Ç–∞—Ç—ä—á–µ–Ω –Ω–∞–ª–∏—á–µ–Ω —Å–∫–ª–∞–¥ | –ü—Ä–æ–≤–µ—Ä–µ—Ç–µ –Ω–∞–ª–∏—á–Ω–æ—Å—Ç—Ç–∞ –ø—ä—Ä–≤–æ |
| `INSUFFICIENT_BATCH_STOCK` | –ù–µ–¥–æ—Å—Ç–∞—Ç—ä—á–Ω–æ –≤ –ø–∞—Ä—Ç–∏–¥–∏—Ç–µ | –ü—Ä–æ–≤–µ—Ä–µ—Ç–µ batch –Ω–∞–ª–∏—á–Ω–æ—Å—Ç |
| `INVALID_QUANTITY` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ <= 0 | –í–∞–ª–∏–¥–∏—Ä–∞–π—Ç–µ –≤—Ö–æ–¥–∞ |
| `FRACTIONAL_PIECES` | –ù–µ-—Ü—è–ª–æ —á–∏—Å–ª–æ –∑–∞ –ø—Ä–æ–¥—É–∫—Ç–∏ –≤ –±—Ä–æ–π–∫–∏ | –ó–∞–∫—Ä—ä–≥–ª—è–≤–∞–Ω–µ –¥–æ —Ü—è–ª–æ —á–∏—Å–ª–æ |
| `MOVEMENT_CREATION_ERROR` | –°–∏—Å—Ç–µ–º–Ω–∞ –≥—Ä–µ—à–∫–∞ –≤ –¥–≤–∏–∂–µ–Ω–∏–µ—Ç–æ | –ü—Ä–æ–≤–µ—Ä–µ—Ç–µ –ª–æ–≥–æ–≤–µ—Ç–µ, –æ–ø–∏—Ç–∞–π—Ç–µ –æ—Ç–Ω–æ–≤–æ |
| `ITEM_NOT_FOUND` | –ù—è–º–∞ inventory –∑–∞–ø–∏—Å | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–∞–π—Ç–µ —Å–∫–ª–∞–¥–∞ –ø—ä—Ä–≤–æ |
| `DECIMAL_PRECISION_ERROR` | –ì—Ä–µ—à–Ω–∞ –¥–µ—Å–µ—Ç–∏—á–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç | –ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª–Ω–∏—Ç–µ decimal utilities |

### Pattern –∑–∞ –æ—Ç–≥–æ–≤–æ—Ä –ø—Ä–∏ –≥—Ä–µ—à–∫–∞

```python
if not result.ok:
    error_info = {
        'code': result.code,           # –ö–æ–¥ –∑–∞ –≥—Ä–µ—à–∫–∞
        'message': result.msg,         # –ß–æ–≤–µ—à–∫–∏ —á–µ—Ç–ª–∏–≤–æ —Å—ä–æ–±—â–µ–Ω–∏–µ
        'data': result.data,           # –î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–µ–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç
        'suggestions': [               # –í—ä–∑–º–æ–∂–Ω–∏ —Ä–µ—à–µ–Ω–∏—è
            '–ü—Ä–æ–≤–µ—Ä–µ—Ç–µ –Ω–∞–ª–∏—á–Ω–æ—Å—Ç—Ç–∞ –Ω–∞ —Å–∫–ª–∞–¥–∞',
            '–ü—Ä–æ–≤–µ—Ä–µ—Ç–µ –¥–∞–ª–∏ –ø—Ä–æ–¥—É–∫—Ç—ä—Ç —Å—ä—â–µ—Å—Ç–≤—É–≤–∞ –≤ –ª–æ–∫–∞—Ü–∏—è—Ç–∞',
            '–ü—Ä–æ–≤–µ—Ä–µ—Ç–µ –¥–µ—Å–µ—Ç–∏—á–Ω–∞—Ç–∞ —Ç–æ—á–Ω–æ—Å—Ç –Ω–∞ –≤—Ö–æ–¥–Ω–∏—Ç–µ –¥–∞–Ω–Ω–∏'
        ]
    }
```

---

## –°—ä–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–Ω–æ—Å—Ç

### 1. **–ï–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏**

```python
# –í—Å–∏—á–∫–∏ –∫—Ä–∏—Ç–∏—á–Ω–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–∑–ø–æ–ª–∑–≤–∞—Ç select_for_update()
with transaction.atomic():
    item = InventoryItem.objects.select_for_update().get(
        location=location, product=product
    )
    # –ê—Ç–æ–º–Ω–∏ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
    item.current_qty = F('current_qty') - quantity
    item.save()
```

### 2. **Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞**

```python
# –ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ bulk –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –¥–≤–∏–∂–µ–Ω–∏—è
result = MovementService.bulk_create_movements(movement_data_list)
```

### 3. **–°—Ç—Ä–∞—Ç–µ–≥–∏—è –∑–∞ –∫–µ—à–∏—Ä–∞–Ω–µ**

- InventoryItem –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞–Ω –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª–Ω–æ (–Ω–µ –ø—ä–ª–Ω–æ –æ—Å–≤–µ–∂–∞–≤–∞–Ω–µ)
- Batch –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞–Ω–∏ –∞—Ç–æ–º–∏—á–Ω–æ —Å F() expressions
- –ò—Å—Ç–æ—Ä–∏—è—Ç–∞ –Ω–∞ –¥–≤–∏–∂–µ–Ω–∏—è—Ç–∞ –ø–∞–≥–∏–Ω–∏—Ä–∞–Ω–∞ –∑–∞ –≥–æ–ª–µ–º–∏ –Ω–∞–±–æ—Ä–∏ –¥–∞–Ω–Ω–∏
- Decimal –∫–∞–ª–∫—É–ª–∞—Ü–∏–∏ –∫–µ—à–∏—Ä–∞–Ω–∏ –∫—ä–¥–µ—Ç–æ –µ –ø–æ–¥—Ö–æ–¥—è—â–æ

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–∏ —Ç–æ—á–∫–∏

### **–° NOMENCLATURES App:**
- DocumentService –∑–∞–¥–µ–π—Å—Ç–≤–∞ —Å—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ –¥–≤–∏–∂–µ–Ω–∏—è —á—Ä–µ–∑ –ø—Ä–æ–º–µ–Ω–∏ –≤ —Å—Ç–∞—Ç—É—Å–∞
- StatusManager –ø—Ä–æ–≤–µ—Ä—è–≤–∞ movement –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–∏ —Ñ–ª–∞–≥–æ–≤–µ
- Document lines –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—è—Ç –¥–µ—Ç–∞–π–ª–∏ –∑–∞ –¥–≤–∏–∂–µ–Ω–∏—è—Ç–∞ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, —Ü–µ–Ω–∞, batch)

### **–° PRICING App:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ—Ç–∫—Ä–∏–≤–∞ –ø—Ä–æ–¥–∞–∂–Ω–∏ —Ü–µ–Ω–∏ –∑–∞ –∫–∞–ª–∫—É–ª–∞—Ü–∏–∏ –Ω–∞ –ø–µ—á–∞–ª–±–∞—Ç–∞
- –ó–∞–¥–µ–π—Å—Ç–≤–∞ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ—Ç–æ –∫–æ–≥–∞—Ç–æ —Å–µ–±–µ—Å—Ç–æ–π–Ω–æ—Å—Ç–∏—Ç–µ —Å–µ –ø—Ä–æ–º–µ–Ω—è—Ç –∑–Ω–∞—á–∏—Ç–µ–ª–Ω–æ
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤—è –¥–∞–Ω–Ω–∏ –∑–∞ —Å–µ–±–µ—Å—Ç–æ–π–Ω–æ—Å—Ç–∏ –∑–∞ markup –∫–∞–ª–∫—É–ª–∞—Ü–∏–∏

### **–° PRODUCTS App:**
- Product.track_batches –æ–ø—Ä–µ–¥–µ–ª—è –ø–æ–≤–µ–¥–µ–Ω–∏–µ—Ç–æ –Ω–∞ batch —Å–ª–µ–¥–µ–Ω–µ—Ç–æ
- –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Ç–∏–ø–∞ –µ–¥–∏–Ω–∏—Ü–∞ (–±–µ–∑ –¥—Ä–æ–±–Ω–∏ –±—Ä–æ–π–∫–∏)
- –°–µ–±–µ—Å—Ç–æ–π–Ω–æ—Å—Ç–∏—Ç–µ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏—Ç–µ —Å–µ –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞—Ç –æ—Ç —Å–∫–ª–∞–¥–æ–≤–∏ –¥–≤–∏–∂–µ–Ω–∏—è

### **–° CORE App:**
- –ò–∑–ø–æ–ª–∑–≤–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–∞–Ω–∏ decimal –ø–æ–ª–µ—Ç–∞ –∑–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–∞ —Å–µ —Å Service Registry –∑–∞ resolve-–≤–∞–Ω–µ –Ω–∞ —É—Å–ª—É–≥–∏
- –ò–∑–ø–æ–ª–∑–≤–∞ –¥–µ—Å–µ—Ç–∏—á–Ω–∏ —É—Ç–∏–ª–∏—Ç–∏ –∑–∞ –ø—Ä–∞–≤–∏–ª–Ω–æ –∑–∞–∫—Ä—ä–≥–ª—è–≤–∞–Ω–µ

---

## –ù–∞–π-–¥–æ–±—Ä–∏ –ø—Ä–∞–∫—Ç–∏–∫–∏

### 1. **–í–∏–Ω–∞–≥–∏ –∏–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ Result Pattern**
```python
# ‚úÖ –î–æ–±—Ä–æ
result = MovementService.create_incoming_stock(...)
if result.ok:
    movement_data = result.data
else:
    handle_error(result.code, result.msg)

# ‚ùå –ò–∑–±—è–≥–≤–∞–π—Ç–µ
try:
    movement = create_movement(...)  # –ë–∞–∑–∏—Ä–∞–Ω –Ω–∞ exceptions
except Exception as e:
    # –ù–µ—Å—ä–≤–º–µ—Å—Ç–∏–º–æ –æ–±—Ä–∞–±–æ—Ç–≤–∞–Ω–µ –Ω–∞ –≥—Ä–µ—à–∫–∏
```

### 2. **–ü—Ä–æ–≤–µ—Ä—è–≤–∞–π—Ç–µ –Ω–∞–ª–∏—á–Ω–æ—Å—Ç—Ç–∞ –ø—ä—Ä–≤–æ**
```python
# ‚úÖ –î–æ–±—Ä–æ  
availability = InventoryService.validate_availability(location, product, qty)
if availability.ok and availability.data['can_fulfill']:
    movement_result = MovementService.create_outgoing_stock(...)

# ‚ùå –ò–∑–±—è–≥–≤–∞–π—Ç–µ
movement_result = MovementService.create_outgoing_stock(...)  # –ú–æ–∂–µ –¥–∞ —Å–µ –ø—Ä–æ–≤–∞–ª–∏
```

### 3. **–ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª–Ω–∞—Ç–∞ –¥–µ—Å–µ—Ç–∏—á–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç**
```python
# ‚úÖ –î–æ–±—Ä–æ - –∏–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–∞–Ω–∏—Ç–µ —É—Ç–∏–ª–∏—Ç–∏
from core.utils.decimal_utils import round_cost_price, round_currency

cost = round_cost_price(Decimal('15.256789'))    # 15.2568 –∑–∞ –∫–∞–ª–∫—É–ª–∞—Ü–∏–∏
price = round_currency(Decimal('24.9876'))       # 24.99 –∑–∞ –¥–∏—Å–ø–ª–µ–π

# ‚ùå –ò–∑–±—è–≥–≤–∞–π—Ç–µ - —Ä—ä—á–Ω–æ –∑–∞–∫—Ä—ä–≥–ª—è–≤–∞–Ω–µ
cost = round(Decimal('15.256789'), 4)  # –ù–µ —Å–ª–µ–¥–≤–∞ –ø—Ä–∞–≤–∏–ª–∞—Ç–∞ –Ω–∞ —Å–∏—Å—Ç–µ–º–∞—Ç–∞
```

### 4. **–ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ –∞—Ç–æ–º–Ω–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**
```python
# ‚úÖ –î–æ–±—Ä–æ
with transaction.atomic():
    reserve_result = InventoryService.reserve_stock_qty(...)
    movement_result = MovementService.create_outgoing_stock(...)
    
# ‚ùå –ò–∑–±—è–≥–≤–∞–π—Ç–µ –æ—Ç–¥–µ–ª–Ω–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ –±–µ–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
```

### 5. **–ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ Document –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è—Ç–∞**
```python
# ‚úÖ –î–æ–±—Ä–æ - –ø–æ–∑–≤–æ–ª–µ—Ç–µ –Ω–∞ status –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Ç–∞ –¥–∞ —É–ø—Ä–∞–≤–ª—è–≤–∞ –¥–≤–∏–∂–µ–Ω–∏—è—Ç–∞
document.transition_to('completed')  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å—ä–∑–¥–∞–≤–∞ –¥–≤–∏–∂–µ–Ω–∏—è

# ‚ùå –ò–∑–±—è–≥–≤–∞–π—Ç–µ —Ä—ä—á–Ω–æ —Å—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ –¥–≤–∏–∂–µ–Ω–∏—è –∑–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∏
MovementService.create_incoming_stock(...)  # –¢—Ä—è–±–≤–∞ –¥–∞ –µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
```

---

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**INVENTORY app –∑–∞–≤–∏—Å–∏ –æ—Ç:**
- Django framework
- CORE app (Result pattern, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏, –¥–µ—Å–µ—Ç–∏—á–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç)
- PRODUCTS app (Product –º–æ–¥–µ–ª)
- NOMENCLATURES app (DocumentTypeStatus –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)

**–î—Ä—É–≥–∏ apps –∑–∞–≤–∏—Å—è—Ç –æ—Ç INVENTORY:**
- NOMENCLATURES (document-driven –¥–≤–∏–∂–µ–Ω–∏—è)
- PRICING (–¥–∞–Ω–Ω–∏ –∑–∞ —Å–µ–±–µ—Å—Ç–æ–π–Ω–æ—Å—Ç–∏)
- Sales –º–æ–¥—É–ª–∏ (–≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Å–∫–ª–∞–¥–∞)

---

## –ò—Å—Ç–æ—Ä–∏—è –Ω–∞ –≤–µ—Ä—Å–∏–∏—Ç–µ

- **v1.0** - –û—Å–Ω–æ–≤–Ω–æ —Å–∫–ª–∞–¥–æ–≤–æ —Å–ª–µ–¥–µ–Ω–µ
- **v1.5** - FIFO batch —Å–ª–µ–¥–µ–Ω–µ
- **v2.0** - Result pattern —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ä–∞–Ω–µ  
- **v2.1** - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥–æ–∫—É–º–µ–Ω—Ç–∏ —á—Ä–µ–∑ status –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- **v2.2** - –ü–æ–¥–æ–±—Ä–µ–Ω–æ –ø—Ä–æ—Å–ª–µ–¥—è–≤–∞–Ω–µ –Ω–∞ –ø–µ—á–∞–ª–±–∞—Ç–∞ –∏ –∞–Ω–∞–ª–∏–∑
- **v3.0** - –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–∞–Ω–∏ decimal –ø–æ–ª–µ—Ç–∞, Service Registry –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

---

*–ü–æ—Å–ª–µ–¥–Ω–∞ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è: 2025-09-05*  
*–í–µ—Ä—Å–∏—è: 3.0*  
*–ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞–Ω–æ —Å–ø–æ—Ä–µ–¥ –∞–∫—Ç—É–∞–ª–Ω–∏—è –∫–æ–¥ —Å –¥–µ—Å–µ—Ç–∏—á–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç*