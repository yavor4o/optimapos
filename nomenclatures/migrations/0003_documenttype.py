# Generated by Django 5.2.3 on 2025-07-17 09:22

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('nomenclatures', '0002_pricegroup'),
    ]

    operations = [
        migrations.CreateModel(
            name='DocumentType',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('code', models.CharField(help_text='Unique code for quick reference', max_length=100, unique=True, verbose_name='Code')),
                ('name', models.CharField(db_index=True, max_length=100, verbose_name='Name')),
                ('is_active', models.BooleanField(db_index=True, default=True, verbose_name='Is Active')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Created At')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='Updated At')),
                ('type_key', models.CharField(help_text='Unique identifier: request, order, delivery, quote, contract, etc.', max_length=50, verbose_name='Type Key')),
                ('app_name', models.CharField(help_text='Django app name: purchases, sales, inventory, contracts, hr', max_length=50, verbose_name='App Name')),
                ('model_name', models.CharField(blank=True, help_text='Model class name (optional): PurchaseOrder, SalesQuote, Contract', max_length=50, verbose_name='Model Name')),
                ('sort_order', models.PositiveIntegerField(default=0, help_text='Order for display in lists', verbose_name='Sort Order')),
                ('number_prefix', models.CharField(help_text='Document prefix: REQ, ORD, DEL, QUO, CON, etc.', max_length=10, verbose_name='Number Prefix')),
                ('current_number', models.PositiveIntegerField(default=0, help_text='Last used sequential number', verbose_name='Current Number')),
                ('number_format', models.CharField(default='{prefix}-{year}-{number:04d}', help_text='Format template: {prefix}-{year}-{number:04d}', max_length=100, verbose_name='Number Format')),
                ('reset_numbering_yearly', models.BooleanField(default=True, help_text='Reset numbering sequence each year', verbose_name='Reset Yearly')),
                ('last_reset_year', models.PositiveIntegerField(blank=True, help_text='Year when numbering was last reset', null=True, verbose_name='Last Reset Year')),
                ('allowed_statuses', models.JSONField(default=list, help_text='Valid status values: ["draft", "confirmed", "completed"]', verbose_name='Allowed Statuses')),
                ('default_status', models.CharField(default='draft', help_text='Initial status for new documents', max_length=30, verbose_name='Default Status')),
                ('status_transitions', models.JSONField(default=dict, help_text='Allowed transitions: {"draft": ["submitted", "cancelled"]}', verbose_name='Status Transitions')),
                ('auto_transitions', models.JSONField(default=dict, help_text='Automatic status changes: {"received": "processed"}', verbose_name='Auto Transitions')),
                ('final_statuses', models.JSONField(default=list, help_text='Statuses that prevent further changes: ["completed", "cancelled"]', verbose_name='Final Statuses')),
                ('requires_approval', models.BooleanField(default=False, help_text='Document needs approval before processing', verbose_name='Requires Approval')),
                ('approval_limit', models.DecimalField(blank=True, decimal_places=2, help_text='Amount above which approval is required (BGN)', max_digits=12, null=True, verbose_name='Approval Limit')),
                ('approval_levels', models.PositiveIntegerField(default=1, help_text='Number of approval levels required', verbose_name='Approval Levels')),
                ('auto_approve_conditions', models.JSONField(default=dict, help_text='Conditions for automatic approval', verbose_name='Auto Approve Conditions')),
                ('affects_inventory', models.BooleanField(default=False, help_text='Creates inventory movements', verbose_name='Affects Inventory')),
                ('inventory_direction', models.CharField(blank=True, choices=[('in', 'Incoming - Increases Stock'), ('out', 'Outgoing - Decreases Stock'), ('both', 'Both Directions Possible')], help_text='Direction of inventory impact', max_length=10, verbose_name='Inventory Direction')),
                ('inventory_timing', models.CharField(blank=True, choices=[('immediate', 'Immediate - On Creation'), ('on_confirm', 'On Confirmation'), ('on_process', 'On Processing'), ('on_complete', 'On Completion'), ('manual', 'Manual Trigger')], default='on_process', help_text='When to create inventory movements', max_length=20, verbose_name='Inventory Timing')),
                ('is_fiscal', models.BooleanField(default=False, help_text='Requires fiscal device/NAP reporting', verbose_name='Is Fiscal Document')),
                ('requires_vat_calculation', models.BooleanField(default=True, help_text='Document must calculate VAT', verbose_name='Requires VAT')),
                ('requires_payment', models.BooleanField(default=False, help_text='Payment must be processed', verbose_name='Requires Payment')),
                ('supports_foreign_currency', models.BooleanField(default=False, help_text='Supports non-BGN currencies', verbose_name='Foreign Currency')),
                ('requires_customer', models.BooleanField(default=False, help_text='Customer must be specified', verbose_name='Requires Customer')),
                ('requires_supplier', models.BooleanField(default=False, help_text='Supplier must be specified', verbose_name='Requires Supplier')),
                ('allows_anonymous', models.BooleanField(default=True, help_text='Allows documents without customer/supplier', verbose_name='Allow Anonymous')),
                ('can_be_source', models.BooleanField(default=False, help_text='Can create other documents from this type', verbose_name='Can Be Source')),
                ('can_reference_multiple_sources', models.BooleanField(default=False, help_text='Can be created from multiple source documents', verbose_name='Multiple Sources')),
                ('requires_batch_tracking', models.BooleanField(default=False, help_text='Mandatory batch numbers', verbose_name='Batch Tracking')),
                ('requires_expiry_dates', models.BooleanField(default=False, help_text='Mandatory expiry date tracking', verbose_name='Expiry Dates')),
                ('requires_serial_numbers', models.BooleanField(default=False, help_text='Mandatory serial number tracking', verbose_name='Serial Numbers')),
                ('requires_quality_check', models.BooleanField(default=False, help_text='Quality control before processing', verbose_name='Quality Check')),
                ('requires_certificates', models.BooleanField(default=False, help_text='Requires certificates (origin, health, etc.)', verbose_name='Certificates Required')),
                ('handles_returns', models.BooleanField(default=False, help_text='Document type for returns/reversals', verbose_name='Handles Returns')),
                ('reverses_original', models.BooleanField(default=False, help_text='Reverses effects of original document', verbose_name='Reverses Original')),
                ('allows_partial_delivery', models.BooleanField(default=True, help_text='Allows multiple partial deliveries', verbose_name='Partial Delivery')),
                ('delivery_tolerance_percent', models.DecimalField(blank=True, decimal_places=2, help_text='Allowed variance in delivery quantity', max_digits=5, null=True, verbose_name='Delivery Tolerance %')),
                ('supports_landed_cost', models.BooleanField(default=False, help_text='Supports freight and duties allocation', verbose_name='Landed Cost')),
                ('handles_price_variances', models.BooleanField(default=False, help_text='Handles price differences vs original', verbose_name='Price Variances')),
                ('pos_document', models.BooleanField(default=False, help_text='Can be created from POS terminal', verbose_name='POS Document')),
                ('prints_receipt', models.BooleanField(default=False, help_text='Automatically prints receipt', verbose_name='Prints Receipt')),
                ('opens_cash_drawer', models.BooleanField(default=False, help_text='Opens cash drawer on completion', verbose_name='Opens Cash Drawer')),
                ('auto_confirm', models.BooleanField(default=False, help_text='Automatically confirm on creation', verbose_name='Auto Confirm')),
                ('auto_number', models.BooleanField(default=True, help_text='Automatically generate document numbers', verbose_name='Auto Number')),
                ('requires_lines', models.BooleanField(default=True, help_text='Document must have line items', verbose_name='Requires Lines')),
                ('min_total_amount', models.DecimalField(blank=True, decimal_places=2, help_text='Minimum allowed total amount', max_digits=12, null=True, verbose_name='Min Total Amount')),
                ('max_total_amount', models.DecimalField(blank=True, decimal_places=2, help_text='Maximum allowed total amount', max_digits=12, null=True, verbose_name='Max Total Amount')),
                ('custom_validation_rules', models.JSONField(default=dict, help_text='Additional validation rules in JSON format', verbose_name='Custom Validation Rules')),
                ('allowed_source_types', models.ManyToManyField(blank=True, help_text='Document types that can be sources for this type', related_name='allowed_target_types', to='nomenclatures.documenttype')),
            ],
            options={
                'verbose_name': 'Document Type',
                'verbose_name_plural': 'Document Types',
                'ordering': ['app_name', 'sort_order', 'name'],
                'indexes': [models.Index(fields=['app_name', 'type_key'], name='nomenclatur_app_nam_9ce310_idx'), models.Index(fields=['affects_inventory', 'is_active'], name='nomenclatur_affects_0555c6_idx'), models.Index(fields=['is_fiscal', 'pos_document'], name='nomenclatur_is_fisc_faaf35_idx'), models.Index(fields=['requires_approval', 'approval_limit'], name='nomenclatur_require_832721_idx')],
                'unique_together': {('app_name', 'type_key'), ('number_prefix', 'app_name')},
            },
        ),
    ]
