{% load i18n %}
{% load static %}

<!-- Sidebar -->
<div class="kt-sidebar bg-background border-e border-e-border fixed top-0 bottom-0 z-20 hidden lg:flex flex-col items-stretch shrink-0 [--kt-drawer-enable:true] lg:[--kt-drawer-enable:false]" data-kt-drawer="true" data-kt-drawer-class="kt-drawer kt-drawer-start top-0 bottom-0" id="sidebar">

    <!-- Sidebar Header -->
    <div class="kt-sidebar-header hidden lg:flex items-center relative justify-between px-3 lg:px-6 shrink-0" id="sidebar_header">
        <a class="dark:hidden" href="/">
            <img class="default-logo min-h-[22px] max-w-5/6" src="{% static 'media/app/optima-logo.png' %}"/>
            <img class="small-logo min-h-[22px] max-w-22" src="{% static 'media/app/optima-logo.png' %}"/>
        </a>
        <a class="hidden dark:block" href="/">
            <img class="default-logo min-h-[22px] max-w-22" src="{% static 'media/app/optima-logo-white.png' %}"/>
            <img class="small-logo min-h-[22px] max-w-22" src="{% static 'media/app/optima-logo-white.png' %}"/>
        </a>
        <button class="kt-btn kt-btn-outline kt-btn-icon size-[30px] absolute start-full top-2/4 -translate-x-2/4 -translate-y-2/4 rtl:translate-x-2/4" data-kt-toggle="body" data-kt-toggle-class="kt-sidebar-collapse" id="sidebar_toggle">
            <i class="ki-filled ki-black-left-line kt-toggle-active:rotate-180 transition-all duration-300 rtl:translate rtl:rotate-180 rtl:kt-toggle-active:rotate-0"></i>
        </button>
    </div>

    <!-- Location Context Bar -->
    <div class="px-3 lg:px-6 py-3 border-b border-border bg-muted/30">
        <div class="flex items-center gap-2 text-sm">
            <i class="ki-filled ki-geolocation text-primary text-base"></i>
            <div class="flex flex-col">
                <span class="font-medium text-foreground">{{ user.current_location.name|default:_("No Location") }}</span>
                <span class="text-xs text-muted-foreground">{{ user.current_location.location_type_display|default:_("Not Assigned") }}</span>
            </div>
        </div>
    </div>

    <!-- Sidebar Content -->
    <div class="kt-sidebar-content flex grow shrink-0 py-5 pe-2" id="sidebar_content">
        <div class="kt-scrollable-y-hover grow shrink-0 flex ps-2 lg:ps-5 pe-1 lg:pe-3" data-kt-scrollable="true" data-kt-scrollable-dependencies="#sidebar_header" data-kt-scrollable-height="auto" data-kt-scrollable-offset="0px" data-kt-scrollable-wrappers="#sidebar_content" id="sidebar_scrollable">

            <!-- Sidebar Menu -->
            <div class="kt-menu flex flex-col grow gap-1" data-kt-menu="true" data-kt-menu-accordion-expand-all="false" id="sidebar_menu">

                <!-- MAIN NAVIGATION SECTION -->
                <div class="kt-menu-item pt-2.25 pb-px">
                    <span class="kt-menu-heading uppercase text-xs font-medium text-muted-foreground ps-[10px] pe-[10px]">
                        {% trans "Main Navigation" %}
                    </span>
                </div>

                <!-- DASHBOARD -->
                <div class="kt-menu-item {% if nav_state.current_url_name == 'dashboard' and nav_state.current_namespace == 'core' %}active{% endif %}">
                    <a class="kt-menu-link border border-transparent items-center grow {% if nav_state.current_url_name == 'dashboard' and nav_state.current_namespace == 'core' %}kt-menu-item-active bg-accent/60 rounded-lg{% endif %} kt-menu-item-active:bg-accent/60 dark:menu-item-active:border-border kt-menu-item-active:rounded-lg hover:bg-accent/60 hover:rounded-lg gap-[10px] ps-[10px] pe-[10px] py-[6px]" href="{% url 'core:dashboard' %}" tabindex="0">
                        <span class="kt-menu-bullet flex w-[6px] -start-[3px] rtl:start-0 relative before:absolute before:top-0 before:size-[6px] before:rounded-full rtl:before:translate-x-1/2 before:-translate-y-1/2 kt-menu-item-active:before:bg-primary kt-menu-item-hover:before:bg-primary"></span>
                        <span class="kt-menu-icon items-start text-muted-foreground w-[20px] kt-menu-item-active:text-primary">
                            <i class="ki-filled ki-home-2 text-lg"></i>
                        </span>
                        <span class="kt-menu-title text-sm font-medium text-foreground kt-menu-item-active:text-primary kt-menu-item-active:font-semibold kt-menu-link-hover:!text-primary">
                            {% trans "Dashboard" %}
                        </span>
                    </a>
                </div>

                <!-- SYSTEM CONFIGURATION SECTION -->
                <div class="kt-menu-item pt-2.25 pb-px">
                    <span class="kt-menu-heading uppercase text-xs font-medium text-muted-foreground ps-[10px] pe-[10px]">
                        {% trans "System Configuration" %}
                    </span>
                </div>

                <!-- NOMENCLATURES SECTION - PRIORITY MODULE -->
                <div class="kt-menu-item {% if active_sections.nomenclatures %}here show kt-menu-item-accordion{% else %}kt-menu-item-accordion{% endif %}" data-kt-menu-item-toggle="accordion" data-kt-menu-item-trigger="click">
                    <div class="kt-menu-link flex items-center grow cursor-pointer border border-transparent gap-[10px] ps-[10px] pe-[10px] py-[6px]" tabindex="0">
                        <span class="kt-menu-icon items-start text-muted-foreground w-[20px]">
                            <i class="ki-filled ki-setting-2 text-lg"></i>
                        </span>
                        <span class="kt-menu-title text-sm font-medium text-foreground kt-menu-item-active:text-primary kt-menu-link-hover:!text-primary">
                            {% trans "Nomenclatures" %}
                        </span>
                        <span class="kt-menu-arrow text-muted-foreground w-[20px] shrink-0 justify-end ms-1 me-[-10px]">
                            <span class="inline-flex kt-menu-item-show:hidden">
                                <i class="ki-filled ki-plus text-[11px]"></i>
                            </span>
                            <span class="hidden kt-menu-item-show:inline-flex">
                                <i class="ki-filled ki-minus text-[11px]"></i>
                            </span>
                        </span>
                    </div>
                    <div class="kt-menu-accordion gap-1 ps-[10px] relative before:absolute before:start-[20px] before:top-0 before:bottom-0 before:border-s before:border-border">

                        <!-- Product Classifications Submenu -->
                        <div class="kt-menu-item {% if nomenclature_active.product_classifications %}here show kt-menu-item-accordion{% else %}kt-menu-item-accordion{% endif %}" data-kt-menu-item-toggle="accordion" data-kt-menu-item-trigger="click">
                            <div class="kt-menu-link border border-transparent grow cursor-pointer gap-[5px] ps-[10px] pe-[10px] py-[8px]" tabindex="0">
                                <span class="kt-menu-bullet flex w-[6px] -start-[3px] rtl:start-0 relative before:absolute before:top-0 before:size-[6px] before:rounded-full rtl:before:translate-x-1/2 before:-translate-y-1/2 kt-menu-item-active:before:bg-primary kt-menu-item-hover:before:bg-primary"></span>
                                <span class="kt-menu-title text-2sm font-normal me-1 text-foreground kt-menu-item-active:text-primary kt-menu-item-active:font-medium kt-menu-link-hover:!text-primary">
                                    {% trans "Product Classifications" %}
                                </span>
                                <span class="kt-menu-arrow text-muted-foreground w-[20px] shrink-0 justify-end ms-1 me-[-10px]">
                                    <span class="inline-flex kt-menu-item-show:hidden">
                                        <i class="ki-filled ki-plus text-[11px]"></i>
                                    </span>
                                    <span class="hidden kt-menu-item-show:inline-flex">
                                        <i class="ki-filled ki-minus text-[11px]"></i>
                                    </span>
                                </span>
                            </div>
                            <div class="kt-menu-accordion gap-1 relative before:absolute before:start-[32px] ps-[22px] before:top-0 before:bottom-0 before:border-s before:border-border">
                                <div class="kt-menu-item {% if nomenclature_active.product_groups %}active{% endif %}">
                                    <a class="kt-menu-link border border-transparent items-center grow kt-menu-item-active:bg-accent/60 dark:menu-item-active:border-border kt-menu-item-active:rounded-lg hover:bg-accent/60 hover:rounded-lg gap-[5px] ps-[10px] pe-[10px] py-[8px]" href="{% url 'nomenclatures:product_groups' %}" tabindex="0">
                                        <span class="kt-menu-bullet flex w-[6px] -start-[3px] rtl:start-0 relative before:absolute before:top-0 before:size-[6px] before:rounded-full rtl:before:translate-x-1/2 before:-translate-y-1/2 kt-menu-item-active:before:bg-primary kt-menu-item-hover:before:bg-primary"></span>
                                        <span class="kt-menu-title text-2sm font-normal text-foreground kt-menu-item-active:text-primary kt-menu-item-active:font-semibold kt-menu-link-hover:!text-primary">
                                            {% trans "Product Groups" %}
                                        </span>
                                    </a>
                                </div>
                                <div class="kt-menu-item {% if nomenclature_active.brands %}active{% endif %}">
                                    <a class="kt-menu-link border border-transparent items-center grow kt-menu-item-active:bg-accent/60 dark:menu-item-active:border-border kt-menu-item-active:rounded-lg hover:bg-accent/60 hover:rounded-lg gap-[5px] ps-[10px] pe-[10px] py-[8px]" href="{% url 'nomenclatures:brands' %}" tabindex="0">
                                        <span class="kt-menu-bullet flex w-[6px] -start-[3px] rtl:start-0 relative before:absolute before:top-0 before:size-[6px] before:rounded-full rtl:before:translate-x-1/2 before:-translate-y-1/2 kt-menu-item-active:before:bg-primary kt-menu-item-hover:before:bg-primary"></span>
                                        <span class="kt-menu-title text-2sm font-normal text-foreground kt-menu-item-active:text-primary kt-menu-item-active:font-semibold kt-menu-link-hover:!text-primary">
                                            {% trans "Brands" %}
                                        </span>
                                    </a>
                                </div>
                                <div class="kt-menu-item {% if nomenclature_active.product_types %}active{% endif %}">
                                    <a class="kt-menu-link border border-transparent items-center grow kt-menu-item-active:bg-accent/60 dark:menu-item-active:border-border kt-menu-item-active:rounded-lg hover:bg-accent/60 hover:rounded-lg gap-[5px] ps-[10px] pe-[10px] py-[8px]" href="{% url 'nomenclatures:product_types' %}" tabindex="0">
                                        <span class="kt-menu-bullet flex w-[6px] -start-[3px] rtl:start-0 relative before:absolute before:top-0 before:size-[6px] before:rounded-full rtl:before:translate-x-1/2 before:-translate-y-1/2 kt-menu-item-active:before:bg-primary kt-menu-item-hover:before:bg-primary"></span>
                                        <span class="kt-menu-title text-2sm font-normal text-foreground kt-menu-item-active:text-primary kt-menu-item-active:font-semibold kt-menu-link-hover:!text-primary">
                                            {% trans "Product Types" %}
                                        </span>
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- Financial Settings Submenu -->
                    <div class="kt-menu-item {% if nomenclature_active.financial_settings %}here show kt-menu-item-accordion{% else %}kt-menu-item-accordion{% endif %}" data-kt-menu-item-toggle="accordion" data-kt-menu-item-trigger="click">
                            <div class="kt-menu-link border border-transparent grow cursor-pointer gap-[5px] ps-[10px] pe-[10px] py-[8px]" tabindex="0">
                                <span class="kt-menu-bullet flex w-[6px] -start-[3px] rtl:start-0 relative before:absolute before:top-0 before:size-[6px] before:rounded-full rtl:before:translate-x-1/2 before:-translate-y-1/2 kt-menu-item-active:before:bg-primary kt-menu-item-hover:before:bg-primary"></span>
                                <span class="kt-menu-title text-2sm font-normal me-1 text-foreground kt-menu-item-active:text-primary kt-menu-item-active:font-medium kt-menu-link-hover:!text-primary">
                                    {% trans "Financial Settings" %}
                                </span>
                                <span class="kt-menu-arrow text-muted-foreground w-[20px] shrink-0 justify-end ms-1 me-[-10px]">
                                    <span class="inline-flex kt-menu-item-show:hidden">
                                        <i class="ki-filled ki-plus text-[11px]"></i>
                                    </span>
                                    <span class="hidden kt-menu-item-show:inline-flex">
                                        <i class="ki-filled ki-minus text-[11px]"></i>
                                    </span>
                                </span>
                            </div>
                            <div class="kt-menu-accordion gap-1 relative before:absolute before:start-[32px] ps-[22px] before:top-0 before:bottom-0 before:border-s before:border-border">
                                <div class="kt-menu-item {% if nomenclature_active.currencies %}active{% endif %}">
                                    <a class="kt-menu-link border border-transparent items-center grow {% if nomenclature_active.currencies %}kt-menu-item-active bg-accent/60 rounded-lg{% endif %} kt-menu-item-active:bg-accent/60 dark:menu-item-active:border-border kt-menu-item-active:rounded-lg hover:bg-accent/60 hover:rounded-lg gap-[5px] ps-[10px] pe-[10px] py-[8px]" href="{% url 'nomenclatures:currencies' %}" tabindex="0">
                                        <span class="kt-menu-bullet flex w-[6px] -start-[3px] rtl:start-0 relative before:absolute before:top-0 before:size-[6px] before:rounded-full rtl:before:translate-x-1/2 before:-translate-y-1/2 kt-menu-item-active:before:bg-primary kt-menu-item-hover:before:bg-primary"></span>
                                        <span class="kt-menu-title text-2sm font-normal text-foreground kt-menu-item-active:text-primary kt-menu-item-active:font-semibold kt-menu-link-hover:!text-primary">
                                            {% trans "Currencies" %}
                                        </span>
                                    </a>
                                </div>
                                <div class="kt-menu-item {% if nomenclature_active.tax_groups %}active{% endif %}">
                                    <a class="kt-menu-link border border-transparent items-center grow {% if nomenclature_active.tax_groups %}kt-menu-item-active bg-accent/60 rounded-lg{% endif %} kt-menu-item-active:bg-accent/60 dark:menu-item-active:border-border kt-menu-item-active:rounded-lg hover:bg-accent/60 hover:rounded-lg gap-[5px] ps-[10px] pe-[10px] py-[8px]" href="{% url 'nomenclatures:tax_groups' %}" tabindex="0">
                                        <span class="kt-menu-bullet flex w-[6px] -start-[3px] rtl:start-0 relative before:absolute before:top-0 before:size-[6px] before:rounded-full rtl:before:translate-x-1/2 before:-translate-y-1/2 kt-menu-item-active:before:bg-primary kt-menu-item-hover:before:bg-primary"></span>
                                        <span class="kt-menu-title text-2sm font-normal text-foreground kt-menu-item-active:text-primary kt-menu-item-active:font-semibold kt-menu-link-hover:!text-primary">
                                            {% trans "Tax Groups" %}
                                        </span>
                                    </a>
                                </div>
                                <div class="kt-menu-item {% if nomenclature_active.price_groups %}active{% endif %}">
                                    <a class="kt-menu-link border border-transparent items-center grow {% if nomenclature_active.price_groups %}kt-menu-item-active bg-accent/60 rounded-lg{% endif %} kt-menu-item-active:bg-accent/60 dark:menu-item-active:border-border kt-menu-item-active:rounded-lg hover:bg-accent/60 hover:rounded-lg gap-[5px] ps-[10px] pe-[10px] py-[8px]" href="{% url 'nomenclatures:price_groups' %}" tabindex="0">
                                        <span class="kt-menu-bullet flex w-[6px] -start-[3px] rtl:start-0 relative before:absolute before:top-0 before:size-[6px] before:rounded-full rtl:before:translate-x-1/2 before:-translate-y-1/2 kt-menu-item-active:before:bg-primary kt-menu-item-hover:before:bg-primary"></span>
                                        <span class="kt-menu-title text-2sm font-normal text-foreground kt-menu-item-active:text-primary kt-menu-item-active:font-semibold kt-menu-link-hover:!text-primary">
                                            {% trans "Price Groups" %}
                                        </span>
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- Document Types -->
                        <div class="kt-menu-item {% if nomenclature_active.document_types %}active{% endif %}">
                            <a class="kt-menu-link border border-transparent items-center grow {% if nomenclature_active.document_types %}kt-menu-item-active bg-accent/60 rounded-lg{% endif %} kt-menu-item-active:bg-accent/60 dark:menu-item-active:border-border kt-menu-item-active:rounded-lg hover:bg-accent/60 hover:rounded-lg gap-[14px] ps-[10px] pe-[10px] py-[8px]" href="{% url 'nomenclatures:document_types' %}" tabindex="0">
                                <span class="kt-menu-bullet flex w-[6px] -start-[3px] rtl:start-0 relative before:absolute before:top-0 before:size-[6px] before:rounded-full rtl:before:translate-x-1/2 before:-translate-y-1/2 kt-menu-item-active:before:bg-primary kt-menu-item-hover:before:bg-primary"></span>
                                <span class="kt-menu-title text-2sm font-normal text-foreground kt-menu-item-active:text-primary kt-menu-item-active:font-semibold kt-menu-link-hover:!text-primary">
                                    {% trans "Document Types" %}
                                </span>
                            </a>
                        </div>

                        <!-- Workflow Settings -->
                        <div class="kt-menu-item {% if nomenclature_active.workflow_settings %}active{% endif %}">
                            <a class="kt-menu-link border border-transparent items-center grow {% if nomenclature_active.workflow_settings %}kt-menu-item-active bg-accent/60 rounded-lg{% endif %} kt-menu-item-active:bg-accent/60 dark:menu-item-active:border-border kt-menu-item-active:rounded-lg hover:bg-accent/60 hover:rounded-lg gap-[14px] ps-[10px] pe-[10px] py-[8px]" href="{% url 'nomenclatures:workflow_settings' %}" tabindex="0">
                                <span class="kt-menu-bullet flex w-[6px] -start-[3px] rtl:start-0 relative before:absolute before:top-0 before:size-[6px] before:rounded-full rtl:before:translate-x-1/2 before:-translate-y-1/2 kt-menu-item-active:before:bg-primary kt-menu-item-hover:before:bg-primary"></span>
                                <span class="kt-menu-title text-2sm font-normal text-foreground kt-menu-item-active:text-primary kt-menu-item-active:font-semibold kt-menu-link-hover:!text-primary">
                                    {% trans "Workflow Settings" %}
                                </span>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- OPERATIONS SECTION -->
                <div class="kt-menu-item pt-2.25 pb-px">
                    <span class="kt-menu-heading uppercase text-xs font-medium text-muted-foreground ps-[10px] pe-[10px]">
                        {% trans "Operations" %}
                    </span>
                </div>

                <!-- PROCUREMENT SECTION -->
                <div class="kt-menu-item {% if nav_state.current_namespace == 'purchases' %}here show kt-menu-item-accordion{% else %}kt-menu-item-accordion{% endif %}" data-kt-menu-item-toggle="accordion" data-kt-menu-item-trigger="click">
                    <div class="kt-menu-link flex items-center grow cursor-pointer border border-transparent gap-[10px] ps-[10px] pe-[10px] py-[6px] {% if nav_state.current_namespace == 'purchases' %}kt-menu-item-active text-primary{% endif %}" tabindex="0">
                        <span class="kt-menu-icon items-start text-muted-foreground w-[20px] kt-menu-item-active:text-primary">
                            <i class="ki-filled ki-delivery-3 text-lg"></i>
                        </span>
                        <span class="kt-menu-title text-sm font-medium text-foreground kt-menu-item-active:text-primary kt-menu-link-hover:!text-primary">
                            {% trans "Procurement" %}
                        </span>
                        <span class="kt-menu-arrow text-muted-foreground w-[20px] shrink-0 justify-end ms-1 me-[-10px]">
                            <span class="inline-flex kt-menu-item-show:hidden">
                                <i class="ki-filled ki-plus text-[11px]"></i>
                            </span>
                            <span class="hidden kt-menu-item-show:inline-flex">
                                <i class="ki-filled ki-minus text-[11px]"></i>
                            </span>
                        </span>
                    </div>
                    <div class="kt-menu-accordion gap-1 ps-[10px] relative before:absolute before:start-[20px] before:top-0 before:bottom-0 before:border-s before:border-border">
                        <div class="kt-menu-item {% if nav_state.current_url_name == 'index' and nav_state.current_namespace == 'purchases' %}active{% endif %}">
                            <a class="kt-menu-link border border-transparent items-center grow {% if nav_state.current_url_name == 'index' and nav_state.current_namespace == 'purchases' %}kt-menu-item-active bg-accent/60 rounded-lg{% endif %} kt-menu-item-active:bg-accent/60 dark:menu-item-active:border-border kt-menu-item-active:rounded-lg hover:bg-accent/60 hover:rounded-lg gap-[5px] ps-[10px] pe-[10px] py-[8px]" href="{% url 'purchases:index' %}" tabindex="0">
                                <span class="kt-menu-bullet flex w-[6px] -start-[3px] rtl:start-0 relative before:absolute before:top-0 before:size-[6px] before:rounded-full rtl:before:translate-x-1/2 before:-translate-y-1/2 kt-menu-item-active:before:bg-primary kt-menu-item-hover:before:bg-primary"></span>
                                <span class="kt-menu-title text-2sm font-normal text-foreground kt-menu-item-active:text-primary kt-menu-item-active:font-semibold kt-menu-link-hover:!text-primary">
                                    {% trans "Purchase Overview" %}
                                </span>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- PLACEHOLDER SECTIONS - Future Implementation -->
                {% comment "Future modules - placeholders for development roadmap" %}

                <!-- DASHBOARD SECTION (Future) -->
                <!-- Will include: Overview, Analytics, Reports -->

                <!-- POS OPERATIONS SECTION (Future) -->
                <!-- Will include: Sales Terminal, Quick Sale, Cash Register, Returns -->

                <!-- PRODUCTS & INVENTORY SECTION (Future) -->
                <!-- Will include: Product Catalog, Stock Levels, Movements -->

                <!-- SALES SECTION (Future) -->
                <!-- Will include: Sales Orders, Invoices, Customer Management -->

                <!-- REPORTING SECTION (Future) -->
                <!-- Will include: Financial Reports, Inventory Reports, Sales Analytics -->

                {% endcomment %}

            </div>
            <!-- End of Sidebar Menu -->

        </div>
    </div>
</div>
<!-- End of Sidebar -->